/*! For license information please see bundle.js.LICENSE.txt */
!function(){"use strict";var t={424:function(t,e,i){var s=i(81),r=i.n(s),n=i(645),o=i.n(n)()(r());o.push([t.id,'body {\n\n    background-color: black;\n    color: white;\n\n    /* Allow mouse dragging. */\n    -moz-user-select: none;\n    -ms-user-select: none;\n    -o-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n\n    /* disable touch panning/zooming */\n    -ms-touch-action: none;\n    touch-action: none;\n\n    /* Allow canvas to hit the edges of the browser viewport. */\n    margin: 0;\n}\n\n#screen canvas {\n    margin: auto;\n    /* Hide the gap for font descenders. */\n    display: block;\n}\n\n/* The Modal (background) */\n.modal {\n  display: none; /* Hidden by default */\n  position: fixed; /* Stay in place */\n  z-index: 1; /* Sit on top */\n  padding-top: 100px; /* Location of the box */\n  left: 0;\n  top: 0;\n  width: 100%; /* Full width */\n  height: 100%; /* Full height */\n  overflow: auto; /* Enable scroll if needed */\n  background-color: rgb(0,0,0); /* Fallback color */\n  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n}\n\n/* Modal Content */\n.modal-content {\n  background-color: #fefefe;\n  margin: auto;\n  padding: 20px;\n  border: 1px solid #888;\n  width: 80%;\n  word-wrap: break-word;\n}\n\n/* Modal message */\n#messageContents {\n  color: #000000;\n  font-family: "Verdana";\n}\n\n/* The Close Button */\n.close {\n  color: #aaaaaa;\n  float: right;\n  font-family: monospace;\n  font-size: 28px;\n  font-weight: bold;\n}\n\n.close:hover,\n.close:focus {\n  color: #000;\n  text-decoration: none;\n  cursor: pointer;\n}\n',""]),e.Z=o},645:function(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,r,n){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var l=0;l<t.length;l++){var u=[].concat(t[l]);s&&o[u[0]]||(void 0!==n&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=n),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),e.push(u))}},e}},81:function(t){t.exports=function(t){return t[1]}},379:function(t){var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var n={},o=[],a=0;a<t.length;a++){var h=t[a],l=s.base?h[0]+s.base:h[0],u=n[l]||0,d="".concat(l," ").concat(u);n[l]=u+1;var c=i(d),p={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==c)e[c].references++,e[c].updater(p);else{var f=r(p,s);s.byIndex=a,e.splice(a,0,{identifier:d,updater:f,references:1})}o.push(d)}return o}function r(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,r){var n=s(t=t||[],r=r||{});return function(t){t=t||[];for(var o=0;o<n.length;o++){var a=i(n[o]);e[a].references--}for(var h=s(t,r),l=0;l<n.length;l++){var u=i(n[l]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}n=h}}},569:function(t){var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},216:function(t){t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:function(t,e,i){t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},795:function(t){t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,r&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var n=i.sourceMap;n&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:function(t){t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={id:s,exports:{}};return t[s](n,n.exports,i),n.exports}i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,{a:e}),e},i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.nc=void 0,function(){var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=function(t){return t&&t.Math==Math&&t},s=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof t&&t)||function(){return this}()||Function("return this")(),r={},n=function(t){try{return!!t()}catch(t){return!0}},o=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),a=!n((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),h=a,l=Function.prototype.call,u=h?l.bind(l):function(){return l.apply(l,arguments)},d={},c={}.propertyIsEnumerable,p=Object.getOwnPropertyDescriptor,f=p&&!c.call({1:2},1);d.f=f?function(t){var e=p(this,t);return!!e&&e.enumerable}:c;var g,m,y=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},v=a,x=Function.prototype,_=x.bind,b=x.call,w=v&&_.bind(b,b),T=v?function(t){return t&&w(t)}:function(t){return t&&function(){return b.apply(t,arguments)}},A=T,E=A({}.toString),S=A("".slice),C=function(t){return S(E(t),8,-1)},M=n,P=C,I=Object,k=T("".split),O=M((function(){return!I("z").propertyIsEnumerable(0)}))?function(t){return"String"==P(t)?k(t,""):I(t)}:I,B=function(t){return null==t},R=B,L=TypeError,D=function(t){if(R(t))throw L("Can't call method on "+t);return t},F=O,z=D,U=function(t){return F(z(t))},V="object"==typeof document&&document.all,N={all:V,IS_HTMLDDA:void 0===V&&void 0!==V},G=N.all,j=N.IS_HTMLDDA?function(t){return"function"==typeof t||t===G}:function(t){return"function"==typeof t},H=j,X=N.all,Y=N.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:H(t)||t===X}:function(t){return"object"==typeof t?null!==t:H(t)},W=s,K=j,q=function(t,e){return arguments.length<2?(i=W[t],K(i)?i:void 0):W[t]&&W[t][e];var i},Z=T({}.isPrototypeOf),Q=s,J=q("navigator","userAgent")||"",$=Q.process,tt=Q.Deno,et=$&&$.versions||tt&&tt.version,it=et&&et.v8;it&&(m=(g=it.split("."))[0]>0&&g[0]<4?1:+(g[0]+g[1])),!m&&J&&(!(g=J.match(/Edge\/(\d+)/))||g[1]>=74)&&(g=J.match(/Chrome\/(\d+)/))&&(m=+g[1]);var st=m,rt=n,nt=!!Object.getOwnPropertySymbols&&!rt((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&st&&st<41})),ot=nt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,at=q,ht=j,lt=Z,ut=Object,dt=ot?function(t){return"symbol"==typeof t}:function(t){var e=at("Symbol");return ht(e)&&lt(e.prototype,ut(t))},ct=String,pt=j,ft=TypeError,gt=function(t){if(pt(t))return t;throw ft(function(t){try{return ct(t)}catch(t){return"Object"}}(t)+" is not a function")},mt=B,yt=u,vt=j,xt=Y,_t=TypeError,bt={exports:{}},wt=s,Tt=Object.defineProperty,At=function(t,e){try{Tt(wt,t,{value:e,configurable:!0,writable:!0})}catch(i){wt[t]=e}return e},Et=At,St="__core-js_shared__",Ct=s[St]||Et(St,{}),Mt=Ct;(bt.exports=function(t,e){return Mt[t]||(Mt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.25.3",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.3/LICENSE",source:"https://github.com/zloirock/core-js"});var Pt=D,It=Object,kt=T({}.hasOwnProperty),Ot=Object.hasOwn||function(t,e){return kt(It(Pt(t)),e)},Bt=T,Rt=0,Lt=Math.random(),Dt=Bt(1..toString),Ft=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Dt(++Rt+Lt,36)},zt=s,Ut=bt.exports,Vt=Ot,Nt=Ft,Gt=nt,jt=ot,Ht=Ut("wks"),Xt=zt.Symbol,Yt=Xt&&Xt.for,Wt=jt?Xt:Xt&&Xt.withoutSetter||Nt,Kt=function(t){if(!Vt(Ht,t)||!Gt&&"string"!=typeof Ht[t]){var e="Symbol."+t;Gt&&Vt(Xt,t)?Ht[t]=Xt[t]:Ht[t]=jt&&Yt?Yt(e):Wt(e)}return Ht[t]},qt=u,Zt=Y,Qt=dt,Jt=TypeError,$t=Kt("toPrimitive"),te=function(t,e){if(!Zt(t)||Qt(t))return t;var i,s,r=(s=t[$t],mt(s)?void 0:gt(s));if(r){if(void 0===e&&(e="default"),i=qt(r,t,e),!Zt(i)||Qt(i))return i;throw Jt("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var i,s;if("string"===e&&vt(i=t.toString)&&!xt(s=yt(i,t)))return s;if(vt(i=t.valueOf)&&!xt(s=yt(i,t)))return s;if("string"!==e&&vt(i=t.toString)&&!xt(s=yt(i,t)))return s;throw _t("Can't convert object to primitive value")}(t,e)},ee=dt,ie=function(t){var e=te(t,"string");return ee(e)?e:e+""},se=Y,re=s.document,ne=se(re)&&se(re.createElement),oe=!o&&!n((function(){return 7!=Object.defineProperty((t="div",ne?re.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),ae=o,he=u,le=d,ue=y,de=U,ce=ie,pe=Ot,fe=oe,ge=Object.getOwnPropertyDescriptor;r.f=ae?ge:function(t,e){if(t=de(t),e=ce(e),fe)try{return ge(t,e)}catch(t){}if(pe(t,e))return ue(!he(le.f,t,e),t[e])};var me={},ye=o&&n((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),ve=Y,xe=String,_e=TypeError,be=function(t){if(ve(t))return t;throw _e(xe(t)+" is not an object")},we=o,Te=oe,Ae=ye,Ee=be,Se=ie,Ce=TypeError,Me=Object.defineProperty,Pe=Object.getOwnPropertyDescriptor,Ie="enumerable",ke="configurable",Oe="writable";me.f=we?Ae?function(t,e,i){if(Ee(t),e=Se(e),Ee(i),"function"==typeof t&&"prototype"===e&&"value"in i&&Oe in i&&!i[Oe]){var s=Pe(t,e);s&&s[Oe]&&(t[e]=i.value,i={configurable:ke in i?i[ke]:s[ke],enumerable:Ie in i?i[Ie]:s[Ie],writable:!1})}return Me(t,e,i)}:Me:function(t,e,i){if(Ee(t),e=Se(e),Ee(i),Te)try{return Me(t,e,i)}catch(t){}if("get"in i||"set"in i)throw Ce("Accessors not supported");return"value"in i&&(t[e]=i.value),t};var Be=me,Re=y,Le=o?function(t,e,i){return Be.f(t,e,Re(1,i))}:function(t,e,i){return t[e]=i,t},De={exports:{}},Fe=o,ze=Ot,Ue=Function.prototype,Ve=Fe&&Object.getOwnPropertyDescriptor,Ne=ze(Ue,"name"),Ge={EXISTS:Ne,PROPER:Ne&&"something"===function(){}.name,CONFIGURABLE:Ne&&(!Fe||Fe&&Ve(Ue,"name").configurable)},je=j,He=Ct,Xe=T(Function.toString);je(He.inspectSource)||(He.inspectSource=function(t){return Xe(t)});var Ye,We,Ke,qe,Ze=He.inspectSource,Qe=j,Je=s.WeakMap,$e=Qe(Je)&&/native code/.test(String(Je)),ti=bt.exports,ei=Ft,ii=ti("keys"),si={},ri=$e,ni=s,oi=T,ai=Y,hi=Le,li=Ot,ui=Ct,di=si,ci="Object already initialized",pi=ni.TypeError,fi=ni.WeakMap;if(ri||ui.state){var gi=ui.state||(ui.state=new fi),mi=oi(gi.get),yi=oi(gi.has),vi=oi(gi.set);Ye=function(t,e){if(yi(gi,t))throw pi(ci);return e.facade=t,vi(gi,t,e),e},We=function(t){return mi(gi,t)||{}},Ke=function(t){return yi(gi,t)}}else{var xi=ii[qe="state"]||(ii[qe]=ei(qe));di[xi]=!0,Ye=function(t,e){if(li(t,xi))throw pi(ci);return e.facade=t,hi(t,xi,e),e},We=function(t){return li(t,xi)?t[xi]:{}},Ke=function(t){return li(t,xi)}}var _i={set:Ye,get:We,has:Ke,enforce:function(t){return Ke(t)?We(t):Ye(t,{})},getterFor:function(t){return function(e){var i;if(!ai(e)||(i=We(e)).type!==t)throw pi("Incompatible receiver, "+t+" required");return i}}},bi=n,wi=j,Ti=Ot,Ai=o,Ei=Ge.CONFIGURABLE,Si=Ze,Ci=_i.enforce,Mi=_i.get,Pi=Object.defineProperty,Ii=Ai&&!bi((function(){return 8!==Pi((function(){}),"length",{value:8}).length})),ki=String(String).split("String"),Oi=De.exports=function(t,e,i){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),i&&i.getter&&(e="get "+e),i&&i.setter&&(e="set "+e),(!Ti(t,"name")||Ei&&t.name!==e)&&(Ai?Pi(t,"name",{value:e,configurable:!0}):t.name=e),Ii&&i&&Ti(i,"arity")&&t.length!==i.arity&&Pi(t,"length",{value:i.arity});try{i&&Ti(i,"constructor")&&i.constructor?Ai&&Pi(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=Ci(t);return Ti(s,"source")||(s.source=ki.join("string"==typeof e?e:"")),t};Function.prototype.toString=Oi((function(){return wi(this)&&Mi(this).source||Si(this)}),"toString");var Bi=j,Ri=me,Li=De.exports,Di=At,Fi={},zi=Math.ceil,Ui=Math.floor,Vi=Math.trunc||function(t){var e=+t;return(e>0?Ui:zi)(e)},Ni=Vi,Gi=function(t){var e=+t;return e!=e||0===e?0:Ni(e)},ji=Gi,Hi=Math.max,Xi=Math.min,Yi=Gi,Wi=Math.min,Ki=U,qi=function(t){return(e=t.length)>0?Wi(Yi(e),9007199254740991):0;var e},Zi=function(t){return function(e,i,s){var r,n=Ki(e),o=qi(n),a=function(t,e){var i=ji(t);return i<0?Hi(i+e,0):Xi(i,e)}(s,o);if(t&&i!=i){for(;o>a;)if((r=n[a++])!=r)return!0}else for(;o>a;a++)if((t||a in n)&&n[a]===i)return t||a||0;return!t&&-1}},Qi={includes:Zi(!0),indexOf:Zi(!1)},Ji=Ot,$i=U,ts=Qi.indexOf,es=si,is=T([].push),ss=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");Fi.f=Object.getOwnPropertyNames||function(t){return function(t,e){var i,s=$i(t),r=0,n=[];for(i in s)!Ji(es,i)&&Ji(s,i)&&is(n,i);for(;e.length>r;)Ji(s,i=e[r++])&&(~ts(n,i)||is(n,i));return n}(t,ss)};var rs={};rs.f=Object.getOwnPropertySymbols;var ns=q,os=Fi,as=rs,hs=be,ls=T([].concat),us=ns("Reflect","ownKeys")||function(t){var e=os.f(hs(t)),i=as.f;return i?ls(e,i(t)):e},ds=Ot,cs=us,ps=r,fs=me,gs=n,ms=j,ys=/#|\.prototype\./,vs=function(t,e){var i=_s[xs(t)];return i==ws||i!=bs&&(ms(e)?gs(e):!!e)},xs=vs.normalize=function(t){return String(t).replace(ys,".").toLowerCase()},_s=vs.data={},bs=vs.NATIVE="N",ws=vs.POLYFILL="P",Ts=vs,As=s,Es=r.f,Ss=Le,Cs=function(t,e,i,s){s||(s={});var r=s.enumerable,n=void 0!==s.name?s.name:e;if(Bi(i)&&Li(i,n,s),s.global)r?t[e]=i:Di(e,i);else{try{s.unsafe?t[e]&&(r=!0):delete t[e]}catch(t){}r?t[e]=i:Ri.f(t,e,{value:i,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return t},Ms=At,Ps=function(t,e,i){for(var s=cs(e),r=fs.f,n=ps.f,o=0;o<s.length;o++){var a=s[o];ds(t,a)||i&&ds(i,a)||r(t,a,n(e,a))}},Is=Ts,ks=function(t,e){var i,s,r,n,o,a=t.target,h=t.global,l=t.stat;if(i=h?As:l?As[a]||Ms(a,{}):(As[a]||{}).prototype)for(s in e){if(n=e[s],r=t.dontCallGetSet?(o=Es(i,s))&&o.value:i[s],!Is(h?s:a+(l?".":"#")+s,t.forced)&&void 0!==r){if(typeof n==typeof r)continue;Ps(n,r)}(t.sham||r&&r.sham)&&Ss(n,"sham",!0),Cs(i,s,n,t)}},Os=s;ks({global:!0,forced:Os.globalThis!==Os},{globalThis:Os});var Bs={};Bs[Kt("toStringTag")]="z";var Rs="[object z]"===String(Bs),Ls=j,Ds=C,Fs=Kt("toStringTag"),zs=Object,Us="Arguments"==Ds(function(){return arguments}()),Vs=Rs?Ds:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=zs(t),Fs))?i:Us?Ds(e):"Object"==(s=Ds(e))&&Ls(e.callee)?"Arguments":s},Ns=String,Gs="\t\n\v\f\r                　\u2028\u2029\ufeff",js=D,Hs=Gs,Xs=T("".replace),Ys="["+Hs+"]",Ws=RegExp("^"+Ys+Ys+"*"),Ks=RegExp(Ys+Ys+"*$"),qs=function(t){return function(e){var i=function(t){if("Symbol"===Vs(t))throw TypeError("Cannot convert a Symbol value to a string");return Ns(t)}(js(e));return 1&t&&(i=Xs(i,Ws,"")),2&t&&(i=Xs(i,Ks,"")),i}},Zs={start:qs(1),end:qs(2),trim:qs(3)},Qs=Ge.PROPER,Js=n,$s=Gs,tr=function(t){return Js((function(){return!!$s[t]()||"​᠎"!=="​᠎"[t]()||Qs&&$s[t].name!==t}))},er=Zs.start,ir=tr("trimStart")?function(){return er(this)}:"".trimStart;ks({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==ir},{trimLeft:ir}),ks({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==ir},{trimStart:ir});var sr=s,rr=T,nr=function(t,e){return rr(sr[t].prototype[e])};nr("String","trimLeft");var or=Zs.end,ar=tr("trimEnd")?function(){return or(this)}:"".trimEnd;if(ks({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==ar},{trimRight:ar}),ks({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==ar},{trimEnd:ar}),nr("String","trimRight"),"undefined"!=typeof globalThis&&void 0===globalThis.console&&(globalThis.console={},globalThis.console.log=function(){},globalThis.console.assert=function(){},globalThis.console.warn=function(){},globalThis.console.error=function(){alert(Array.prototype.slice.call(arguments).join(", "))}),"performance"in globalThis==0&&(globalThis.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in globalThis.performance==0){var hr=Date.now();performance.timing&&performance.timing.navigationStart&&(hr=performance.timing.navigationStart),globalThis.performance.now=function(){return Date.now()-hr}}function lr(t){return t.charAt(0).toUpperCase()+t.slice(1)}function ur(t){return"string"==typeof t&&(t=t.trim()),!isNaN(t)&&/[+-]?([0-9]*[.])?[0-9]+/.test(t)}function dr(t){var e=t.trim();return"true"===e||"false"===e}function cr(t){for(var e="",i=0;i<t.length;)e+=t.charCodeAt(i++).toString(16);return e}function pr(t){return/^data:(.+);base64,(.+)$/.test(t)}var fr=Object.freeze({__proto__:null,capitalize:lr,isNumeric:ur,isBoolean:dr,toHex:cr,isDataUrl:pr});const gr=["ms","MS","moz","webkit","o"];function mr(t,e){if(t in(e=e||globalThis))return e[t];var i,s=lr(t);return gr.some((function(t){var r=t+s;return i=r in e?e[r]:void 0})),i}function yr(t,e,i){if(!(t in(i=i||globalThis))){var s=lr(t);return gr.some((function(t){var r=t+s;if(r in i)return i[r]=e,!0})),!1}i[t]=e}var vr=Object.freeze({__proto__:null,prefixed:mr,setPrefixed:yr});const xr=Math.PI/180,_r=(Math.PI,2*Math.PI),br=.5*Math.PI;function wr(t){return 0==(t&t-1)}function Tr(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Ar(t){return t*xr}function Er(t,e,i){return t<e?e:t>i?i:+t}function Sr(t,e){return~~(Math.random()*(e-t))+t}function Cr(t,e){return Math.random()*(e-t)+t}function Mr(t,e,i=2){return Math.abs(t-e)<Math.pow(10,-i)/2}function Pr(t,e){var i=Array.prototype.indexOf.call(t,e);return-1!==i&&Array.prototype.splice.call(t,i,1),t}var Ir=Object.freeze({__proto__:null,remove:Pr,random:function(t){return t[Sr(0,t.length)]},weightedRandom:function(t){return t[function(t,e){return~~(Math.pow(Math.random(),2)*(e-t))+t}(0,t.length)]}});const kr=/^.*(\\|\/|\:)/,Or=/\.[^\.]*$/;function Br(t){return t.replace(kr,"").replace(Or,"")}function Rr(t){return t.substring(t.lastIndexOf(".")+1,t.length)}var Lr=Object.freeze({__proto__:null,getBasename:Br,getExtension:Rr});function Dr(t,e,...i){return setTimeout(t.bind(e),.01,...i)}function Fr(t,e,i){var s,r=globalThis.performance.now();return"boolean"!=typeof i&&(i=!1),function(){var n=globalThis.performance.now(),o=n-r,a=arguments;if(!(o<e))return r=n,t.apply(null,a);!1===i&&(clearTimeout(s),s=setTimeout((function(){return r=n,t.apply(null,a)}),o))}}var zr=Object.freeze({__proto__:null,defer:Dr,throttle:Fr}),Ur=new class{constructor(){this.objectClass={},this.instance_counter=0}register(t,e,i=!1){if(void 0===e)throw new Error("Cannot register object '"+t+"', invalid class");this.objectClass[t]={class:e,pool:i?[]:void 0}}pull(t){for(var e=new Array(arguments.length),i=0;i<arguments.length;i++)e[i]=arguments[i];var s=this.objectClass[t];if(s){var r,n=s.class,o=s.pool;return o&&(r=o.pop())?(e.shift(),"function"==typeof r.onResetEvent&&r.onResetEvent.apply(r,e),this.instance_counter--):(e[0]=n,r=new(n.bind.apply(n,e)),o&&(r.className=t)),r}throw new Error("Cannot instantiate object of type '"+t+"'")}purge(){for(var t in this.objectClass)this.objectClass[t]&&(this.objectClass[t].pool=[]);this.instance_counter=0}push(t,e=!0){if(!this.poolable(t)){if(!0===e)throw new Error("me.pool: object "+t+" cannot be recycled");return!1}return this.objectClass[t.className].pool.push(t),this.instance_counter++,!0}exists(t){return t in this.objectClass}poolable(t){var e=t.className;return void 0!==e&&"function"==typeof t.onResetEvent&&e in this.objectClass&&void 0!==this.objectClass[e].pool}getInstanceCount(){return this.instance_counter}};class Vr{constructor(t=0,e=0){this.onResetEvent(t,e)}onResetEvent(t=0,e=0){return this.x=t,this.y=e,this}_set(t,e){return this.x=t,this.y=e,this}set(t,e){if(t!==+t||e!==+e)throw new Error("invalid x,y parameters (not a number)");return this._set(t,e)}setZero(){return this.set(0,0)}setV(t){return this._set(t.x,t.y)}add(t){return this._set(this.x+t.x,this.y+t.y)}sub(t){return this._set(this.x-t.x,this.y-t.y)}scale(t,e){return this._set(this.x*t,this.y*(void 0!==e?e:t))}toIso(){return this._set(this.x-this.y,.5*(this.x+this.y))}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2)}scaleV(t){return this._set(this.x*t.x,this.y*t.y)}div(t){return this._set(this.x/t,this.y/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(t,e){return new Vr(Er(this.x,t,e),Er(this.y,t,e))}clampSelf(t,e){return this._set(Er(this.x,t,e),Er(this.y,t,e))}minV(t){return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y)}maxV(t){return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y)}floor(){return new Vr(Math.floor(this.x),Math.floor(this.y))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y))}ceil(){return new Vr(Math.ceil(this.x),Math.ceil(this.y))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}negate(){return new Vr(-this.x,-this.y)}negateSelf(){return this._set(-this.x,-this.y)}copy(t){return this._set(t.x,t.y)}equals(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x)}rotate(t,e){var i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);var r=this.x-i,n=this.y-s,o=Math.cos(t),a=Math.sin(t);return this._set(r*o-n*a+i,r*a+n*o+s)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}moveTowards(t,e){var i=Math.atan2(t.y-this.y,t.x-this.x),s=this.distance(t);return 0===s||e>=0&&s<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}angle(t){return Math.acos(Er(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){return this.scale(this.dot(t)/t.length2())}projectN(t){return this.scale(this.dot(t))}clone(){return Ur.pull("Vector2d",this.x,this.y)}toString(){return"x:"+this.x+",y:"+this.y}}function Nr(t){return"0123456789ABCDEF".charAt(t-t%16>>4)+"0123456789ABCDEF".charAt(t%16)}function Gr(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}const jr=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,Hr=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Xr=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Yr=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,Wr=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;var Kr=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach((function(t){Kr.set(t[0],t[1])}));class qr{constructor(t=0,e=0,i=0,s=1){this.onResetEvent(t,e,i,s)}onResetEvent(t=0,e=0,i=0,s=1){return void 0===this.glArray&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(t,e,i,s)}get r(){return~~(255*this.glArray[0])}set r(t){this.glArray[0]=Er(~~t||0,0,255)/255}get g(){return~~(255*this.glArray[1])}set g(t){this.glArray[1]=Er(~~t||0,0,255)/255}get b(){return~~(255*this.glArray[2])}set b(t){this.glArray[2]=Er(~~t||0,0,255)/255}get alpha(){return this.glArray[3]}set alpha(t){this.glArray[3]=void 0===t?1:Er(+t,0,1)}setColor(t,e,i,s=1){return this.r=t,this.g=e,this.b=i,this.alpha=s,this}setHSV(t,e,i){var s,r,n,o=Math.floor(6*t),a=6*t-o,h=i*(1-e),l=i*(1-a*e),u=i*(1-(1-a)*e);switch(o%6){case 0:s=i,r=u,n=h;break;case 1:s=l,r=i,n=h;break;case 2:s=h,r=i,n=u;break;case 3:s=h,r=l,n=i;break;case 4:s=u,r=h,n=i;break;case 5:s=i,r=h,n=l}return this.setColor(255*s,255*r,255*n)}setHSL(t,e,i){var s,r,n;if(0===e)s=r=n=i;else{var o=i<.5?i*(1+e):i+e-i*e,a=2*i-o;s=Gr(a,o,t+1/3),r=Gr(a,o,t),n=Gr(a,o,t-1/3)}return this.setColor(255*s,255*r,255*n)}clone(){return Ur.pull("Color").copy(this)}copy(t){return t instanceof qr?(this.glArray.set(t.glArray),this):this.parseCSS(t)}add(t){return this.glArray[0]=Er(this.glArray[0]+t.glArray[0],0,1),this.glArray[1]=Er(this.glArray[1]+t.glArray[1],0,1),this.glArray[2]=Er(this.glArray[2]+t.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+t.glArray[3])/2,this}darken(t){return t=Er(t,0,1),this.glArray[0]*=t,this.glArray[1]*=t,this.glArray[2]*=t,this}lerp(t,e){return e=Er(e,0,1),this.glArray[0]+=(t.glArray[0]-this.glArray[0])*e,this.glArray[1]+=(t.glArray[1]-this.glArray[1])*e,this.glArray[2]+=(t.glArray[2]-this.glArray[2])*e,this}lighten(t){return t=Er(t,0,1),this.glArray[0]=Er(this.glArray[0]+(1-this.glArray[0])*t,0,1),this.glArray[1]=Er(this.glArray[1]+(1-this.glArray[1])*t,0,1),this.glArray[2]=Er(this.glArray[2]+(1-this.glArray[2])*t,0,1),this}random(t=0,e=255){return t<0&&(t=0),e>255&&(e=255),this.setColor(Sr(t,e),Sr(t,e),Sr(t,e),this.alpha)}equals(t){return this.glArray[0]===t.glArray[0]&&this.glArray[1]===t.glArray[1]&&this.glArray[2]===t.glArray[2]&&this.glArray[3]===t.glArray[3]}parseCSS(t){return Kr.has(t)?this.setColor.apply(this,Kr.get(t)):this.parseRGB(t)}parseRGB(t){var e=jr.exec(t);return e?this.setColor(+e[1],+e[2],+e[3],+e[5]):this.parseHex(t)}parseHex(t,e=!1){var i;if(i=Wr.exec(t))return this.setColor(parseInt(i[!1===e?1:2],16),parseInt(i[!1===e?2:3],16),parseInt(i[!1===e?3:4],16),(Er(parseInt(i[!1===e?4:1],16),0,255)/255).toFixed(1));if(i=Yr.exec(t))return this.setColor(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16));if(i=Xr.exec(t)){var s=i[!1===e?1:2],r=i[!1===e?2:3],n=i[!1===e?3:4],o=i[!1===e?4:1];return this.setColor(parseInt(s+s,16),parseInt(r+r,16),parseInt(n+n,16),(Er(parseInt(o+o,16),0,255)/255).toFixed(1))}if(i=Hr.exec(t))return this.setColor(parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16));throw new Error("invalid parameter: "+t)}toUint32(t=1){return((255*t&255)<<24)+((255&this.r)<<16)+((255&this.g)<<8)+(255&this.b)}toArray(){return this.glArray}toHex(){return"#"+Nr(this.r)+Nr(this.g)+Nr(this.b)}toHex8(t=this.alpha){return"#"+Nr(this.r)+Nr(this.g)+Nr(this.b)+Nr(255*t)}toRGB(){return"rgb("+this.r+","+this.g+","+this.b+")"}toRGBA(t=this.alpha){return"rgba("+this.r+","+this.g+","+this.b+","+t+")"}}class Zr{constructor(...t){this.onResetEvent(...t)}onResetEvent(){void 0===this.val&&(this.val=new Float32Array(16)),arguments.length&&arguments[0]instanceof Zr?this.copy(arguments[0]):16===arguments.length?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[12]}get ty(){return this.val[13]}get tz(){return this.val[14]}identity(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setTransform(t,e,i,s,r,n,o,a,h,l,u,d,c,p,f,g){var m=this.val;return m[0]=t,m[1]=e,m[2]=i,m[3]=s,m[4]=r,m[5]=n,m[6]=o,m[7]=a,m[8]=h,m[9]=l,m[10]=u,m[11]=d,m[12]=c,m[13]=p,m[14]=f,m[15]=g,this}copy(t){return this.val.set(t.val),this}fromMat2d(t){var e=t.val;return this.setTransform(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1)}multiply(t){var e=this.val,i=t.val,s=e[0],r=e[1],n=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],d=e[8],c=e[9],p=e[10],f=e[11],g=e[12],m=e[13],y=e[14],v=e[15],x=i[0],_=i[1],b=i[2],w=i[3];return e[0]=x*s+_*a+b*d+w*g,e[1]=x*r+_*h+b*c+w*m,e[2]=x*n+_*l+b*p+w*y,e[3]=x*o+_*u+b*f+w*v,x=i[4],_=i[5],b=i[6],w=i[7],e[4]=x*s+_*a+b*d+w*g,e[5]=x*r+_*h+b*c+w*m,e[6]=x*n+_*l+b*p+w*y,e[7]=x*o+_*u+b*f+w*v,x=i[8],_=i[9],b=i[10],w=i[11],e[8]=x*s+_*a+b*d+w*g,e[9]=x*r+_*h+b*c+w*m,e[10]=x*n+_*l+b*p+w*y,e[11]=x*o+_*u+b*f+w*v,x=i[12],_=i[13],b=i[14],w=i[15],e[12]=x*s+_*a+b*d+w*g,e[13]=x*r+_*h+b*c+w*m,e[14]=x*n+_*l+b*p+w*y,e[15]=x*o+_*u+b*f+w*v,this}transpose(){var t=this.val,e=t[1],i=t[2],s=t[3],r=t[6],n=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=r,t[11]=t[14],t[12]=s,t[13]=n,t[14]=o,this}invert(){var t=this.val,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],o=t[5],a=t[6],h=t[7],l=t[8],u=t[9],d=t[10],c=t[11],p=t[12],f=t[13],g=t[14],m=t[15],y=e*o-i*n,v=e*a-s*n,x=e*h-r*n,_=i*a-s*o,b=i*h-r*o,w=s*h-r*a,T=l*f-u*p,A=l*g-d*p,E=l*m-c*p,S=u*g-d*f,C=u*m-c*f,M=d*m-c*g,P=y*M-v*C+x*S+_*E-b*A+w*T;return P?(P=1/P,t[0]=(o*M-a*C+h*S)*P,t[1]=(s*C-i*M-r*S)*P,t[2]=(f*w-g*b+m*_)*P,t[3]=(d*b-u*w-c*_)*P,t[4]=(a*E-n*M-h*A)*P,t[5]=(e*M-s*E+r*A)*P,t[6]=(g*x-p*w-m*v)*P,t[7]=(l*w-d*x+c*v)*P,t[8]=(n*C-o*E+h*T)*P,t[9]=(i*E-e*C-r*T)*P,t[10]=(p*b-f*x+m*y)*P,t[11]=(u*x-l*b-c*y)*P,t[12]=(o*A-n*S-a*T)*P,t[13]=(e*S-i*A+s*T)*P,t[14]=(f*v-p*_-g*y)*P,t[15]=(l*_-u*v+d*y)*P,this):null}apply(t){var e=this.val,i=t.x,s=t.y,r=void 0!==t.z?t.z:1,n=e[3]*i+e[7]*s+e[11]*r+e[15]||1;return t.x=(e[0]*i+e[4]*s+e[8]*r+e[12])/n,t.y=(e[1]*i+e[5]*s+e[9]*r+e[13])/n,void 0!==t.z&&(t.z=(e[2]*i+e[6]*s+e[10]*r+e[14])/n),t}applyInverse(t){var e=Ur.pull("Matrix3d",this).invert();return e.apply(t),Ur.push(e),t}ortho(t,e,i,s,r,n){var o=this.val,a=1/(t-e),h=1/(i-s),l=1/(r-n);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*l,o[11]=0,o[12]=(t+e)*a,o[13]=(s+i)*h,o[14]=(n+r)*l,o[15]=1,this}scale(t,e,i){var s=this.val,r=t,n=void 0===e?r:e,o=void 0===i?0:i;return s[0]=s[0]*r,s[1]=s[1]*r,s[2]=s[2]*r,s[3]=s[3]*r,s[4]=s[4]*n,s[5]=s[5]*n,s[6]=s[6]*n,s[7]=s[7]*n,s[8]=s[8]*o,s[9]=s[9]*o,s[10]=s[10]*o,s[11]=s[11]*o,this}scaleV(t){return this.scale(t.x,t.y,t.z)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t,e){if(0!==t){var i,s,r,n,o,a,h,l,u,d,c,p,f,g,m,y,v,x,_,b,w,T,A,E,S=this.val,C=e.x,M=e.y,P=e.z,I=Math.sqrt(C*C+M*M+P*P);if(I<1e-6)return null;C*=I=1/I,M*=I,P*=I,i=Math.sin(t),r=1-(s=Math.cos(t)),n=S[0],o=S[1],a=S[2],h=S[3],l=S[4],u=S[5],d=S[6],c=S[7],p=S[8],f=S[9],g=S[10],m=S[11],y=C*C*r+s,v=M*C*r+P*i,x=P*C*r-M*i,_=C*M*r-P*i,b=M*M*r+s,w=P*M*r+C*i,T=C*P*r+M*i,A=M*P*r-C*i,E=P*P*r+s,S[0]=n*y+l*v+p*x,S[1]=o*y+u*v+f*x,S[2]=a*y+d*v+g*x,S[3]=h*y+c*v+m*x,S[4]=n*_+l*b+p*w,S[5]=o*_+u*b+f*w,S[6]=a*_+d*b+g*w,S[7]=h*_+c*b+m*w,S[8]=n*T+l*A+p*E,S[9]=o*T+u*A+f*E,S[10]=a*T+d*A+g*E,S[11]=h*T+c*A+m*E}return this}translate(){var t,e,i,s=this.val;return arguments.length>1?(t=arguments[0],e=arguments[1],i=void 0===arguments[2]?0:arguments[2]):(t=arguments[0].x,e=arguments[0].y,i=void 0===arguments[0].z?0:arguments[0].z),s[12]=s[0]*t+s[4]*e+s[8]*i+s[12],s[13]=s[1]*t+s[5]*e+s[9]*i+s[13],s[14]=s[2]*t+s[6]*e+s[10]*i+s[14],s[15]=s[3]*t+s[7]*e+s[11]*i+s[15],this}isIdentity(){var t=this.val;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}equals(t){var e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]}clone(){return Ur.pull("Matrix3d",this)}toArray(){return this.val}toString(){var t=this.val;return"me.Matrix3d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}}class Qr{constructor(...t){this.onResetEvent(...t)}onResetEvent(){return void 0===this.val&&(this.val=new Float32Array(9)),arguments.length&&arguments[0]instanceof Qr?this.copy(arguments[0]):arguments.length&&arguments[0]instanceof Zr?this.fromMat3d(arguments[0]):arguments.length>=6?this.setTransform.apply(this,arguments):this.identity(),this}get tx(){return this.val[6]}get ty(){return this.val[7]}identity(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}setTransform(){var t=this.val;return 9===arguments.length?(t[0]=arguments[0],t[1]=arguments[1],t[2]=arguments[2],t[3]=arguments[3],t[4]=arguments[4],t[5]=arguments[5],t[6]=arguments[6],t[7]=arguments[7],t[8]=arguments[8]):6===arguments.length&&(t[0]=arguments[0],t[1]=arguments[2],t[2]=arguments[4],t[3]=arguments[1],t[4]=arguments[3],t[5]=arguments[5],t[6]=0,t[7]=0,t[8]=1),this}copy(t){return this.val.set(t.val),this}fromMat3d(t){var e=t.val,i=this.val;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this}multiply(t){var e=t.val,i=this.val,s=i[0],r=i[1],n=i[3],o=i[4],a=e[0],h=e[1],l=e[3],u=e[4],d=e[6],c=e[7];return i[0]=s*a+n*h,i[1]=r*a+o*h,i[3]=s*l+n*u,i[4]=r*l+o*u,i[6]+=s*d+n*c,i[7]+=r*d+o*c,this}transpose(){var t=this.val,e=t[1],i=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=e,t[5]=t[7],t[6]=i,t[7]=s,this}invert(){var t=this.val,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],o=t[5],a=t[6],h=t[7],l=t[8],u=l*n-o*h,d=o*a-l*r,c=h*r-n*a,p=e*u+i*d+s*c;return t[0]=u/p,t[1]=(s*h-l*i)/p,t[2]=(o*i-s*n)/p,t[3]=d/p,t[4]=(l*e-s*a)/p,t[5]=(s*r-o*e)/p,t[6]=c/p,t[7]=(i*a-h*e)/p,t[8]=(n*e-i*r)/p,this}apply(t){var e=this.val,i=t.x,s=t.y,r=void 0!==t.z?t.z:1;return t.x=i*e[0]+s*e[3]+r*e[6],t.y=i*e[1]+s*e[4]+r*e[7],void 0!==t.z&&(t.z=i*e[2]+s*e[5]+r*e[8]),t}applyInverse(t){var e=this.val,i=t.x,s=t.y,r=1/(e[0]*e[4]+e[3]*-e[1]);return t.x=e[4]*r*i+-e[3]*r*s+(e[7]*e[3]-e[6]*e[4])*r,t.y=e[0]*r*s+-e[1]*r*i+(-e[7]*e[0]+e[6]*e[1])*r,t}scale(t,e){var i=this.val,s=t,r=void 0===e?s:e;return i[0]*=s,i[1]*=s,i[3]*=r,i[4]*=r,this}scaleV(t){return this.scale(t.x,t.y)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t){if(0!==t){var e=this.val,i=e[0],s=e[1],r=e[2],n=e[3],o=e[4],a=e[5],h=Math.sin(t),l=Math.cos(t);e[0]=l*i+h*n,e[1]=l*s+h*o,e[2]=l*r+h*a,e[3]=l*n-h*i,e[4]=l*o-h*s,e[5]=l*a-h*r}return this}translate(){var t,e,i=this.val;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),i[6]+=i[0]*t+i[3]*e,i[7]+=i[1]*t+i[4]*e,this}isIdentity(){var t=this.val;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]}equals(t){var e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]}clone(){return Ur.pull("Matrix2d",this)}toArray(){return this.val}toString(){var t=this.val;return"me.Matrix2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}}var Jr={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function s(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,s,n,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new r(s,n||t,o),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,s,r=[];if(0===this._eventsCount)return r;for(s in t=this._events)e.call(t,s)&&r.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},a.prototype.listeners=function(t){var e=i?i+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,n=s.length,o=new Array(n);r<n;r++)o[r]=s[r].fn;return o},a.prototype.listenerCount=function(t){var e=i?i+t:t,s=this._events[e];return s?s.fn?1:s.length:0},a.prototype.emit=function(t,e,s,r,n,o){var a=i?i+t:t;if(!this._events[a])return!1;var h,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,s),!0;case 4:return u.fn.call(u.context,e,s,r),!0;case 5:return u.fn.call(u.context,e,s,r,n),!0;case 6:return u.fn.call(u.context,e,s,r,n,o),!0}for(l=1,h=new Array(d-1);l<d;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var c,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,s);break;case 4:u[l].fn.call(u[l].context,e,s,r);break;default:if(!h)for(c=1,h=new Array(d-1);c<d;c++)h[c-1]=arguments[c];u[l].fn.apply(u[l].context,h)}}return!0},a.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,s,r){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return o(this,n),this;var a=this._events[n];if(a.fn)a.fn!==e||r&&!a.once||s&&a.context!==s||o(this,n);else{for(var h=0,l=[],u=a.length;h<u;h++)(a[h].fn!==e||r&&!a[h].once||s&&a[h].context!==s)&&l.push(a[h]);l.length?this._events[n]=1===l.length?l[0]:l:o(this,n)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}(Jr);var $r=new(0,Jr.exports);const tn="dom_ready",en="me.boot",sn="me.state.onPause",rn="me.state.onResume",nn="me.state.onStop",on="me.state.onRestart",an="me.state.onChange",hn="me.video.onInit",ln="me.game.onInit",un="me.game.onReset",dn="me.game.beforeUpdate",cn="me.game.afterUpdate",pn="me.game.onUpdate",fn="me.game.beforeDraw",gn="me.game.afterDraw",mn="me.game.onLevelLoaded",yn="me.loader.onload",vn="me.loader.onProgress",xn="me.input.keydown",_n="me.input.keyup",bn="gamepad.connected",wn="gamepad.disconnected",Tn="gamepad.update",An="me.event.pointermove",En="me.event.pointerlockChange",Sn="globalThis.onresize",Cn="canvas.onresize",Mn="viewport.onresize",Pn="globalThis.orientationchange",In="globalThis.onscroll",kn="viewport.onchange",On="renderer.contextlost",Bn="renderer.contextrestored";function Rn(t,...e){return $r.emit(t,...e)}function Ln(t,e,i){return $r.on(t,e,i)}function Dn(t,e,i){return $r.once(t,e,i)}function Fn(t,e){return $r.off(t,e)}var zn=Object.freeze({__proto__:null,DOM_READY:tn,BOOT:en,STATE_PAUSE:sn,STATE_RESUME:rn,STATE_STOP:nn,STATE_RESTART:on,STATE_CHANGE:an,VIDEO_INIT:hn,GAME_INIT:ln,GAME_RESET:un,GAME_BEFORE_UPDATE:dn,GAME_AFTER_UPDATE:cn,GAME_UPDATE:pn,GAME_BEFORE_DRAW:fn,GAME_AFTER_DRAW:gn,LEVEL_LOADED:mn,LOADER_COMPLETE:yn,LOADER_PROGRESS:vn,KEYDOWN:xn,KEYUP:_n,GAMEPAD_CONNECTED:bn,GAMEPAD_DISCONNECTED:wn,GAMEPAD_UPDATE:Tn,POINTERMOVE:An,POINTERLOCKCHANGE:En,DRAGSTART:"me.game.dragstart",DRAGEND:"me.game.dragend",WINDOW_ONRESIZE:Sn,CANVAS_ONRESIZE:Cn,VIEWPORT_ONRESIZE:Mn,WINDOW_ONORIENTATION_CHANGE:Pn,WINDOW_ONSCROLL:In,VIEWPORT_ONCHANGE:kn,ONCONTEXT_LOST:On,ONCONTEXT_RESTORED:Bn,emit:Rn,on:Ln,once:Dn,off:Fn}),Un={};let Vn=!1;try{Vn="undefined"!=typeof globalThis&&void 0!==globalThis.localStorage}catch(t){Vn=!1}function Nn(t){return"add"===t||"remove"===t}Ln(en,(()=>{if(!0===Vn){var t=globalThis.localStorage.getItem("me.save");"string"==typeof t&&t.length>0&&(JSON.parse(t)||[]).forEach((function(t){Un[t]=JSON.parse(globalThis.localStorage.getItem("me.save."+t))}))}}));var Gn={add(t){var e=Gn;Object.keys(t).forEach((function(i){var s;Nn(i)||(s=i,Object.defineProperty(e,s,{configurable:!0,enumerable:!0,get(){return Un[s]},set(t){Un[s]=t,!0===Vn&&globalThis.localStorage.setItem("me.save."+s,JSON.stringify(t))}}),i in Un||(e[i]=t[i]))})),!0===Vn&&globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Un)))},remove(t){Nn(t)||void 0!==Un[t]&&(delete Un[t],!0===Vn&&(globalThis.localStorage.removeItem("me.save."+t),globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Un)))))}};let jn=!1,Hn=!1;function Xn(){if(!Hn){if(void 0!==globalThis.document&&!globalThis.document.body)return setTimeout(Xn,13);void 0!==globalThis.document&&"function"==typeof globalThis.document.removeEventListener&&globalThis.document.removeEventListener("DOMContentLoaded",Xn,!1),"function"==typeof globalThis.removeEventListener&&globalThis.removeEventListener("load",Xn,!1),Rn(tn),Hn=!0}}const Yn=void 0!==globalThis.navigator?globalThis.navigator.userAgent:"",Wn=/iPhone|iPad|iPod/i.test(Yn),Kn=/Android/i.test(Yn),qn=/Android 2/i.test(Yn),Zn=/Linux/i.test(Yn),Qn=/CrOS/.test(Yn),Jn=/Windows Phone/i.test(Yn),$n=/BlackBerry/i.test(Yn),to=/Kindle|Silk.*Mobile Safari/i.test(Yn),eo=void 0!==globalThis.ejecta,io=/MicroMessenger/i.test(Yn),so=void 0!==globalThis.process&&void 0!==globalThis.process.release&&"node"===globalThis.process.release.name,ro=/Mobi/i.test(Yn)||Wn||Kn||Jn||$n||to||!1;let no=!1,oo=!1,ao=!0,ho={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0};function lo(t){return t.preventDefault(),"function"==typeof globalThis.scroll&&globalThis.scroll(0,0),!1}function uo(t){Bo=t.accelerationIncludingGravity.x,Ro=t.accelerationIncludingGravity.y,Lo=t.accelerationIncludingGravity.z}function co(t){Do=t.gamma,Fo=t.beta,zo=t.alpha}let po=Object.freeze({__proto__:null,ua:Yn,iOS:Wn,android:Kn,android2:qn,linux:Zn,chromeOS:Qn,wp:Jn,BlackBerry:$n,Kindle:to,ejecta:eo,isWeixin:io,nodeJS:so,isMobile:ro});const fo=!!("ontouchstart"in globalThis),go=!!globalThis.PointerEvent,mo=fo||go,yo=mo?go?globalThis.navigator.maxTouchPoints||1:10:1,vo=void 0!==globalThis.document&&"onwheel"in globalThis.document.createElement("div"),xo=void 0!==globalThis.document&&void 0!==globalThis.document.pointerLockElement,_o=!!globalThis.DeviceOrientationEvent,bo="undefined"!=typeof screen&&void 0!==screen.orientation,wo=!!globalThis.DeviceMotionEvent,To=void 0!==globalThis.document&&(mr("fullscreenEnabled",globalThis.document)||globalThis.document.mozFullScreenEnabled);!0===To&&(globalThis.document.exitFullscreen=mr("cancelFullScreen",globalThis.document)||mr("exitFullscreen",globalThis.document));const Ao=!(!globalThis.AudioContext&&!globalThis.webkitAudioContext),Eo=void 0!==globalThis.Audio,So=Ao||Eo,Co=function(){try{return!!globalThis.localStorage}catch(t){return!1}}(),Mo=function(){try{return void 0!==globalThis.OffscreenCanvas&&null!==new globalThis.OffscreenCanvas(0,0).getContext("2d")}catch(t){return!1}}(),Po="function"==typeof globalThis.atob,Io=void 0!==globalThis.navigator&&(globalThis.navigator.language||globalThis.navigator.browserLanguage||globalThis.navigator.userLanguage)||"en",ko=globalThis.devicePixelRatio||1,Oo=po.isMobile;let Bo=0,Ro=0,Lo=0,Do=0,Fo=0,zo=0;function Uo(t){!function(t){Hn?t.call(globalThis,[]):(Dn(tn,t,globalThis),jn||("undefined"!=typeof process&&"node"===process.release.name||void 0!==globalThis.document&&"complete"===globalThis.document.readyState?globalThis.setTimeout(Xn,0):(void 0!==globalThis.document&&"function"==typeof globalThis.document.addEventListener&&globalThis.document.addEventListener("DOMContentLoaded",Xn,!1),globalThis.addEventListener("load",Xn,!1)),jn=!0))}(t)}function Vo(t){let e=go?"pointermove":fo?"touchmove":"mousemove";!1!==t?!1===ao&&(globalThis.document.removeEventListener(e,lo),ao=!0):!0===ao&&(globalThis.document.addEventListener(e,lo,{passive:!1}),ao=!1)}function No(){return!(!To||!mr("fullscreenElement",document)&&!document.mozFullScreenElement)}function Go(){const t="portrait",e="landscape";let i=globalThis.screen;if(!0===bo){let t=mr("orientation",i);if(void 0!==t&&"string"==typeof t.type)return t.type;if("string"==typeof t)return t}return"number"==typeof globalThis.orientation?90===Math.abs(globalThis.orientation)?e:t:globalThis.outerWidth>globalThis.outerHeight?e:t}function jo(t){let e=Ho(t);return null!==e.parentNode&&(e=e.parentNode),e}function Ho(t){let e=null;return"undefined"!==t&&("string"==typeof t?e=document.getElementById(t):"object"==typeof t&&t.nodeType===Node.ELEMENT_NODE&&(e=t)),e||(e=document.body),e}function Xo(t){return"object"==typeof t&&t!==document.body&&void 0!==t.getBoundingClientRect?t.getBoundingClientRect():(ho.width=ho.right=globalThis.innerWidth,ho.height=ho.bottom=globalThis.innerHeight,ho)}function Yo(t){return Xo(jo(t))}function Wo(t){let e=!1;try{let i=document.createElement("canvas"),s={stencil:!0,failIfMajorPerformanceCaveat:t.failIfMajorPerformanceCaveat};e=!(!globalThis.WebGLRenderingContext||!i.getContext("webgl",s)&&!i.getContext("experimental-webgl",s))}catch(t){e=!1}return e}function Ko(t){return t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0?"highp":t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}function qo(){"function"==typeof globalThis.focus&&globalThis.focus()}var Zo=Object.freeze({__proto__:null,onDeviceRotate:co,platform:po,touchEvent:fo,pointerEvent:go,touch:mo,maxTouchPoints:yo,wheel:vo,hasPointerLockSupport:xo,hasDeviceOrientation:_o,screenOrientation:bo,hasAccelerometer:wo,hasFullscreenSupport:To,hasWebAudio:Ao,hasHTML5Audio:Eo,sound:So,localStorage:Co,offscreenCanvas:Mo,nativeBase64:Po,language:Io,devicePixelRatio:ko,isMobile:Oo,get accelerationX(){return Bo},get accelerationY(){return Ro},get accelerationZ(){return Lo},get gamma(){return Do},get beta(){return Fo},get alpha(){return zo},pauseOnBlur:!0,resumeOnFocus:!0,autoFocus:!0,stopOnBlur:!1,onReady:Uo,enableSwipe:Vo,isFullscreen:No,requestFullscreen:function(t){To&&!No()&&((t=t||Md()).requestFullscreen=mr("requestFullscreen",t)||t.mozRequestFullScreen,t.requestFullscreen())},exitFullscreen:function(){To&&No()&&document.exitFullscreen()},getScreenOrientation:Go,lockOrientation:function(t){let e=globalThis.screen;if(void 0!==e){let i=mr("lockOrientation",e);if(void 0!==i)return i(t)}return!1},unlockOrientation:function(){let t=globalThis.screen;if(void 0!==t){let e=mr("unlockOrientation",t);if(void 0!==e)return e()}return!1},isPortrait:function(){return Go().includes("portrait")},isLandscape:function(){return Go().includes("landscape")},getStorage:function(t="local"){if("local"===t)return Gn;throw new Error("storage type "+t+" not supported")},getParentElement:jo,getElement:Ho,getElementBounds:Xo,getParentBounds:Yo,isWebGLSupported:Wo,getMaxShaderPrecision:Ko,focus:qo,watchAccelerometer:function(){return wo&&!no&&(DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&(globalThis.addEventListener("devicemotion",uo,!1),no=!0)})).catch(console.error):(globalThis.addEventListener("devicemotion",uo,!1),no=!0)),no},unwatchAccelerometer:function(){no&&(globalThis.removeEventListener("devicemotion",uo,!1),no=!1)},watchDeviceOrientation:function(){return _o&&!oo&&("function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&(globalThis.addEventListener("deviceorientation",co,!1),oo=!0)})).catch(console.error):(globalThis.addEventListener("deviceorientation",co,!1),oo=!0)),oo},unwatchDeviceOrientation:function(){oo&&(globalThis.removeEventListener("deviceorientation",co,!1),oo=!1)},vibrate:function(t){void 0!==globalThis.navigator&&"function"==typeof globalThis.navigator.vibrate&&globalThis.navigator.vibrate(t)}});const Qo={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function Jo(t,e,i){var s=t.createShader(e);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(s));return s}function $o(t,e){return"precision"!==t.substring(0,9)?"precision "+e+" float;"+t:t}function ta(t){return(t=(t=(t=t.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")).replace(/(\\n\s+)|(\s+\\n)/g,"")).replace(/(\\r|\\n)+/g,"")).replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1")}class ea{constructor(t,e,i,s){this.gl=t,this.vertex=$o(ta(e),s||Ko(this.gl)),this.fragment=$o(ta(i),s||Ko(this.gl)),this.attributes=function(t,e){for(var i,s={},r=/attribute\s+\w+\s+(\w+)/g,n=0;i=r.exec(e.vertex);)s[i[1]]=n++;return s}(this.gl,this),this.program=function(t,e,i,s){var r=Jo(t,t.VERTEX_SHADER,e),n=Jo(t,t.FRAGMENT_SHADER,i),o=t.createProgram();for(var a in t.attachShader(o,r),t.attachShader(o,n),s)t.bindAttribLocation(o,s[a],a);if(t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){var h="Error initializing Shader "+this+"\ngl.VALIDATE_STATUS: "+t.getProgramParameter(o,t.VALIDATE_STATUS)+"\ngl.getError()"+t.getError()+"\ngl.getProgramInfoLog()"+t.getProgramInfoLog(o);throw t.deleteProgram(o),o=null,new Error(h)}return t.useProgram(o),t.deleteShader(r),t.deleteShader(n),o}(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=function(t,e){var i,s={},r=/uniform\s+(\w+)\s+(\w+)/g,n={},o={},a={};return[e.vertex,e.fragment].forEach((function(t){for(;i=r.exec(t);)n[i[2]]=i[1]})),Object.keys(n).forEach((function(i){var s=n[i];a[i]=t.getUniformLocation(e.program,i),o[i]={get:function(t){return function(){return a[t]}}(i),set:function(e,i,s){return 0===i.indexOf("mat")?function(i){t[s](a[e],!1,i)}:function(i){var r=s;i.length&&"v"!==s.slice(-1)&&(r+="v"),t[r](a[e],i)}}(i,s,"uniform"+Qo[s])}})),Object.defineProperties(s,o),s}(this.gl,this),Ln(On,this.destroy,this)}bind(){this.gl.useProgram(this.program)}getAttribLocation(t){var e=this.attributes[t];return void 0!==e?e:-1}setUniform(t,e){var i=this.uniforms;if(void 0===i[t])throw new Error("undefined ("+t+") uniform for shader "+this);"object"==typeof e&&"function"==typeof e.toArray?i[t]=e.toArray():i[t]=e}setVertexAttributes(t,e,i){for(var s=0;s<e.length;++s){var r=e[s],n=this.getAttribLocation(r.name);-1!==n?(t.enableVertexAttribArray(n),t.vertexAttribPointer(n,r.size,r.type,r.normalized,i,r.offset)):t.disableVertexAttribArray(s)}}destroy(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}class ia{constructor(t,e){this.vertexSize=t,this.quadSize=e,this.maxVertex=256,this.vertexCount=0,this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer)}clear(){this.vertexCount=0}isFull(t=this.quadSize){return this.vertexCount+t>=this.maxVertex}resize(){this.maxVertex<<=1;var t=this.bufferF32;return this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.quadSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this.bufferF32.set(t),this}push(t,e,i,s,r){var n=this.vertexCount*this.vertexSize;return this.vertexCount>=this.maxVertex&&this.resize(),this.bufferF32[n+0]=t,this.bufferF32[n+1]=e,void 0!==i&&(this.bufferF32[n+2]=i,this.bufferF32[n+3]=s),void 0!==r&&(this.bufferU32[n+4]=r),this.vertexCount++,this}toFloat32(t,e){return void 0!==e?this.bufferF32.subarray(t,e):this.bufferF32}toUint32(t,e){return void 0!==e?this.bufferU32.subarray(t,e):this.bufferU32}length(){return this.vertexCount}isEmpty(){return 0===this.vertexCount}}var sa=[new Vr,new Vr,new Vr,new Vr];class ra{constructor(t){this.init(t)}init(t){var e=t.gl;this.currentTextureUnit=-1,this.boundTextures=[],this.renderer=t,this.gl=t.gl,this.color=t.currentColor,this.viewMatrix=t.currentTransform,this.activeShader=null,this.mode=e.TRIANGLES,this.attributes=[],this.vertexByteSize=0,this.vertexSize=0,this.primitiveShader=new ea(this.gl,"// Current vertex point\nattribute vec2 aVertex;\n\n// Projection matrix\nuniform mat4 uProjectionMatrix;\n\n// Vertex color\nuniform vec4 uColor;\n\n// Fragment color\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(uColor.rgb * uColor.a, uColor.a);\n}\n","varying vec4 vColor;\n\nvoid main(void) {\n    gl_FragColor = vColor;\n}\n"),this.quadShader=new ea(this.gl,"attribute vec2 aVertex;\nattribute vec2 aRegion;\nattribute vec4 aColor;\n\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vRegion;\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n     gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(aColor.bgr * aColor.a, aColor.a);\n    vRegion = aRegion;\n}\n","uniform sampler2D uSampler;\nvarying vec4 vColor;\nvarying vec2 vRegion;\n\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vRegion) * vColor;\n}\n"),this.addAttribute("aVertex",2,e.FLOAT,!1,0*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aRegion",2,e.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aColor",4,e.UNSIGNED_BYTE,!0,4*Float32Array.BYTES_PER_ELEMENT),this.vertexBuffer=new ia(this.vertexSize,6),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,this.vertexBuffer.buffer,e.STREAM_DRAW),Ln(Cn,((t,e)=>{this.flush(),this.setViewport(0,0,t,e)}))}reset(){this.gl=this.renderer.gl,this.flush(),this.setViewport(0,0,this.renderer.getCanvas().width,this.renderer.getCanvas().height),this.clearColor(0,0,0,0);for(var t=0;t<this.renderer.maxTextures;t++){var e=this.getTexture2D(t);void 0!==e&&this.deleteTexture2D(e)}this.currentTextureUnit=-1,this.useShader(this.quadShader)}addAttribute(t,e,i,s,r){switch(this.attributes.push({name:t,size:e,type:i,normalized:s,offset:r}),i){case this.gl.BYTE:this.vertexByteSize+=e*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=e*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=e*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=e*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=e*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=e*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=e*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}setViewport(t,e,i,s){this.gl.viewport(t,e,i,s)}createTexture2D(t,e,i,s="no-repeat",r,n,o,a=!0,h=!0){var l=this.gl,u=wr(r||e.width)&&wr(n||e.height),d=l.createTexture(),c=0===s.search(/^repeat(-x)?$/)&&(u||this.renderer.WebGLVersion>1)?l.REPEAT:l.CLAMP_TO_EDGE,p=0===s.search(/^repeat(-y)?$/)&&(u||this.renderer.WebGLVersion>1)?l.REPEAT:l.CLAMP_TO_EDGE;return this.bindTexture2D(d,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,c),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,p),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,i),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),r||n||o?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,r,n,o,l.RGBA,l.UNSIGNED_BYTE,e):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,e),u&&!1!==h&&l.generateMipmap(l.TEXTURE_2D),d}deleteTexture2D(t){this.gl.deleteTexture(t),this.unbindTexture2D(t)}getTexture2D(t){return this.boundTextures[t]}bindTexture2D(t,e){var i=this.gl;t!==this.boundTextures[e]?(this.flush(),this.currentTextureUnit!==e&&(this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,t),this.boundTextures[e]=t):this.currentTextureUnit!==e&&(this.flush(),this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e))}unbindTexture2D(t,e){return void 0===e&&(e=this.boundTextures.indexOf(t)),-1!==e&&(delete this.boundTextures[e],e===this.currentTextureUnit&&(this.currentTextureUnit=-1)),e}uploadTexture(t,e,i,s,r=!1){var n=this.renderer.cache.getUnit(t),o=this.boundTextures[n];return void 0===o||r?this.createTexture2D(n,t.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,t.repeat,e,i,s,t.premultipliedAlpha):this.bindTexture2D(o,n),this.currentTextureUnit}setProjection(t){this.activeShader.setUniform("uProjectionMatrix",t)}useShader(t){this.activeShader!==t&&(this.flush(),this.activeShader=t,this.activeShader.bind(),this.activeShader.setUniform("uProjectionMatrix",this.renderer.projectionMatrix),this.activeShader.setVertexAttributes(this.gl,this.attributes,this.vertexByteSize))}addQuad(t,e,i,s,r,n,o,a,h,l){if(!(this.color.alpha<1/255)){this.useShader(this.quadShader),this.vertexBuffer.isFull(6)&&this.flush();var u=this.uploadTexture(t);this.quadShader.setUniform("uSampler",u);var d=this.viewMatrix,c=sa[0].set(e,i),p=sa[1].set(e+s,i),f=sa[2].set(e,i+r),g=sa[3].set(e+s,i+r);d.isIdentity()||(d.apply(c),d.apply(p),d.apply(f),d.apply(g)),this.vertexBuffer.push(c.x,c.y,n,o,l),this.vertexBuffer.push(p.x,p.y,a,o,l),this.vertexBuffer.push(f.x,f.y,n,h,l),this.vertexBuffer.push(f.x,f.y,n,h,l),this.vertexBuffer.push(p.x,p.y,a,o,l),this.vertexBuffer.push(g.x,g.y,a,h,l)}}flush(t=this.mode){var e=this.vertexBuffer,i=e.vertexCount;if(i>0){var s=this.gl,r=e.vertexSize;this.renderer.WebGLVersion>1?s.bufferData(s.ARRAY_BUFFER,e.toFloat32(),s.STREAM_DRAW,0,i*r):s.bufferData(s.ARRAY_BUFFER,e.toFloat32(0,i*r),s.STREAM_DRAW),s.drawArrays(t,0,i),e.clear()}}drawVertices(t,e,i=e.length){this.useShader(this.primitiveShader),this.primitiveShader.setUniform("uColor",this.color);for(var s=this.viewMatrix,r=this.vertexBuffer,n=s.isIdentity(),o=0;o<i;o++)n||s.apply(e[o]),r.push(e[o].x,e[o].y);this.flush(t)}clear(t=0){var e=this.gl;e.clearColor(0,0,0,t),e.clear(e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT)}clearColor(t=0,e=0,i=0,s=0){var r=this.gl;r.clearColor(t,e,i,s),r.clear(r.COLOR_BUFFER_BIT)}}var na={exports:{}};function oa(t,e,i){i=i||2;var s,r,n,o,a,h,l,u=e&&e.length,d=u?e[0]*i:t.length,c=aa(t,0,d,i,!0),p=[];if(!c||c.next===c.prev)return p;if(u&&(c=function(t,e,i,s){var r,n,o,a=[];for(r=0,n=e.length;r<n;r++)(o=aa(t,e[r]*s,r<n-1?e[r+1]*s:t.length,s,!1))===o.next&&(o.steiner=!0),a.push(va(o));for(a.sort(fa),r=0;r<a.length;r++)i=ga(a[r],i);return i}(t,e,c,i)),t.length>80*i){s=n=t[0],r=o=t[1];for(var f=i;f<d;f+=i)(a=t[f])<s&&(s=a),(h=t[f+1])<r&&(r=h),a>n&&(n=a),h>o&&(o=h);l=0!==(l=Math.max(n-s,o-r))?32767/l:0}return la(c,p,i,s,r,l,0),p}function aa(t,e,i,s,r){var n,o;if(r===ka(t,e,i,s)>0)for(n=e;n<i;n+=s)o=Ma(n,t[n],t[n+1],o);else for(n=i-s;n>=e;n-=s)o=Ma(n,t[n],t[n+1],o);return o&&wa(o,o.next)&&(Pa(o),o=o.next),o}function ha(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!wa(s,s.next)&&0!==ba(s.prev,s,s.next))s=s.next;else{if(Pa(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function la(t,e,i,s,r,n,o){if(t){!o&&n&&function(t,e,i,s){var r=t;do{0===r.z&&(r.z=ya(r.x,r.y,e,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,s,r,n,o,a,h,l=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,s=i,a=0,e=0;e<l&&(a++,s=s.nextZ);e++);for(h=l;a>0||h>0&&s;)0!==a&&(0===h||!s||i.z<=s.z)?(r=i,i=i.nextZ,a--):(r=s,s=s.nextZ,h--),n?n.nextZ=r:t=r,r.prevZ=n,n=r;i=s}n.nextZ=null,l*=2}while(o>1)}(r)}(t,s,r,n);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,n?da(t,s,r,n):ua(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(h.i/i|0),Pa(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?la(t=ca(ha(t),e,i),e,i,s,r,n,2):2===o&&pa(t,e,i,s,r,n):la(ha(t),e,i,s,r,n,1);break}}}function ua(t){var e=t.prev,i=t,s=t.next;if(ba(e,i,s)>=0)return!1;for(var r=e.x,n=i.x,o=s.x,a=e.y,h=i.y,l=s.y,u=r<n?r<o?r:o:n<o?n:o,d=a<h?a<l?a:l:h<l?h:l,c=r>n?r>o?r:o:n>o?n:o,p=a>h?a>l?a:l:h>l?h:l,f=s.next;f!==e;){if(f.x>=u&&f.x<=c&&f.y>=d&&f.y<=p&&xa(r,a,n,h,o,l,f.x,f.y)&&ba(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function da(t,e,i,s){var r=t.prev,n=t,o=t.next;if(ba(r,n,o)>=0)return!1;for(var a=r.x,h=n.x,l=o.x,u=r.y,d=n.y,c=o.y,p=a<h?a<l?a:l:h<l?h:l,f=u<d?u<c?u:c:d<c?d:c,g=a>h?a>l?a:l:h>l?h:l,m=u>d?u>c?u:c:d>c?d:c,y=ya(p,f,e,i,s),v=ya(g,m,e,i,s),x=t.prevZ,_=t.nextZ;x&&x.z>=y&&_&&_.z<=v;){if(x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==r&&x!==o&&xa(a,u,h,d,l,c,x.x,x.y)&&ba(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==r&&_!==o&&xa(a,u,h,d,l,c,_.x,_.y)&&ba(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;x&&x.z>=y;){if(x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==r&&x!==o&&xa(a,u,h,d,l,c,x.x,x.y)&&ba(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=v;){if(_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==r&&_!==o&&xa(a,u,h,d,l,c,_.x,_.y)&&ba(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function ca(t,e,i){var s=t;do{var r=s.prev,n=s.next.next;!wa(r,n)&&Ta(r,s,s.next,n)&&Sa(r,n)&&Sa(n,r)&&(e.push(r.i/i|0),e.push(s.i/i|0),e.push(n.i/i|0),Pa(s),Pa(s.next),s=t=n),s=s.next}while(s!==t);return ha(s)}function pa(t,e,i,s,r,n){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&_a(o,a)){var h=Ca(o,a);return o=ha(o,o.next),h=ha(h,h.next),la(o,e,i,s,r,n,0),void la(h,e,i,s,r,n,0)}a=a.next}o=o.next}while(o!==t)}function fa(t,e){return t.x-e.x}function ga(t,e){var i=function(t,e){var i,s=e,r=t.x,n=t.y,o=-1/0;do{if(n<=s.y&&n>=s.next.y&&s.next.y!==s.y){var a=s.x+(n-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=r&&a>o&&(o=a,i=s.x<s.next.x?s:s.next,a===r))return i}s=s.next}while(s!==e);if(!i)return null;var h,l=i,u=i.x,d=i.y,c=1/0;s=i;do{r>=s.x&&s.x>=u&&r!==s.x&&xa(n<d?r:o,n,u,d,n<d?o:r,n,s.x,s.y)&&(h=Math.abs(n-s.y)/(r-s.x),Sa(s,t)&&(h<c||h===c&&(s.x>i.x||s.x===i.x&&ma(i,s)))&&(i=s,c=h)),s=s.next}while(s!==l);return i}(t,e);if(!i)return e;var s=Ca(i,t);return ha(s,s.next),ha(i,i.next)}function ma(t,e){return ba(t.prev,t,e.prev)<0&&ba(e.next,t,t.next)<0}function ya(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function va(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function xa(t,e,i,s,r,n,o,a){return(r-o)*(e-a)>=(t-o)*(n-a)&&(t-o)*(s-a)>=(i-o)*(e-a)&&(i-o)*(n-a)>=(r-o)*(s-a)}function _a(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ta(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Sa(t,e)&&Sa(e,t)&&function(t,e){var i=t,s=!1,r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)&&(ba(t.prev,t,e.prev)||ba(t,e.prev,e))||wa(t,e)&&ba(t.prev,t,t.next)>0&&ba(e.prev,e,e.next)>0)}function ba(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function wa(t,e){return t.x===e.x&&t.y===e.y}function Ta(t,e,i,s){var r=Ea(ba(t,e,i)),n=Ea(ba(t,e,s)),o=Ea(ba(i,s,t)),a=Ea(ba(i,s,e));return r!==n&&o!==a||!(0!==r||!Aa(t,i,e))||!(0!==n||!Aa(t,s,e))||!(0!==o||!Aa(i,t,s))||!(0!==a||!Aa(i,e,s))}function Aa(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Ea(t){return t>0?1:t<0?-1:0}function Sa(t,e){return ba(t.prev,t,t.next)<0?ba(t,e,t.next)>=0&&ba(t,t.prev,e)>=0:ba(t,e,t.prev)<0||ba(t,t.next,e)<0}function Ca(t,e){var i=new Ia(t.i,t.x,t.y),s=new Ia(e.i,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function Ma(t,e,i,s){var r=new Ia(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function Pa(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ia(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ka(t,e,i,s){for(var r=0,n=e,o=i-s;n<i;n+=s)r+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return r}na.exports=oa,na.exports.default=oa,oa.deviation=function(t,e,i,s){var r=e&&e.length,n=r?e[0]*i:t.length,o=Math.abs(ka(t,0,n,i));if(r)for(var a=0,h=e.length;a<h;a++){var l=e[a]*i,u=a<h-1?e[a+1]*i:t.length;o-=Math.abs(ka(t,l,u,i))}var d=0;for(a=0;a<s.length;a+=3){var c=s[a]*i,p=s[a+1]*i,f=s[a+2]*i;d+=Math.abs((t[c]-t[f])*(t[p+1]-t[c+1])-(t[c]-t[p])*(t[f+1]-t[c+1]))}return 0===o&&0===d?0:Math.abs((d-o)/o)},oa.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,r=0;r<t.length;r++){for(var n=0;n<t[r].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[r][n][o]);r>0&&(s+=t[r-1].length,i.holes.push(s))}return i};class Oa{constructor(t,e,i){this.pos=Ur.pull("Vector2d"),this._bounds,this.points=[],this.edges=[],this.indices=[],this.normals=[],this.shapeType="Polygon",this.setShape(t,e,i)}onResetEvent(t,e,i){this.setShape(t,e,i)}setShape(t,e,i){return this.pos.set(t,e),this.setVertices(i),this}setVertices(t){if(!Array.isArray(t))return this;if(t[0]instanceof Vr)this.points=t;else if(this.points.length=0,"object"==typeof t[0])t.forEach((t=>{this.points.push(Ur.pull("Vector2d",t.x,t.y))}));else for(var e=0;e<t.length;e+=2)this.points.push(Ur.pull("Vector2d",t[e],t[e+1]));return this.recalc(),this.updateBounds(),this}transform(t){for(var e=this.points,i=e.length,s=0;s<i;s++)t.apply(e[s]);return this.recalc(),this.updateBounds(),this}toIso(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}to2d(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}rotate(t,e){if(0!==t){for(var i=this.points,s=i.length,r=0;r<s;r++)i[r].rotate(t,e);this.recalc(),this.updateBounds()}return this}scale(t,e){e=void 0!==e?e:t;for(var i=this.points,s=i.length,r=0;r<s;r++)i[r].scale(t,e);return this.recalc(),this.updateBounds(),this}scaleV(t){return this.scale(t.x,t.y)}recalc(){var t,e=this.edges,i=this.normals,s=this.indices,r=this.points,n=r.length;if(n<3)throw new Error("Requires at least 3 points");for(t=0;t<n;t++)void 0===e[t]&&(e[t]=Ur.pull("Vector2d")),e[t].copy(r[(t+1)%n]).sub(r[t]),void 0===i[t]&&(i[t]=Ur.pull("Vector2d")),i[t].copy(e[t]).perp().normalize();return e.length=n,i.length=n,s.length=0,this}getIndices(){return 0===this.indices.length&&(this.indices=na.exports(this.points.flatMap((t=>[t.x,t.y])))),this.indices}isConvex(){var t,e,i,s,r=0,n=this.points,o=n.length;if(o<3)return null;for(t=0;t<o;t++)if(i=(t+2)%o,s=(n[e=(t+1)%o].x-n[t].x)*(n[i].y-n[e].y),(s-=(n[e].y-n[t].y)*(n[i].x-n[e].x))<0?r|=1:s>0&&(r|=2),3===r)return!1;return 0!==r||null}translate(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}shift(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x=t,this.pos.y=e,this.updateBounds()}contains(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);for(var i=!1,s=this.pos.x,r=this.pos.y,n=this.points,o=n.length,a=0,h=o-1;a<o;h=a++){var l=n[a].y+r,u=n[a].x+s,d=n[h].y+r,c=n[h].x+s;l>e!=d>e&&t<(c-u)*(e-l)/(d-l)+u&&(i=!i)}return i}getBounds(){return void 0===this._bounds&&(this._bounds=Ur.pull("Bounds")),this._bounds}updateBounds(){var t=this.getBounds();return t.update(this.points),t.translate(this.pos),t}clone(){var t=[];return this.points.forEach((function(e){t.push(e.clone())})),new Oa(this.pos.x,this.pos.y,t)}}class Ba extends Oa{constructor(t,e,i,s){super(t,e,[Ur.pull("Vector2d",0,0),Ur.pull("Vector2d",i,0),Ur.pull("Vector2d",i,s),Ur.pull("Vector2d",0,s)]),this.shapeType="Rectangle"}onResetEvent(t,e,i,s){this.setShape(t,e,i,s)}setShape(t,e,i,s){var r=i;return this.pos.set(t,e),4===arguments.length&&((r=this.points)[0].set(0,0),r[1].set(i,0),r[2].set(i,s),r[3].set(0,s)),this.setVertices(r),this}get left(){return this.pos.x}get right(){var t=this.width;return this.pos.x+t||t}get top(){return this.pos.y}get bottom(){var t=this.height;return this.pos.y+t||t}get width(){return this.points[2].x}set width(t){this.points[1].x=this.points[2].x=t,this.recalc(),this.updateBounds()}get height(){return this.points[2].y}set height(t){this.points[2].y=this.points[3].y=t,this.recalc(),this.updateBounds()}get centerX(){return isFinite(this.width)?this.pos.x+this.width/2:this.width}set centerX(t){this.pos.x=t-this.width/2}get centerY(){return isFinite(this.height)?this.pos.y+this.height/2:this.height}set centerY(t){this.pos.y=t-this.height/2}centerOn(t,e){return this.centerX=t,this.centerY=e,this}resize(t,e){return this.width=t,this.height=e,this}scale(t,e=t){return this.width*=t,this.height*=e,this}clone(){return new Ba(this.pos.x,this.pos.y,this.width,this.height)}copy(t){return this.setShape(t.pos.x,t.pos.y,t.width,t.height)}union(t){var e=Math.min(this.left,t.left),i=Math.min(this.top,t.top);return this.resize(Math.max(this.right,t.right)-e,Math.max(this.bottom,t.bottom)-i),this.pos.set(e,i),this}overlaps(t){return this.left<t.right&&t.left<this.right&&this.top<t.bottom&&t.top<this.bottom}contains(){var t,e,i,s,r=arguments[0];return 2===arguments.length?(t=e=r,i=s=arguments[1]):r instanceof Ba?(t=r.left,e=r.right,i=r.top,s=r.bottom):(t=e=r.x,i=s=r.y),t>=this.left&&e<=this.right&&i>=this.top&&s<=this.bottom}equals(t){return t.left===this.left&&t.right===this.right&&t.top===this.top&&t.bottom===this.bottom}isFinite(){return isFinite(this.pos.x)&&isFinite(this.pos.y)&&isFinite(this.width)&&isFinite(this.height)}toPolygon(){return Ur.pull("Polygon",this.pos.x,this.pos.y,this.points)}}class Ra extends Ba{constructor(t,e,i,s,r=20){super(t,e,i,s),this.radius=r}onResetEvent(t,e,i,s,r){super.setShape(t,e,i,s),this.radius=r}get radius(){return this._radius}set radius(t){this.width<2*t&&(t=this.width/2),this.height<2*t&&(t=this.height/2),this._radius=t}copy(t){return super.setShape(t.pos.x,t.pos.y,t.width,t.height),this.radius=t.radius,this}contains(){var t,e,i,s,r=arguments[0];if(2===arguments.length)t=r,e=arguments[1];else{if(r instanceof Ba)return super.contains(r);t=r.x,e=r.y}if(t<this.left||t>=this.right||e<this.top||e>=this.bottom)return!1;if(t>=this.left+this.radius&&t<=this.right-this.radius||e>=this.top+this.radius&&e<=this.bottom-this.radius)return!0;var n=Math.max(0,Math.min(this.radius,this.width/2)),o=Math.max(0,Math.min(this.radius,this.height/2));if(t<this.left+n&&e<this.top+o)i=t-this.left-n,s=e-this.top-o;else if(t>this.right-n&&e<this.top+o)i=t-this.right+n,s=e-this.top-o;else if(t>this.right-n&&e>this.bottom-o)i=t-this.right+n,s=e-this.bottom+o;else{if(!(t<this.left+n&&e>this.bottom-o))return!1;i=t-this.left-n,s=e-this.bottom+o}return i*i+s*s<=n*o}equals(t){return super.equals(t)&&this.radius===t.radius}clone(){return new Ra(this.pos.x,this.pos.y,this.width,this.height,this.radius)}}class La{constructor(t,e,i,s){this.pos=Ur.pull("Vector2d"),this._bounds=void 0,this.radius=NaN,this.radiusV=Ur.pull("Vector2d"),this.radiusSq=Ur.pull("Vector2d"),this.ratio=Ur.pull("Vector2d"),this.shapeType="Ellipse",this.setShape(t,e,i,s)}onResetEvent(t,e,i,s){this.setShape(t,e,i,s)}setShape(t,e,i,s){var r=i/2,n=s/2;this.pos.set(t,e),this.radius=Math.max(r,n),this.ratio.set(r/this.radius,n/this.radius),this.radiusV.set(this.radius,this.radius).scaleV(this.ratio);var o=this.radius*this.radius;return this.radiusSq.set(o,o).scaleV(this.ratio),this.getBounds().setMinMax(t,e,t+i,t+s),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}rotate(t,e){return this.pos.rotate(t,e),this.getBounds().shift(this.pos),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this}scale(t,e){return e=void 0!==e?e:t,this.setShape(this.pos.x,this.pos.y,2*this.radiusV.x*t,2*this.radiusV.y*e)}scaleV(t){return this.scale(t.x,t.y)}transform(t){return this}translate(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}contains(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y,t*t/this.radiusSq.x+e*e/this.radiusSq.y<=1}getBounds(){return void 0===this._bounds&&(this._bounds=Ur.pull("Bounds")),this._bounds}clone(){return new La(this.pos.x,this.pos.y,2*this.radiusV.x,2*this.radiusV.y)}}class Da extends Oa{contains(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y;var i=this.points[0],s=this.points[1];return(e-i.y)*(s.x-i.x)==(s.y-i.y)*(t-i.x)}recalc(){var t=this.edges,e=this.normals,i=this.indices,s=this.points;if(2!==s.length)throw new Error("Requires exactly 2 points");return void 0===t[0]&&(t[0]=Ur.pull("Vector2d")),t[0].copy(s[1]).sub(s[0]),void 0===e[0]&&(e[0]=Ur.pull("Vector2d")),e[0].copy(t[0]).perp().normalize(),i.length=0,this}clone(){var t=[];return this.points.forEach((function(e){t.push(e.clone())})),new Da(this.pos.x,this.pos.y,t)}}class Fa{constructor(t){this._center=new Vr,this.onResetEvent(t)}onResetEvent(t){void 0===this.min?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),void 0!==t&&this.update(t)}clear(){this.setMinMax(1/0,1/0,-1/0,-1/0)}setMinMax(t,e,i,s){this.min.x=t,this.min.y=e,this.max.x=i,this.max.y=s}get x(){return this.min.x}set x(t){var e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e}get y(){return this.min.y}set y(t){var e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e}get width(){return this.max.x-this.min.x}set width(t){this.max.x=this.min.x+t}get height(){return this.max.y-this.min.y}set height(t){this.max.y=this.min.y+t}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}update(t){this.add(t,!0)}add(t,e=!1){!0===e&&this.clear();for(var i=0;i<t.length;i++){var s=t[i];s.x>this.max.x&&(this.max.x=s.x),s.x<this.min.x&&(this.min.x=s.x),s.y>this.max.y&&(this.max.y=s.y),s.y<this.min.y&&(this.min.y=s.y)}}addBounds(t,e=!1){!0===e&&this.clear(),t.max.x>this.max.x&&(this.max.x=t.max.x),t.min.x<this.min.x&&(this.min.x=t.min.x),t.max.y>this.max.y&&(this.max.y=t.max.y),t.min.y<this.min.y&&(this.min.y=t.min.y)}addPoint(t,e){void 0!==e&&"function"==typeof t.rotate&&(t=e.apply(t)),this.min.x=Math.min(this.min.x,t.x),this.max.x=Math.max(this.max.x,t.x),this.min.y=Math.min(this.min.y,t.y),this.max.y=Math.max(this.max.y,t.y)}addFrame(t,e,i,s,r){var n=Ur.pull("Vector2d");this.addPoint(n.set(t,e),r),this.addPoint(n.set(i,e),r),this.addPoint(n.set(t,s),r),this.addPoint(n.set(i,s),r),Ur.push(n)}contains(){var t,e,i,s,r=arguments[0];return 2===arguments.length?(t=e=r,i=s=arguments[1]):r instanceof Fa?(t=r.min.x,e=r.max.x,i=r.min.y,s=r.max.y):(t=e=r.x,i=s=r.y),t>=this.min.x&&e<=this.max.x&&i>=this.min.y&&s<=this.max.y}overlaps(t){return!(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom)}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.min.x+=t,this.max.x+=t,this.min.y+=e,this.max.y+=e}shift(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);var i=this.max.x-this.min.x,s=this.max.y-this.min.y;this.min.x=t,this.max.x=t+i,this.min.y=e,this.max.y=e+s}clone(){var t=new Fa;return t.addBounds(this),t}toPolygon(){return Ur.pull("Polygon",this.x,this.y,[Ur.pull("Vector2d",0,0),Ur.pull("Vector2d",this.width,0),Ur.pull("Vector2d",this.width,this.height),Ur.pull("Vector2d",0,this.height)])}}class za{constructor(){this.points=[],this.arcResolution=5,this.vertices=[]}beginPath(){this.points.forEach((t=>{Ur.push(t)})),this.points.length=0}closePath(){var t=this.points;t.length>1&&!t[t.length-1].equals(t[0])&&t.push(Ur.pull("Vector2d",t[0].x,t[0].y))}triangulatePath(){var t=0,e=this.points,i=this.vertices,s=na.exports(e.flatMap((t=>[t.x,t.y])));for(t=0;t<s.length;t++)void 0===i[t]&&(i[t]=Ur.pull("Vector2d")),i[t].set(e[s[t]].x,e[s[t]].y);for(;i.length>s.length;)Ur.push(i[i.length-1]),i.length-=1;return i}moveTo(t,e){this.points.push(Ur.pull("Vector2d",t,e))}lineTo(t,e){this.points.push(Ur.pull("Vector2d",t,e))}arc(t,e,i,s,r,n=!1){var o=this.points;if(s!==r){var a=n?Math.abs(s-r)>=_r:Math.abs(r-s)>=_r;(s%=_r)<0&&(s+=_r),(r%=_r)<0&&(r+=_r),s>=r&&(r+=_r);var h=r-s,l=1;n&&(l=-1,h=_r-h),a&&(h=_r);for(var u=h*i/this.arcResolution,d=h/u,c=s,p=0;p<u;p++)o.push(Ur.pull("Vector2d",t+i*Math.cos(c),e+i*Math.sin(c))),c+=l*d;o.push(Ur.pull("Vector2d",t+i*Math.cos(r),e+i*Math.sin(r)))}}arcTo(t,e,i,s,r){var n=this.points,o=[n[n.length-1].x-t,n[n.length-1].y-e],a=[i-t,s-e],h=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)),l=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2));o[0]/=h,o[1]/=h,a[0]/=l,a[1]/=l;var u=Math.atan2(o[1],o[0])-Math.atan2(a[1],a[0]),d=r/Math.tan(u/2),c=[t+o[0]*d,e+o[1]*d],p=[t+a[0]*d,e+a[1]*d];n.push(Ur.pull("Vector2d",c[0],c[1]));var f=[(o[0]+a[0])/2,(o[1]+a[1])/2],g=Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2));f[0]/=g,f[1]/=g;var m=Math.sqrt(Math.pow(r,2)+Math.pow(d,2)),y=[t+m*f[0],e+m*f[1]],v=Math.atan2(c[1]-y[1],c[0]-y[0]),x=Math.atan2(p[1]-y[1],p[0]-y[0]);this.arc(y[0],y[1],r,v,x)}ellipse(t,e,i,s,r,n,o,a=!1){var h=this.points;if(n!==o){var l=a?Math.abs(n-o)>=_r:Math.abs(o-n)>=_r;(n%=_r)<0&&(n+=_r),(o%=_r)<0&&(o+=_r),n>=o&&(o+=_r);var u=o-n,d=1;a&&(d=-1,u=_r-u),l&&(u=_r);for(var c=(u*i+u*s)/2/this.arcResolution,p=u/c,f=n,g=Math.cos(r),m=Math.sin(r),y=0;y<c;y++){var v=i*Math.cos(f),x=s*Math.sin(f),_=t+v*g-x*m,b=e+v*m+x*g;h.push(Ur.pull("Vector2d",_,b)),f+=d*p}}}rect(t,e,i,s){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+s),this.lineTo(t,e+s),this.lineTo(t,e)}roundRect(t,e,i,s,r){this.moveTo(t+r,e),this.lineTo(t+i-r,e),this.arcTo(t+i,e,t+i,e+r,r),this.lineTo(t+i,e+s-r),this.arcTo(t+i,e+s,t+i-r,e+s,r),this.lineTo(t+r,e+s),this.arcTo(t,e+s,t,e+s-r,r),this.lineTo(t,e+r),this.arcTo(t,e,t+r,e,r)}}class Ua{constructor(t=0,e=0){this.x=t,this.y=e}onResetEvent(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}equals(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}clone(){return new Ua(this.x,this.y)}}class Va{constructor(t){this.settings=t,this.isContextValid=!0,this.path2D=new za,this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.maskLevel=0,this.currentBlendMode="none",void 0!==globalThis.canvas?this.canvas=globalThis.canvas:void 0!==this.settings.canvas?this.canvas=this.settings.canvas:this.canvas=Cd(this.settings.width,this.settings.height),this.currentColor=new qr(0,0,0,1),this.currentTint=new qr(255,255,255,1),this.projectionMatrix=new Zr,this.uvOffset=0,Ln(un,(()=>{Sd.reset()}))}clear(){}flush(){}reset(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height,this.clearMask()}getCanvas(){return this.canvas}getContext(){return this.context}getBlendMode(){return this.currentBlendMode}getContext2d(t,e){if(null==t)throw new Error("You must pass a canvas element in order to create a 2d context");if(void 0===t.getContext)throw new Error("Your browser does not support HTML5 canvas.");"boolean"!=typeof e&&(e=!0);var i=t.getContext("2d",{alpha:e});return i.canvas||(i.canvas=t),this.setAntiAlias(i,this.settings.antiAlias),i}getWidth(){return this.getCanvas().width}getHeight(){return this.getCanvas().height}getColor(){return this.currentColor}globalAlpha(){return this.currentColor.glArray[3]}overlaps(t){return t.left<=this.getWidth()&&t.right>=0&&t.top<=this.getHeight()&&t.bottom>=0}resize(t,e){var i=this.getCanvas();t===i.width&&e===i.height||(i.width=t,i.height=e,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=t,this.currentScissor[3]=e,Rn(Cn,t,e))}setAntiAlias(t,e){var i=t.canvas;yr("imageSmoothingEnabled",!0===e,t),!0!==e?(i.style["image-rendering"]="optimizeSpeed",i.style["image-rendering"]="-moz-crisp-edges",i.style["image-rendering"]="-o-crisp-edges",i.style["image-rendering"]="-webkit-optimize-contrast",i.style["image-rendering"]="optimize-contrast",i.style["image-rendering"]="crisp-edges",i.style["image-rendering"]="pixelated",i.style.msInterpolationMode="nearest-neighbor"):i.style["image-rendering"]="auto"}setProjection(t){this.projectionMatrix.copy(t)}stroke(t,e){if(t instanceof Ra)this.strokeRoundRect(t.left,t.top,t.width,t.height,t.radius,e);else if(t instanceof Ba||t instanceof Fa)this.strokeRect(t.left,t.top,t.width,t.height,e);else if(t instanceof Da||t instanceof Oa)this.strokePolygon(t,e);else if(t instanceof La)this.strokeEllipse(t.pos.x,t.pos.y,t.radiusV.x,t.radiusV.y,e);else{if(!(t instanceof Ua))throw new Error("Invalid geometry for fill/stroke");this.strokePoint(t.x,t.y)}}fill(t){this.stroke(t,!0)}tint(t,e,i){var s=Cd(t.width,t.height,!0),r=this.getContext2d(s);return r.save(),r.fillStyle=e instanceof qr?e.toRGB():e,r.fillRect(0,0,t.width,t.height),r.globalCompositeOperation=i||"multiply",r.drawImage(t,0,0),r.globalCompositeOperation="destination-atop",r.drawImage(t,0,0),r.restore(),s}setMask(t){}clearMask(){}setTint(t,e=t.alpha){this.currentTint.copy(t),this.currentTint.alpha*=e}clearTint(){this.currentTint.setColor(255,255,255,1)}drawFont(){}}var Na,Ga={};Na=Ga,function(){var e=function(){this.init()};e.prototype={init:function(){var t=this||i;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||i;if(t=parseFloat(t),e.ctx||u(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,i.ctx.currentTime);for(var s=0;s<e._howls.length;s++)if(!e._howls[s]._webAudio)for(var r=e._howls[s]._getSoundIds(),n=0;n<r.length;n++){var o=e._howls[s]._soundById(r[n]);o&&o._node&&(o._node.volume=o._volume*t)}return e}return e._volume},mute:function(t){var e=this||i;e.ctx||u(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,i.ctx.currentTime);for(var s=0;s<e._howls.length;s++)if(!e._howls[s]._webAudio)for(var r=e._howls[s]._getSoundIds(),n=0;n<r.length;n++){var o=e._howls[s]._soundById(r[n]);o&&o._node&&(o._node.muted=!!t||o._muted)}return e},stop:function(){for(var t=this||i,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||i,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,u()),t},codecs:function(t){return(this||i)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||i;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||i,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var s=e.canPlayType("audio/mpeg;").replace(/^no$/,""),r=t._navigator?t._navigator.userAgent:"",n=r.match(/OPR\/([0-6].)/g),o=n&&parseInt(n[0].split("/")[1],10)<33,a=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),h=r.match(/Version\/(.*?) /),l=a&&h&&parseInt(h[1],10)<15;return t._codecs={mp3:!(o||!s&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!s,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(l||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(l||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||i;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var s=new Audio;s._unlocked=!0,t._releaseHtml5Audio(s)}catch(i){t.noAudio=!0;break}for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),o=0;o<n.length;o++){var a=t._howls[r]._soundById(n[o]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}t._autoResume();var h=t.ctx.createBufferSource();h.buffer=t._scratchBuffer,h.connect(t.ctx.destination),void 0===h.start?h.noteOn(0):h.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),h.onended=function(){h.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var i=0;i<t._howls.length;i++)t._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||i;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var e=this||i;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&i.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var s=0;s<t._howls[e]._sounds.length;s++)if(!t._howls[e]._sounds[s]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&i.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var i=new e,s=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};s.prototype={init:function(t){var e=this;return i.ctx||u(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=i.usingWebAudio&&!e._html5,void 0!==i.ctx&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=this,e=null;if(i.noAudio)t._emit("loaderror",null,"No audio support.");else{"string"==typeof t._src&&(t._src=[t._src]);for(var s=0;s<t._src.length;s++){var n,a;if(t._format&&t._format[s])n=t._format[s];else{if("string"!=typeof(a=t._src[s])){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(a))||(n=/\.([^.]+)$/.exec(a.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&i.codecs(n)){e=t._src[s];break}}if(e)return t._src=e,t._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new r(t),t._webAudio&&o(t),t;t._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var s=this,r=null;if("number"==typeof t)r=t,t=null;else{if("string"==typeof t&&"loaded"===s._state&&!s._sprite[t])return null;if(void 0===t&&(t="__default",!s._playLock)){for(var n=0,o=0;o<s._sounds.length;o++)s._sounds[o]._paused&&!s._sounds[o]._ended&&(n++,r=s._sounds[o]._id);1===n?t=null:r=null}}var a=r?s._soundById(r):s._inactiveSound();if(!a)return null;if(r&&!t&&(t=a._sprite||"__default"),"loaded"!==s._state){a._sprite=t,a._ended=!1;var h=a._id;return s._queue.push({event:"play",action:function(){s.play(h)}}),h}if(r&&!a._paused)return e||s._loadQueue("play"),a._id;s._webAudio&&i._autoResume();var l=Math.max(0,a._seek>0?a._seek:s._sprite[t][0]/1e3),u=Math.max(0,(s._sprite[t][0]+s._sprite[t][1])/1e3-l),d=1e3*u/Math.abs(a._rate),c=s._sprite[t][0]/1e3,p=(s._sprite[t][0]+s._sprite[t][1])/1e3;a._sprite=t,a._ended=!1;var f=function(){a._paused=!1,a._seek=l,a._start=c,a._stop=p,a._loop=!(!a._loop&&!s._sprite[t][2])};if(!(l>=p)){var g=a._node;if(s._webAudio){var m=function(){s._playLock=!1,f(),s._refreshBuffer(a);var t=a._muted||s._muted?0:a._volume;g.gain.setValueAtTime(t,i.ctx.currentTime),a._playStart=i.ctx.currentTime,void 0===g.bufferSource.start?a._loop?g.bufferSource.noteGrainOn(0,l,86400):g.bufferSource.noteGrainOn(0,l,u):a._loop?g.bufferSource.start(0,l,86400):g.bufferSource.start(0,l,u),d!==1/0&&(s._endTimers[a._id]=setTimeout(s._ended.bind(s,a),d)),e||setTimeout((function(){s._emit("play",a._id),s._loadQueue()}),0)};"running"===i.state&&"interrupted"!==i.ctx.state?m():(s._playLock=!0,s.once("resume",m),s._clearTimer(a._id))}else{var y=function(){g.currentTime=l,g.muted=a._muted||s._muted||i._muted||g.muted,g.volume=a._volume*i.volume(),g.playbackRate=a._rate;try{var r=g.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(s._playLock=!0,f(),r.then((function(){s._playLock=!1,g._unlocked=!0,e?s._loadQueue():s._emit("play",a._id)})).catch((function(){s._playLock=!1,s._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):e||(s._playLock=!1,f(),s._emit("play",a._id)),g.playbackRate=a._rate,g.paused)return void s._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||a._loop?s._endTimers[a._id]=setTimeout(s._ended.bind(s,a),d):(s._endTimers[a._id]=function(){s._ended(a),g.removeEventListener("ended",s._endTimers[a._id],!1)},g.addEventListener("ended",s._endTimers[a._id],!1))}catch(t){s._emit("playerror",a._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=s._src,g.load());var v=window&&window.ejecta||!g.readyState&&i._navigator.isCocoonJS;if(g.readyState>=3||v)y();else{s._playLock=!0,s._state="loading";var x=function(){s._state="loaded",y(),g.removeEventListener(i._canPlayEvent,x,!1)};g.addEventListener(i._canPlayEvent,x,!1),s._clearTimer(a._id)}}return a._id}s._ended(a)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),s=0;s<i.length;s++){e._clearTimer(i[s]);var r=e._soundById(i[s]);if(r&&!r._paused&&(r._seek=e.seek(i[s]),r._rateSeek=0,r._paused=!0,e._stopFade(i[s]),r._node))if(e._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),e._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||e._emit("pause",r?r._id:null)}return e},stop:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var s=i._getSoundIds(t),r=0;r<s.length;r++){i._clearTimer(s[r]);var n=i._soundById(s[r]);n&&(n._seek=n._start||0,n._rateSeek=0,n._paused=!0,n._ended=!0,i._stopFade(s[r]),n._node&&(i._webAudio?n._node.bufferSource&&(void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),i._cleanBuffer(n._node)):isNaN(n._node.duration)&&n._node.duration!==1/0||(n._node.currentTime=n._start||0,n._node.pause(),n._node.duration===1/0&&i._clearSound(n._node))),e||i._emit("stop",n._id))}return i},mute:function(t,e){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"mute",action:function(){s.mute(t,e)}}),s;if(void 0===e){if("boolean"!=typeof t)return s._muted;s._muted=t}for(var r=s._getSoundIds(e),n=0;n<r.length;n++){var o=s._soundById(r[n]);o&&(o._muted=t,o._interval&&s._stopFade(o._id),s._webAudio&&o._node?o._node.gain.setValueAtTime(t?0:o._volume,i.ctx.currentTime):o._node&&(o._node.muted=!!i._muted||t),s._emit("mute",o._id))}return s},volume:function(){var t,e,s,r=this,n=arguments;if(0===n.length)return r._volume;if(1===n.length||2===n.length&&void 0===n[1]?r._getSoundIds().indexOf(n[0])>=0?e=parseInt(n[0],10):t=parseFloat(n[0]):n.length>=2&&(t=parseFloat(n[0]),e=parseInt(n[1],10)),!(void 0!==t&&t>=0&&t<=1))return(s=e?r._soundById(e):r._sounds[0])?s._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,n)}}),r;void 0===e&&(r._volume=t),e=r._getSoundIds(e);for(var o=0;o<e.length;o++)(s=r._soundById(e[o]))&&(s._volume=t,n[2]||r._stopFade(e[o]),r._webAudio&&s._node&&!s._muted?s._node.gain.setValueAtTime(t,i.ctx.currentTime):s._node&&!s._muted&&(s._node.volume=t*i.volume()),r._emit("volume",s._id));return r},fade:function(t,e,s,r){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"fade",action:function(){n.fade(t,e,s,r)}}),n;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),s=parseFloat(s),n.volume(t,r);for(var o=n._getSoundIds(r),a=0;a<o.length;a++){var h=n._soundById(o[a]);if(h){if(r||n._stopFade(o[a]),n._webAudio&&!h._muted){var l=i.ctx.currentTime,u=l+s/1e3;h._volume=t,h._node.gain.setValueAtTime(t,l),h._node.gain.linearRampToValueAtTime(e,u)}n._startFadeInterval(h,t,e,s,o[a],void 0===r)}}return n},_startFadeInterval:function(t,e,i,s,r,n){var o=this,a=e,h=i-e,l=Math.abs(h/.01),u=Math.max(4,l>0?s/l:s),d=Date.now();t._fadeTo=i,t._interval=setInterval((function(){var r=(Date.now()-d)/s;d=Date.now(),a+=h*r,a=Math.round(100*a)/100,a=h<0?Math.max(i,a):Math.min(i,a),o._webAudio?t._volume=a:o.volume(a,t._id,!0),n&&(o._volume=a),(i<e&&a<=i||i>e&&a>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,o.volume(i,t._id),o._emit("fade",t._id))}),u)},_stopFade:function(t){var e=this,s=e._soundById(t);return s&&s._interval&&(e._webAudio&&s._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(s._interval),s._interval=null,e.volume(s._fadeTo,t),s._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t,e,i,s=this,r=arguments;if(0===r.length)return s._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(i=s._soundById(parseInt(r[0],10)))&&i._loop;t=r[0],s._loop=t}else 2===r.length&&(t=r[0],e=parseInt(r[1],10));for(var n=s._getSoundIds(e),o=0;o<n.length;o++)(i=s._soundById(n[o]))&&(i._loop=t,s._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=t,t&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,s.playing(n[o])&&(s.pause(n[o],!0),s.play(n[o],!0)))));return s},rate:function(){var t,e,s,r=this,n=arguments;if(0===n.length?e=r._sounds[0]._id:1===n.length?r._getSoundIds().indexOf(n[0])>=0?e=parseInt(n[0],10):t=parseFloat(n[0]):2===n.length&&(t=parseFloat(n[0]),e=parseInt(n[1],10)),"number"!=typeof t)return(s=r._soundById(e))?s._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,n)}}),r;void 0===e&&(r._rate=t),e=r._getSoundIds(e);for(var o=0;o<e.length;o++)if(s=r._soundById(e[o])){r.playing(e[o])&&(s._rateSeek=r.seek(e[o]),s._playStart=r._webAudio?i.ctx.currentTime:s._playStart),s._rate=t,r._webAudio&&s._node&&s._node.bufferSource?s._node.bufferSource.playbackRate.setValueAtTime(t,i.ctx.currentTime):s._node&&(s._node.playbackRate=t);var a=r.seek(e[o]),h=1e3*((r._sprite[s._sprite][0]+r._sprite[s._sprite][1])/1e3-a)/Math.abs(s._rate);!r._endTimers[e[o]]&&s._paused||(r._clearTimer(e[o]),r._endTimers[e[o]]=setTimeout(r._ended.bind(r,s),h)),r._emit("rate",s._id)}return r},seek:function(){var t,e,s=this,r=arguments;if(0===r.length?s._sounds.length&&(e=s._sounds[0]._id):1===r.length?s._getSoundIds().indexOf(r[0])>=0?e=parseInt(r[0],10):s._sounds.length&&(e=s._sounds[0]._id,t=parseFloat(r[0])):2===r.length&&(t=parseFloat(r[0]),e=parseInt(r[1],10)),void 0===e)return 0;if("number"==typeof t&&("loaded"!==s._state||s._playLock))return s._queue.push({event:"seek",action:function(){s.seek.apply(s,r)}}),s;var n=s._soundById(e);if(n){if(!("number"==typeof t&&t>=0)){if(s._webAudio){var o=s.playing(e)?i.ctx.currentTime-n._playStart:0,a=n._rateSeek?n._rateSeek-n._seek:0;return n._seek+(a+o*Math.abs(n._rate))}return n._node.currentTime}var h=s.playing(e);h&&s.pause(e,!0),n._seek=t,n._ended=!1,s._clearTimer(e),s._webAudio||!n._node||isNaN(n._node.duration)||(n._node.currentTime=t);var l=function(){h&&s.play(e,!0),s._emit("seek",e)};if(h&&!s._webAudio){var u=function(){s._playLock?setTimeout(u,0):l()};setTimeout(u,0)}else l()}return s},playing:function(t){var e=this;if("number"==typeof t){var i=e._soundById(t);return!!i&&!i._paused}for(var s=0;s<e._sounds.length;s++)if(!e._sounds[s]._paused)return!0;return!1},duration:function(t){var e=this,i=e._duration,s=e._soundById(t);return s&&(i=e._sprite[s._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,s=0;s<e.length;s++)e[s]._paused||t.stop(e[s]._id),t._webAudio||(t._clearSound(e[s]._node),e[s]._node.removeEventListener("error",e[s]._errorFn,!1),e[s]._node.removeEventListener(i._canPlayEvent,e[s]._loadFn,!1),e[s]._node.removeEventListener("ended",e[s]._endFn,!1),i._releaseHtml5Audio(e[s]._node)),delete e[s]._node,t._clearTimer(e[s]._id);var r=i._howls.indexOf(t);r>=0&&i._howls.splice(r,1);var o=!0;for(s=0;s<i._howls.length;s++)if(i._howls[s]._src===t._src||t._src.indexOf(i._howls[s]._src)>=0){o=!1;break}return n&&o&&delete n[t._src],i.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,s){var r=this["_on"+t];return"function"==typeof e&&r.push(s?{id:i,fn:e,once:s}:{id:i,fn:e}),this},off:function(t,e,i){var s=this,r=s["_on"+t],n=0;if("number"==typeof e&&(i=e,e=null),e||i)for(n=0;n<r.length;n++){var o=i===r[n].id;if(e===r[n].fn&&o||!e&&o){r.splice(n,1);break}}else if(t)s["_on"+t]=[];else{var a=Object.keys(s);for(n=0;n<a.length;n++)0===a[n].indexOf("_on")&&Array.isArray(s[a[n]])&&(s[a[n]]=[])}return s},once:function(t,e,i){return this.on(t,e,i,1),this},_emit:function(t,e,i){for(var s=this,r=s["_on"+t],n=r.length-1;n>=0;n--)r[n].id&&r[n].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,i)}.bind(s,r[n].fn),0),r[n].once&&s.off(t,r[n].fn,r[n].id));return s._loadQueue(t),s},_loadQueue:function(t){var e=this;if(e._queue.length>0){var i=e._queue[0];i.event===t&&(e._queue.shift(),e._loadQueue()),t||i.action()}return e},_ended:function(t){var e=this,s=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var r=!(!t._loop&&!e._sprite[s][2]);if(e._emit("end",t._id),!e._webAudio&&r&&e.stop(t._id,!0).play(t._id),e._webAudio&&r){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=i.ctx.currentTime;var n=1e3*(t._stop-t._start)/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),n)}return e._webAudio&&!r&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),i._autoSuspend()),e._webAudio||r||e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if("function"!=typeof e._endTimers[t])clearTimeout(e._endTimers[t]);else{var i=e._soundById(t);i&&i._node&&i._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,i=0;i<e._sounds.length;i++)if(t===e._sounds[i]._id)return e._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new r(t)},_drain:function(){var t=this,e=t._pool,i=0,s=0;if(!(t._sounds.length<e)){for(s=0;s<t._sounds.length;s++)t._sounds[s]._ended&&i++;for(s=t._sounds.length-1;s>=0;s--){if(i<=e)return;t._sounds[s]._ended&&(t._webAudio&&t._sounds[s]._node&&t._sounds[s]._node.disconnect(0),t._sounds.splice(s,1),i--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],i=0;i<this._sounds.length;i++)e.push(this._sounds[i]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=i.ctx.createBufferSource(),t._node.bufferSource.buffer=n[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,i.ctx.currentTime),this},_cleanBuffer:function(t){var e=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=i._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(t){this._parent=t,this.init()};r.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++i._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,s=i._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=void 0===i.ctx.createGain?i.ctx.createGainNode():i.ctx.createGain(),t._node.gain.setValueAtTime(s,i.ctx.currentTime),t._node.paused=!0,t._node.connect(i.masterGain)):i.noAudio||(t._node=i._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(i._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=!0===e._preload?"auto":e._preload,t._node.volume=s*i.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++i._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(i._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(10*t._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var n={},o=function(t){var e=t._src;if(n[e])return t._duration=n[e].duration,void l(t);if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),s=new Uint8Array(i.length),r=0;r<i.length;++r)s[r]=i.charCodeAt(r);h(s.buffer,t)}else{var o=new XMLHttpRequest;o.open(t._xhr.method,e,!0),o.withCredentials=t._xhr.withCredentials,o.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach((function(e){o.setRequestHeader(e,t._xhr.headers[e])})),o.onload=function(){var e=(o.status+"")[0];"0"===e||"2"===e||"3"===e?h(o.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+o.status+".")},o.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete n[e],t.load())},a(o)}},a=function(t){try{t.send()}catch(e){t.onerror()}},h=function(t,e){var s=function(){e._emit("loaderror",null,"Decoding audio data failed.")},r=function(t){t&&e._sounds.length>0?(n[e._src]=t,l(e,t)):s()};"undefined"!=typeof Promise&&1===i.ctx.decodeAudioData.length?i.ctx.decodeAudioData(t).then(r).catch(s):i.ctx.decodeAudioData(t,r,s)},l=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},u=function(){if(i.usingWebAudio){try{"undefined"!=typeof AudioContext?i.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch(t){i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),e=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),s=e?parseInt(e[1],10):null;if(t&&s&&s<9){var r=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!r&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=void 0===i.ctx.createGain?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};Na.Howler=i,Na.Howl=s,void 0!==t?(t.HowlerGlobal=e,t.Howler=i,t.Howl=s,t.Sound=r):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=i,window.Howl=s,window.Sound=r)}(),function(){var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var e=this;if(!e.ctx||!e.ctx.listener)return e;for(var i=e._howls.length-1;i>=0;i--)e._howls[i].stereo(t);return e},HowlerGlobal.prototype.pos=function(t,e,i){var s=this;return s.ctx&&s.ctx.listener?(e="number"!=typeof e?s._pos[1]:e,i="number"!=typeof i?s._pos[2]:i,"number"!=typeof t?s._pos:(s._pos=[t,e,i],void 0!==s.ctx.listener.positionX?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]),s)):s},HowlerGlobal.prototype.orientation=function(t,e,i,s,r,n){var o=this;if(!o.ctx||!o.ctx.listener)return o;var a=o._orientation;return e="number"!=typeof e?a[1]:e,i="number"!=typeof i?a[2]:i,s="number"!=typeof s?a[3]:s,r="number"!=typeof r?a[4]:r,n="number"!=typeof n?a[5]:n,"number"!=typeof t?a:(o._orientation=[t,e,i,s,r,n],void 0!==o.ctx.listener.forwardX?(o.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(n,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(t,e,i,s,r,n),o)},Howl.prototype.init=(t=Howl.prototype.init,function(e){var i=this;return i._orientation=e.orientation||[1,0,0],i._stereo=e.stereo||null,i._pos=e.pos||null,i._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},i._onstereo=e.onstereo?[{fn:e.onstereo}]:[],i._onpos=e.onpos?[{fn:e.onpos}]:[],i._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,i){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"stereo",action:function(){s.stereo(t,i)}}),s;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof t)return s._stereo;s._stereo=t,s._pos=[t,0,0]}for(var n=s._getSoundIds(i),o=0;o<n.length;o++){var a=s._soundById(n[o]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,r),"spatial"===r?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(t,0,0):a._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),s._emit("stereo",a._id)}}return s},Howl.prototype.pos=function(t,i,s,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"pos",action:function(){n.pos(t,i,s,r)}}),n;if(i="number"!=typeof i?0:i,s="number"!=typeof s?-.5:s,void 0===r){if("number"!=typeof t)return n._pos;n._pos=[t,i,s]}for(var o=n._getSoundIds(r),a=0;a<o.length;a++){var h=n._soundById(o[a]);if(h){if("number"!=typeof t)return h._pos;h._pos=[t,i,s],h._node&&(h._panner&&!h._panner.pan||e(h,"spatial"),void 0!==h._panner.positionX?(h._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setPosition(t,i,s)),n._emit("pos",h._id)}}return n},Howl.prototype.orientation=function(t,i,s,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"orientation",action:function(){n.orientation(t,i,s,r)}}),n;if(i="number"!=typeof i?n._orientation[1]:i,s="number"!=typeof s?n._orientation[2]:s,void 0===r){if("number"!=typeof t)return n._orientation;n._orientation=[t,i,s]}for(var o=n._getSoundIds(r),a=0;a<o.length;a++){var h=n._soundById(o[a]);if(h){if("number"!=typeof t)return h._orientation;h._orientation=[t,i,s],h._node&&(h._panner||(h._pos||(h._pos=n._pos||[0,0,-.5]),e(h,"spatial")),void 0!==h._panner.orientationX?(h._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setOrientation(t,i,s)),n._emit("orientation",h._id)}}return n},Howl.prototype.pannerAttr=function(){var t,i,s,r=this,n=arguments;if(!r._webAudio)return r;if(0===n.length)return r._pannerAttr;if(1===n.length){if("object"!=typeof n[0])return(s=r._soundById(parseInt(n[0],10)))?s._pannerAttr:r._pannerAttr;t=n[0],void 0===i&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:r._panningModel})}else 2===n.length&&(t=n[0],i=parseInt(n[1],10));for(var o=r._getSoundIds(i),a=0;a<o.length;a++)if(s=r._soundById(o[a])){var h=s._pannerAttr;h={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:h.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:h.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:h.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:h.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:h.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:h.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:h.panningModel};var l=s._panner;l?(l.coneInnerAngle=h.coneInnerAngle,l.coneOuterAngle=h.coneOuterAngle,l.coneOuterGain=h.coneOuterGain,l.distanceModel=h.distanceModel,l.maxDistance=h.maxDistance,l.refDistance=h.refDistance,l.rolloffFactor=h.rolloffFactor,l.panningModel=h.panningModel):(s._pos||(s._pos=r._pos||[0,0,-.5]),e(s,"spatial"))}return r},Sound.prototype.init=function(t){return function(){var e=this,i=e._parent;e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,t.call(this),e._stereo?i.stereo(e._stereo):e._pos&&i.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this,i=e._parent;return e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,e._stereo?i.stereo(e._stereo):e._pos?i.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,i._refreshBuffer(e)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}();let ja={},Ha=null,Xa=0,Ya=[],Wa=function(t,e){if(Xa++>3)throw new Error("melonJS: failed loading "+t);ja[t].load()};function Ka(){return!Ga.Howler.noAudio}function qa(t,e,i,s){var r=[];if(0===Ya.length)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");if(!0===pr(t.src))r.push(t.src);else for(var n=0;n<Ya.length;n++)r.push(t.src+t.name+"."+Ya[n]+Ju.nocache);return ja[t.name]=new Ga.Howl({src:r,volume:Ga.Howler.volume(),html5:!0===e,xhrWithCredentials:Ju.withCredentials,onloaderror(){Wa.call(this,t.name,s)},onload(){Xa=0,i&&i()}}),1}function Za(t,e=!1,i,s){var r=ja[t];if(r&&void 0!==r){var n=r.play();return"boolean"==typeof e&&r.loop(e,n),r.volume("number"==typeof s?Er(s,0,1):Ga.Howler.volume(),n),"function"==typeof i&&(!0===e?r.on("end",i,n):r.once("end",i,n)),n}throw new Error("audio clip "+t+" does not exist")}function Qa(){null!==Ha&&ja[Ha].pause()}function Ja(){null!==Ha&&ja[Ha].play()}function $a(t,e,i){i=void 0===i||!!i;var s=ja[t];if(!s||void 0===s)throw new Error("audio clip "+t+" does not exist");s.mute(i,e)}function th(){Ga.Howler.mute(!0)}function eh(){Ga.Howler.mute(!1)}function ih(t){return t in ja&&(ja[t].unload(),delete ja[t],!0)}function sh(){for(var t in ja)ja.hasOwnProperty(t)&&ih(t)}var rh=Object.freeze({__proto__:null,stopOnAudioError:!0,init:function(t="mp3"){return Ya=t.split(","),!Ga.Howler.noAudio},hasFormat:function(t){return Ka()&&Ga.Howler.codecs(t)},hasAudio:Ka,enable:function(){eh()},disable:function(){th()},load:qa,play:Za,fade:function(t,e,i,s,r){var n=ja[t];if(!n||void 0===n)throw new Error("audio clip "+t+" does not exist");n.fade(e,i,s,r)},seek:function(t,...e){var i=ja[t];if(i&&void 0!==i)return i.seek(...e);throw new Error("audio clip "+t+" does not exist")},rate:function(t,...e){var i=ja[t];if(i&&void 0!==i)return i.rate(...e);throw new Error("audio clip "+t+" does not exist")},stop:function(t,e){if(void 0!==t){var i=ja[t];if(!i||void 0===i)throw new Error("audio clip "+t+" does not exist");i.stop(e),i.off("end",void 0,e)}else Ga.Howler.stop()},pause:function(t,e){var i=ja[t];if(!i||void 0===i)throw new Error("audio clip "+t+" does not exist");i.pause(e)},resume:function(t,e){var i=ja[t];if(!i||void 0===i)throw new Error("audio clip "+t+" does not exist");i.play(e)},playTrack:function(t,e){return Ha=t,Za(Ha,!0,null,e)},stopTrack:function(){null!==Ha&&(ja[Ha].stop(),Ha=null)},pauseTrack:Qa,resumeTrack:Ja,getCurrentTrack:function(){return Ha},setVolume:function(t){Ga.Howler.volume(t)},getVolume:function(){return Ga.Howler.volume()},mute:$a,unmute:function(t,e){$a(t,e,!1)},muteAll:th,unmuteAll:eh,muted:function(){return Ga.Howler._muted},unload:ih,unloadAll:sh});class nh extends Vr{constructor(t=0,e=0,i){if(super(t,e),void 0===i)throw new Error("undefined `onUpdate` callback");this.setCallback(i.onUpdate,i.scope)}onResetEvent(t=0,e=0,i){return this.setMuted(t,e),void 0!==i&&this.setCallback(i.onUpdate,i.scope),this}get x(){return this._x}set x(t){var e=this.onUpdate.call(this.scope,t,this._y,this._x,this._y);this._x=e&&"x"in e?e.x:t}get y(){return this._y}set y(t){var e=this.onUpdate.call(this.scope,this._x,t,this._x,this._y);this._y=e&&"y"in e?e.y:t}_set(t,e){var i=this.onUpdate.call(this.scope,t,e,this._x,this._y);return i&&"x"in i&&"y"in i?(this._x=i.x,this._y=i.y):(this._x=t,this._y=e),this}setMuted(t,e){return this._x=t,this._y=e,this}setCallback(t,e=null){if("function"!=typeof t)throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y)}sub(t){return this._set(this._x-t.x,this._y-t.y)}scale(t,e){return this._set(this._x*t,this._y*(void 0!==e?e:t))}scaleV(t){return this._set(this._x*t.x,this._y*t.y)}div(t){return this._set(this._x/t,this._y/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}clamp(t,e){return new nh(Er(this.x,t,e),Er(this.y,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(Er(this._x,t,e),Er(this._y,t,e))}minV(t){return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y)}maxV(t){return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y)}floor(){return new nh(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y))}ceil(){return new nh(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}negate(){return new nh(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y)}copy(t){return this._set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}perp(){return this._set(this._y,-this._x)}rotate(t,e){var i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);var r=this._x-i,n=this._y-s,o=Math.cos(t),a=Math.sin(t);return this._set(r*o-n*a+i,r*a+n*o+s)}dot(t){return this._x*t.x+this._y*t.y}cross(t){return this._x*t.y-this._y*t.x}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e)}moveTowards(t,e){var i=Math.atan2(t.y-this._y,t.x-this._x),s=this.distance(t);return 0===s||e>=0&&s<=e*e?t:(this._x+=Math.cos(i)*e,this._y+=Math.sin(i)*e,this)}distance(t){return Math.sqrt((this._x-t.x)*(this._x-t.x)+(this._y-t.y)*(this._y-t.y))}clone(){return Ur.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}toVector2d(){return Ur.pull("Vector2d",this._x,this._y)}toString(){return"x:"+this._x+",y:"+this._y}}class oh{constructor(t=0,e=0,i=0){this.onResetEvent(t,e,i)}onResetEvent(t=0,e=0,i=0){return this.x=t,this.y=e,this.z=i,this}_set(t,e,i=0){return this.x=t,this.y=e,this.z=i,this}set(t,e,i){if(t!==+t||e!==+e||void 0!==i&&i!==+i)throw new Error("invalid x, y, z parameters (not a number)");return this._set(t,e,i)}setZero(){return this.set(0,0,0)}setV(t){return this._set(t.x,t.y,t.z)}add(t){return this._set(this.x+t.x,this.y+t.y,this.z+(t.z||0))}sub(t){return this._set(this.x-t.x,this.y-t.y,this.z-(t.z||0))}scale(t,e,i){return e=void 0!==e?e:t,this._set(this.x*t,this.y*e,this.z*(i||1))}scaleV(t){return this.scale(t.x,t.y,t.z)}toIso(){return this._set(this.x-this.y,.5*(this.x+this.y),this.z)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}div(t){return this._set(this.x/t,this.y/t,this.z/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(t,e){return new oh(Er(this.x,t,e),Er(this.y,t,e),Er(this.z,t,e))}clampSelf(t,e){return this._set(Er(this.x,t,e),Er(this.y,t,e),Er(this.z,t,e))}minV(t){var e=t.z||0;return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y,this.z<e?this.z:e)}maxV(t){var e=t.z||0;return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y,this.z>e?this.z:e)}floor(){return new oh(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new oh(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}negate(){return new oh(-this.x,-this.y,-this.z)}negateSelf(){return this._set(-this.x,-this.y,-this.z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(){var t,e,i;return arguments.length>=2?(t=arguments[0],e=arguments[1],i=arguments[2]):(t=arguments[0].x,e=arguments[0].y,i=arguments[0].z),void 0===i&&(i=this.z),this.x===t&&this.y===e&&this.z===i}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x,this.z)}rotate(t,e){var i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);var r=this.x-i,n=this.y-s,o=Math.cos(t),a=Math.sin(t);return this._set(r*o-n*a+i,r*a+n*o+s,this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*(void 0!==t.z?t.z:this.z)}cross(t){var e=this.x,i=this.y,s=this.z,r=t.x,n=t.y,o=t.z;return this.x=i*o-s*n,this.y=s*r-e*o,this.z=e*n-i*r,this}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}moveTowards(t,e){var i=Math.atan2(t.y-this.y,t.x-this.x),s=this.x-t.x,r=this.y-t.y,n=Math.sqrt(s*s+r*r);return 0===n||e>=0&&n<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){var e=this.x-t.x,i=this.y-t.y,s=this.z-(t.z||0);return Math.sqrt(e*e+i*i+s*s)}angle(t){return Math.acos(Er(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){var e=this.dot(t)/t.length2();return this.scale(e,e,e)}projectN(t){var e=this.dot(t)/t.length2();return this.scale(e,e,e)}clone(){return Ur.pull("Vector3d",this.x,this.y,this.z)}toString(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}class ah extends oh{constructor(t=0,e=0,i=0,s){if(super(t,e,i),void 0===s)throw new Error("undefined `onUpdate` callback");this.setCallback(s.onUpdate,s.scope)}onResetEvent(t=0,e=0,i=0,s){return this.setMuted(t,e,i),void 0!==s&&this.setCallback(s.onUpdate,s.scope),this}get x(){return this._x}set x(t){var e=this.onUpdate.call(this.scope,t,this._y,this._z,this._x,this._y,this._z);this._x=e&&"x"in e?e.x:t}get y(){return this._y}set y(t){var e=this.onUpdate.call(this.scope,this._x,t,this._z,this._x,this._y,this._z);this._y=e&&"y"in e?e.y:t}get z(){return this._z}set z(t){var e=this.onUpdate.call(this.scope,this._x,this._y,t,this._x,this._y,this._z);this._z=e&&"z"in e?e.z:t}_set(t,e,i){var s=this.onUpdate.call(this.scope,t,e,i,this._x,this._y,this._z);return s&&"x"in s&&"y"in s&&"z"in s?(this._x=s.x,this._y=s.y,this._z=s.z):(this._x=t,this._y=e,this._z=i||0),this}setMuted(t,e,i){return this._x=t,this._y=e,this._z=i||0,this}setCallback(t,e=null){if("function"!=typeof t)throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y,this._z+(t.z||0))}sub(t){return this._set(this._x-t.x,this._y-t.y,this._z-(t.z||0))}scale(t,e,i){return e=void 0!==e?e:t,this._set(this._x*t,this._y*e,this._z*(i||1))}scaleV(t){return this._set(this._x*t.x,this._y*t.y,this._z*(t.z||1))}div(t){return this._set(this._x/t,this._y/t,this._z/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}clamp(t,e){return new ah(Er(this._x,t,e),Er(this._y,t,e),Er(this._z,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(Er(this._x,t,e),Er(this._y,t,e),Er(this._z,t,e))}minV(t){var e=t.z||0;return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y,this._z<e?this._z:e)}maxV(t){var e=t.z||0;return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y,this._z>e?this._z:e)}floor(){return new ah(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}ceil(){return new ah(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}negate(){return new ah(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y,-this._z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(t){return this._x===t.x&&this._y===t.y&&this._z===(t.z||this._z)}perp(){return this._set(this._y,-this._x,this._z)}rotate(t,e){var i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);var r=this.x-i,n=this.y-s,o=Math.cos(t),a=Math.sin(t);return this._set(r*o-n*a+i,r*a+n*o+s,this.z)}dot(t){return this._x*t.x+this._y*t.y+this._z*(t.z||1)}cross(t){var e=this._x,i=this._y,s=this._z,r=t.x,n=t.y,o=t.z;return this._set(i*o-s*n,s*r-e*o,e*n-i*r)}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e,this._z+(t.z-this._z)*e)}moveTowards(t,e){var i=Math.atan2(t.y-this._y,t.x-this._x),s=this._x-t.x,r=this._y-t.y,n=Math.sqrt(s*s+r*r);return 0===n||e>=0&&n<=e*e?t:this._set(this._x+Math.cos(i)*e,this._y+Math.sin(i)*e,this._z)}distance(t){var e=this._x-t.x,i=this._y-t.y,s=this._z-(t.z||0);return Math.sqrt(e*e+i*i+s*s)}clone(){return Ur.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}toVector3d(){return Ur.pull("Vector3d",this._x,this._y,this._z)}toString(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}var hh={},lh={},uh={},dh={},ch={},ph={},fh=function(t,e,i){e=e||t.keyCode||t.button;var s=ph[e];if(Rn(xn,s,e,!s||!uh[s]),s){if(!uh[s]){var r=void 0!==i?i:e;dh[s][r]||(hh[s]++,dh[s][r]=!0)}return!ch[e]||"function"!=typeof t.preventDefault||t.preventDefault()}return!0},gh=function(t,e,i){e=e||t.keyCode||t.button;var s=ph[e];if(Rn(_n,s,e),s){var r=void 0!==i?i:e;return dh[s][r]=void 0,hh[s]>0&&hh[s]--,uh[s]=!1,!ch[e]||"function"!=typeof t.preventDefault||t.preventDefault()}return!0},mh=null;function yh(){null===mh&&!1===ro&&"function"==typeof(mh=globalThis).addEventListener&&(mh.addEventListener("keydown",fh,!1),mh.addEventListener("keyup",gh,!1))}function vh(t,e,i){!0===e?fh({},t,i):gh({},t,i)}function xh(t){return ph[t]}var _h=new Vr;class bh extends Fa{constructor(t=0,e=0,i=1,s=1){super(),this.setMinMax(t,e,t+i,e+s),this.LEFT=0,this.MIDDLE=1,this.RIGHT=2,this.event=void 0,this.type=void 0,this.button=0,this.isPrimary=!1,this.pageX=0,this.pageY=0,this.clientX=0,this.clientY=0,this.movementX=0,this.movementY=0,this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0,this.gameX=0,this.gameY=0,this.gameScreenX=0,this.gameScreenY=0,this.gameWorldX=0,this.gameWorldY=0,this.gameLocalX=0,this.gameLocalY=0,this.pointerId=void 0,this.isNormalized=!1,this.locked=!1,this.bind=[0,0,0]}setEvent(t,e=0,i=0,s=0,r=0,n=1){this.event=t,this.pageX=e,this.pageY=i,this.clientX=s,this.clientY=r,$h(this.pageX,this.pageY,_h),this.gameScreenX=this.x=_h.x,this.gameScreenY=this.y=_h.y,this.isNormalized=void 0!==globalThis.PointerEvent&&!(t instanceof globalThis.PointerEvent),this.locked=Jh,this.movementX=t.movementX||0,this.movementY=t.movementY||0,"wheel"===t.type?(this.deltaMode=t.deltaMode||0,this.deltaX=t.deltaX||0,this.deltaY=t.deltaY||0,this.deltaZ=t.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=n,this.isPrimary=void 0===t.isPrimary||t.isPrimary,this.button=t.button||0,this.type=t.type,void 0!==Gl.viewport&&Gl.viewport.localToWorld(this.gameScreenX,this.gameScreenY,_h),this.gameWorldX=_h.x,this.gameWorldY=_h.y,!1===this.isNormalized?(this.width=t.width||1,this.height=t.height||1):"number"==typeof t.radiusX?(this.width=2*t.radiusX||1,this.height=2*t.radiusY||1):this.width=this.height=1}}var wh,Th=[],Ah=new Map,Eh=!1,Sh=0,Ch=[];const Mh=["wheel"],Ph=["pointermove","mousemove","touchmove"],Ih=["pointerdown","mousedown","touchstart"],kh=["pointerup","mouseup","touchend"],Oh=["pointercancel","mousecancel","touchcancel"],Bh=["pointerenter","mouseenter","touchenter"],Rh=["pointerover","mouseover","touchover"],Lh=["pointerleave","mouseleave","touchleave"],Dh=[Mh[0],Ph[0],Ih[0],kh[0],Oh[0],Bh[0],Rh[0],Lh[0]],Fh=[Mh[0],Ph[1],Ih[1],kh[1],Oh[1],Bh[1],Rh[1],Lh[1]],zh=[Ph[2],Ih[2],kh[2],Oh[2],Bh[2],Rh[2],Lh[2]],Uh={wheel:Mh,pointermove:Ph,pointerdown:Ih,pointerup:kh,pointercancel:Oh,pointerenter:Bh,pointerover:Rh,pointerleave:Lh};var Vh=[];function Nh(){if(!Eh){wh=new Ba(0,0,1,1);for(var t=0;t<yo;t++)Th.push(new bh);var e;null===Zh&&(Zh=Sd.getCanvas()),Ch=go?Dh:Fh,mo&&!go&&(Ch=Ch.concat(zh)),function(t,e){for(var i=0;i<t.length;i++)-1===Ph.indexOf(t[i])&&Zh.addEventListener(t[i],e,{passive:!1===fl})}(Ch,Kh),void 0===qh&&(qh=~~(1e3/Rd.maxfps)),qo(),Zh.addEventListener(Ch[2],(function(){qo()}),{passive:!1===fl});var i=jh(Ch,Ph);if(qh<17)for(e=0;e<i.length;e++)-1!==Ch.indexOf(i[e])&&Zh.addEventListener(i[e],Wh,{passive:!0});else for(e=0;e<i.length;e++)-1!==Ch.indexOf(i[e])&&Zh.addEventListener(i[e],Fr(Wh,qh,!1),{passive:!0});tl(Zh),xo&&document.addEventListener("pointerlockchange",(()=>{Jh=document.pointerLockElement===Md(),Rn(En,Jh)}),!0),Eh=!0}}function Gh(t,e){for(var i=0;i<e.length;i++)if(-1!==t.indexOf(e[i]))return e[i]}function jh(t,e){for(var i=[],s=0;s<e.length;s++)-1!==t.indexOf(e[s])&&i.push(e[s]);return i}function Hh(t,e,i,s){var r;if(t.callbacks[e]){t.pointerId=s;for(var n=t.callbacks[e].length-1;n>=0&&(r=t.callbacks[e][n]);n--)if(!1===r(i))return!0}return!1}function Xh(t){for(var e=!1;t.length>0;){var i=t.pop();if(Th.push(i),!0===i.isNormalized&&void 0!==i.event.timeStamp){if(i.event.timeStamp<Sh)continue;Sh=i.event.timeStamp}wh.setShape(i.gameWorldX,i.gameWorldY,i.width,i.height),Ph.includes(i.type)&&(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY,Rn(An,i));for(var s,r=Gl.world.broadphase.retrieve(wh,Dl.prototype._sortReverseZ),n=(r=r.concat([Gl.viewport])).length;s=r[--n];){if(Ah.has(s)&&!0!==s.isKinematic){var o,a=Ah.get(s),h=a.region,l=h.ancestor,u=h.getBounds();if(!0===h.isFloating?(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY):(i.gameX=i.gameLocalX=i.gameWorldX,i.gameY=i.gameLocalY=i.gameWorldY),void 0!==l){var d=l.getBounds();i.gameLocalX=i.gameX-d.x,i.gameLocalY=i.gameY-d.y}var c=i.gameX,p=i.gameY;if(void 0!==h.currentTransform&&!h.currentTransform.isIdentity()){var f=h.currentTransform.applyInverse(Ur.pull("Vector2d",c,p));c=f.x,p=f.y,Ur.push(f)}switch(o=u.contains(c,p),i.type){case Ph[0]:case Ph[1]:case Ph[2]:case Ph[3]:if(a.pointerId!==i.pointerId||o){if(null===a.pointerId&&o&&Hh(a,Gh(Ch,Bh),i,i.pointerId)){e=!0;break}}else if(Hh(a,Gh(Ch,Lh),i,null)){e=!0;break}if(o&&Hh(a,i.type,i,i.pointerId)){e=!0;break}break;case kh[0]:case kh[1]:case kh[2]:case kh[3]:if(a.pointerId===i.pointerId&&o&&Hh(a,i.type,i,null)){e=!0;break}break;case Oh[0]:case Oh[1]:case Oh[2]:case Oh[3]:if(a.pointerId===i.pointerId&&Hh(a,i.type,i,null)){e=!0;break}break;default:if(o&&Hh(a,i.type,i,i.pointerId)){e=!0;break}}}if(!0===e)break}}return e}function Yh(t){var e;if(fo&&t.changedTouches)for(var i=0,s=t.changedTouches.length;i<s;i++){var r=t.changedTouches[i];(e=Th.pop()).setEvent(t,r.pageX,r.pageY,r.clientX,r.clientY,r.identifier),Vh.push(e)}else(e=Th.pop()).setEvent(t,t.pageX,t.pageY,t.clientX,t.clientY,t.pointerId),Vh.push(e);return!1===t.isPrimary||(Vh[0].isPrimary=!0,Object.assign(Qh,Vh[0])),Vh}function Wh(t){Xh(Yh(t))}function Kh(t){Yh(t);var e=Vh[0].button;(Xh(Vh)||"wheel"===t.type)&&t.preventDefault();var i=Qh.bind[e];i&&vh(i,Ih.includes(t.type),e+1)}var qh,Zh=null,Qh=new bh(0,0,1,1),Jh=!1;function $h(t,e,i){i=i||Ur.pull("Vector2d");var s=Xo(Sd.getCanvas()),r=globalThis.devicePixelRatio||1;t-=s.left+(globalThis.pageXOffset||0),e-=s.top+(globalThis.pageYOffset||0);var n=Ed;return 1===n.x&&1===n.y||(t/=n.x,e/=n.y),i.set(t*r,e*r)}function tl(t,e){t.style["touch-action"]=e||"none"}function el(t,e,i){if(Nh(),-1===Dh.indexOf(t))throw new Error("invalid event type : "+t);if(void 0===e)throw new Error("registerPointerEvent: region for "+toString(e)+" event is undefined ");var s=jh(Ch,Uh[t]);Ah.has(e)||Ah.set(e,{region:e,callbacks:{},pointerId:null});for(var r=Ah.get(e),n=0;n<s.length;n++)t=s[n],r.callbacks[t]?r.callbacks[t].push(i):r.callbacks[t]=[i]}function il(t,e,i){if(-1===Dh.indexOf(t))throw new Error("invalid event type : "+t);var s=jh(Ch,Uh[t]),r=Ah.get(e);if(void 0!==r){for(var n=0;n<s.length;n++)if(t=s[n],r.callbacks[t]){if(void 0!==i)Pr(r.callbacks[t],i);else for(;r.callbacks[t].length>0;)r.callbacks[t].pop();0===r.callbacks[t].length&&delete r.callbacks[t]}0===Object.keys(r.callbacks).length&&Ah.delete(e)}}function sl(t){if(Ah.has(t))for(var e=0;e<Dh.length;e++)il(Dh[e],t)}var rl=.1;function nl(t,e,i){return t>0?i===this.GAMEPAD.BUTTONS.L2?Math.max(0,t-2e4)/111070:(t-1)/131070:(65536+t)/131070+.5}var ol=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,al=/^0+/;function hl(t,e){var i=t.replace(ol,(function(t,e,i){return"000".slice(e.length-1)+e+"-"+"000".slice(i.length-1)+i+"-"})),s=t.replace(ol,(function(t,e,i){return e.replace(al,"")+"-"+i.replace(al,"")+"-"}));e.analog=e.analog||e.buttons.map((function(){return-1})),e.normalize_fn=e.normalize_fn||function(t){return t},dl.set(i,e),dl.set(s,e)}var ll,ul={},dl=new Map;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:function(t,e,i){return i===this.GAMEPAD.BUTTONS.L2||i===this.GAMEPAD.BUTTONS.R2?(t+1)/2:t}}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:nl}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:nl}]].forEach((function(t){hl(t[0],t[1])}));var cl=function(){var t=navigator.getGamepads();Object.keys(ul).forEach((function(e){var i=t[e];if(i){var s=null;"standard"!==i.mapping&&(s=dl.get(i.id));var r=ul[e];Object.keys(r.buttons).forEach((function(t){var n=r.buttons[t],o=t,a=-1;if(!(s&&(o=s.buttons[t],a=s.analog[t],o<0&&a<0))){var h=i.buttons[o]||{};if(s&&a>=0){var l=s.normalize_fn(i.axes[a],-1,+t);h={value:l,pressed:h.pressed||Math.abs(l)>=rl}}Rn(Tn,e,"buttons",+t,h),!n.pressed&&h.pressed?vh(n.keyCode,!0,o+256):n.pressed&&!h.pressed&&vh(n.keyCode,!1,o+256),n.value=h.value,n.pressed=h.pressed}})),Object.keys(r.axes).forEach((function(t){var n=r.axes[t],o=t;if(!(s&&(o=s.axes[t])<0)){var a=i.axes[o];if(void 0!==a){s&&(a=s.normalize_fn(a,+t,-1));var h=Math.sign(a)||1;if(0!==n[h].keyCode){var l=Math.abs(a)>=rl+Math.abs(n[h].threshold);Rn(Tn,e,"axes",+t,a),!n[h].pressed&&l?(n[-h].pressed&&(vh(n[-h].keyCode,!1,o+256),n[-h].value=0,n[-h].pressed=!1),vh(n[h].keyCode,!0,o+256)):!n[h].pressed&&!n[-h].pressed||l||vh(n[h=n[h].pressed?h:-h].keyCode,!1,o+256),n[h].value=a,n[h].pressed=l}}}}))}}))};globalThis.navigator&&"function"==typeof globalThis.navigator.getGamepads&&(globalThis.addEventListener("gamepadconnected",(function(t){Rn(bn,t.gamepad)}),!1),globalThis.addEventListener("gamepaddisconnected",(function(t){Rn(wn,t.gamepad)}),!1));var pl=hl,fl=!0,gl=Object.freeze({__proto__:null,preventDefault:fl,get pointerEventTarget(){return Zh},pointer:Qh,get locked(){return Jh},get throttlingInterval(){return qh},globalToLocal:$h,setTouchAction:tl,bindPointer:function(){var t=arguments.length<2?Qh.LEFT:arguments[0],e=arguments.length<2?arguments[0]:arguments[1];if(Nh(),!xh(e))throw new Error("no action defined for keycode "+e);Qh.bind[t]=e},unbindPointer:function(t){Qh.bind[void 0===t?Qh.LEFT:t]=null},registerPointerEvent:el,releasePointerEvent:il,releaseAllPointerEvents:sl,requestPointerLock:function(){return!!xo&&(Md().requestPointerLock(),!0)},exitPointerLock:function(){return!!xo&&(document.exitPointerLock(),!0)},get keyBoardEventTarget(){return mh},KEY:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},initKeyboardEvent:yh,isKeyPressed:function(t){return!(!hh[t]||uh[t]||(lh[t]&&(uh[t]=!0),0))},keyStatus:function(t){return hh[t]>0},triggerKeyEvent:vh,bindKey:function(t,e,i,s=fl){ph[t]=e,ch[t]=s,hh[e]=0,lh[e]=i||!1,uh[e]=!1,dh[e]={}},getBindingKey:xh,unlockKey:function(t){uh[t]=!1},unbindKey:function(t){var e=ph[t];hh[e]=0,lh[e]=!1,dh[e]={},ph[t]=null,ch[t]=null},GAMEPAD:{AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}},bindGamepad:function(t,e,i){if(!xh(i))throw new Error("no action defined for keycode "+i);void 0===ll&&"function"==typeof navigator.getGamepads&&(ll=Ln(dn,cl)),ul[t]||(ul[t]={axes:{},buttons:{}});var s={keyCode:i,value:0,pressed:!1,threshold:e.threshold},r=ul[t][e.type];if("buttons"===e.type)r[e.code]=s;else if("axes"===e.type){var n=Math.sign(e.threshold)||1;r[e.code]||(r[e.code]={});var o=r[e.code];o[n]=s,o[-n]||(o[-n]={keyCode:0,value:0,pressed:!1,threshold:-n})}},unbindGamepad:function(t,e){if(!ul[t])throw new Error("no bindings for gamepad "+t);ul[t].buttons[e]={}},setGamepadDeadzone:function(t){rl=t},setGamepadMapping:pl});class ml extends Ba{constructor(t,e,i,s){super(t,e,i,s),this.isRenderable=!0,this.isKinematic=!0,this.body=void 0,void 0===this.currentTransform&&(this.currentTransform=Ur.pull("Matrix2d")),this.currentTransform.identity(),this.GUID=void 0,this.onVisibilityChange=void 0,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.anchorPoint instanceof nh?this.anchorPoint.setMuted(.5,.5).setCallback(this.onAnchorUpdate,this):this.anchorPoint=Ur.pull("ObservableVector2d",.5,.5,{onUpdate:this.onAnchorUpdate,scope:this}),this.autoTransform=!0,this.alpha=1,this.ancestor=void 0,this.mask=void 0,this.blendMode="normal",this.name="",this.pos instanceof ah?this.pos.setMuted(t,e,0).setCallback(this.updateBoundsPos,this):this.pos=Ur.pull("ObservableVector3d",t,e,0,{onUpdate:this.updateBoundsPos,scope:this}),this.isDirty=!1,this._flip={x:!1,y:!1},this._inViewport=!1,this.setOpacity(1)}get isFloating(){return!0===this.floating||void 0!==this.ancestor&&!0===this.ancestor.floating}get tint(){return void 0===this._tint&&(this._tint=Ur.pull("Color",255,255,255,1)),this._tint}set tint(t){void 0===this._tint&&(this._tint=Ur.pull("Color",255,255,255,1)),t instanceof qr?this._tint.copy(t):this._tint.parseCSS(t)}get inViewport(){return this._inViewport}set inViewport(t){this._inViewport!==t&&(this._inViewport=t,"function"==typeof this.onVisibilityChange&&this.onVisibilityChange.call(this,t))}get isFlippedX(){return!0===this._flip.x}get isFlippedY(){return!0===this._flip.y}getBounds(){return void 0===this._bounds&&(super.getBounds(),this.isFinite()?this._bounds.setMinMax(this.pos.x,this.pos.y,this.pos.x+this.width,this.pos.y+this.height):this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds}getOpacity(){return this.alpha}setOpacity(t){"number"==typeof t&&(this.alpha=Er(t,0,1),isNaN(this.alpha)&&(this.alpha=1),this.isDirty=!0)}flipX(t=!0){return this._flip.x=!!t,this.isDirty=!0,this}flipY(t=!0){return this._flip.y=!!t,this.isDirty=!0,this}transform(t){return this.currentTransform.multiply(t),this.updateBoundsPos(this.pos.x,this.pos.y),this.isDirty=!0,this}angleTo(t){var e,i,s=this.getBounds();if(t instanceof ml){var r=t.getBounds();e=r.centerX-s.centerX,i=r.centerY-s.centerY}else e=t.x-s.centerX,i=t.y-s.centerY;return Math.atan2(i,e)}distanceTo(t){var e,i,s=this.getBounds();if(t instanceof ml){var r=t.getBounds();e=s.centerX-r.centerX,i=s.centerY-r.centerY}else e=s.centerX-t.x,i=s.centerY-t.y;return Math.sqrt(e*e+i*i)}lookAt(t){var e;e=t instanceof ml?t.pos:t;var i=this.angleTo(e);return this.rotate(i),this}rotate(t,e){return isNaN(t)||(this.currentTransform.rotate(t,e),this.isDirty=!0),this}scale(t,e){return this.currentTransform.scale(t,e),super.scale(t,e),this.isDirty=!0,this}scaleV(t){return this.scale(t.x,t.y),this}update(t){return this.isDirty}updateBounds(){return super.updateBounds(),this.updateBoundsPos(this.pos.x,this.pos.y),this.getBounds()}updateBoundsPos(t,e){var i=this.getBounds();i.shift(t,e),void 0!==this.anchorPoint&&i.isFinite()&&i.translate(-this.anchorPoint.x*i.width,-this.anchorPoint.y*i.height),this.ancestor instanceof Dl&&!0!==this.floating&&i.translate(this.ancestor.getAbsolutePosition()),this.isDirty=!0}getAbsolutePosition(){return void 0===this._absPos&&(this._absPos=Ur.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),this.ancestor instanceof Dl&&!0!==this.floating&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos}onAnchorUpdate(t,e){this.anchorPoint.setMuted(t,e),this.updateBoundsPos(this.pos.x,this.pos.y)}preDraw(t){var e=this.getBounds(),i=e.width*this.anchorPoint.x,s=e.height*this.anchorPoint.y;if(t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var r=this._flip.x?this.centerX-i:0,n=this._flip.y?this.centerY-s:0;t.translate(r,n),t.scale(this._flip.x?-1:1,this._flip.y?-1:1),t.translate(-r,-n)}void 0!==this.mask&&(t.translate(this.pos.x,this.pos.y),t.setMask(this.mask),t.translate(-this.pos.x,-this.pos.y)),!0!==this.autoTransform||this.currentTransform.isIdentity()||(t.translate(this.pos.x,this.pos.y),t.transform(this.currentTransform),t.translate(-this.pos.x,-this.pos.y)),t.translate(-i,-s),t.setTint(this.tint,this.getOpacity()),this.blendMode!==t.getBlendMode()&&t.setBlendMode(this.blendMode)}draw(t,e){}postDraw(t){t.clearTint(),void 0!==this.mask&&t.clearMask(),t.restore(),this.isDirty=!1}onCollision(t,e){return!1}destroy(){Ur.push(this.currentTransform),this.currentTransform=void 0,Ur.push(this.anchorPoint),this.anchorPoint=void 0,Ur.push(this.pos),this.pos=void 0,void 0!==this._absPos&&(Ur.push(this._absPos),this._absPos=void 0),Ur.push(this._bounds),this._bounds=void 0,this.onVisibilityChange=void 0,void 0!==this.mask&&(Ur.push(this.mask),this.mask=void 0),void 0!==this._tint&&(Ur.push(this._tint),this._tint=void 0),this.ancestor=void 0,void 0!==this.body&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),sl(this),this.onDestroyEvent.apply(this,arguments)}onDestroyEvent(){}}const yl=-1,vl=0,xl=1;for(var _l=[],bl=0;bl<10;bl++)_l.push(new Vr);for(var wl=[],Tl=0;Tl<5;Tl++)wl.push([]);function Al(t,e,i){for(var s=Number.MAX_VALUE,r=-Number.MAX_VALUE,n=t.length,o=0;o<n;o++){var a=t[o].dot(e);a<s&&(s=a),a>r&&(r=a)}i[0]=s,i[1]=r}function El(t,e,i,s,r,n){var o=wl.pop(),a=wl.pop(),h=_l.pop().copy(e).sub(t),l=h.dot(r);if(Al(i,r,o),Al(s,r,a),a[0]+=l,a[1]+=l,o[0]>a[1]||a[0]>o[1])return _l.push(h),wl.push(o),wl.push(a),!0;if(n){var u=0;if(o[0]<a[0])if(n.aInB=!1,o[1]<a[1])u=o[1]-a[0],n.bInA=!1;else{var d=o[1]-a[0],c=a[1]-o[0];u=d<c?d:-c}else if(n.bInA=!1,o[1]>a[1])u=o[0]-a[1],n.aInB=!1;else{var p=o[1]-a[0],f=a[1]-o[0];u=p<f?p:-f}var g=Math.abs(u);g<n.overlap&&(n.overlap=g,n.overlapN.copy(r),u<0&&n.overlapN.negateSelf())}return _l.push(h),wl.push(o),wl.push(a),!1}function Sl(t,e){var i=t.length2(),s=e.dot(t);return s<0?yl:s>i?xl:vl}function Cl(t,e,i,s,r){for(var n=_l.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(s.pos).sub(t.pos).add(t.ancestor.getAbsolutePosition()).sub(e.pos),o=s.radius,a=o*o,h=e.points,l=e.edges,u=l.length,d=_l.pop(),c=_l.pop(),p=_l.pop(),f=0,g=0;g<u;g++){var m=g===u-1?0:g+1,y=0===g?u-1:g-1,v=0,x=null;d.copy(l[g]),p.copy(n).sub(h[g]),r&&p.length2()>a&&(r.aInB=!1);var _=Sl(d,p),b=!0;if(_===yl){var w=null;if(u>1&&(d.copy(l[y]),(_=Sl(d,w=_l.pop().copy(n).sub(h[y])))!==xl&&(b=!1)),b){if((f=p.length())>o)return _l.push(n),_l.push(d),_l.push(c),_l.push(p),w&&_l.push(w),!1;r&&(r.bInA=!1,x=p.normalize(),v=o-f)}w&&_l.push(w)}else if(_===xl){if(u>1&&(d.copy(l[m]),p.copy(n).sub(h[m]),(_=Sl(d,p))!==yl&&(b=!1)),b){if((f=p.length())>o)return _l.push(n),_l.push(d),_l.push(c),_l.push(p),!1;r&&(r.bInA=!1,x=p.normalize(),v=o-f)}}else{c.copy(e.normals[g]),f=p.dot(c);var T=Math.abs(f);if((1===u||f>0)&&T>o)return _l.push(n),_l.push(d),_l.push(c),_l.push(p),!1;r&&(x=c,v=o-f,(f>=0||v<2*o)&&(r.bInA=!1))}x&&r&&Math.abs(v)<Math.abs(r.overlap)&&(r.overlap=v,r.overlapN.copy(x))}return r&&(r.a=t,r.b=i,r.overlapV.copy(r.overlapN).scale(r.overlap)),_l.push(n),_l.push(d),_l.push(c),_l.push(p),!0}var Ml=Object.freeze({__proto__:null,testPolygonPolygon:function(t,e,i,s,r){var n,o=e.points,a=e.normals,h=a.length,l=s.points,u=s.normals,d=u.length,c=_l.pop().copy(t.pos).add(t.ancestor.getAbsolutePosition()).add(e.pos),p=_l.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(s.pos);for(n=0;n<h;n++)if(El(c,p,o,l,a[n],r))return _l.push(c),_l.push(p),!1;for(n=0;n<d;n++)if(El(c,p,o,l,u[n],r))return _l.push(c),_l.push(p),!1;return r&&(r.a=t,r.b=i,r.overlapV.copy(r.overlapN).scale(r.overlap)),_l.push(c),_l.push(p),!0},testEllipseEllipse:function(t,e,i,s,r){var n=_l.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(s.pos).sub(t.pos).add(t.ancestor.getAbsolutePosition()).sub(e.pos),o=e.radius,a=s.radius,h=o+a,l=h*h,u=n.length2();if(u>l)return _l.push(n),!1;if(r){var d=Math.sqrt(u);r.a=t,r.b=i,r.overlap=h-d,r.overlapN.copy(n.normalize()),r.overlapV.copy(n).scale(r.overlap),r.aInB=o<=a&&d<=a-o,r.bInA=a<=o&&d<=o-a}return _l.push(n),!0},testPolygonEllipse:Cl,testEllipsePolygon:function(t,e,i,s,r){var n=Cl(i,s,t,e,r);if(n&&r){var o=r.a,a=r.aInB;r.overlapN.negateSelf(),r.overlapV.negateSelf(),r.a=r.b,r.b=o,r.aInB=r.bInA,r.bInA=a}return n}});let Pl={pos:new Vr(0,0),ancestor:{_absPos:new Vr(0,0),getAbsolutePosition:function(){return this._absPos}}},Il=new class{constructor(){this.a=null,this.b=null,this.overlapN=new Vr,this.overlapV=new Vr,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE}clear(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}};function kl(t,e){return!0!==t.isKinematic&&!0!==e.isKinematic&&"object"==typeof t.body&&"object"==typeof e.body&&!(!0===t.body.isStatic&&!0===e.body.isStatic)&&0!=(t.body.collisionMask&e.body.collisionType)&&0!=(t.body.collisionType&e.body.collisionMask)}var Ol={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295},rayCast(t,e){return function(t,e=[]){for(var i,s=0,r=Gl.world.broadphase.retrieve(t),n=r.length;i=r[--n];)if(i.body&&t.getBounds().overlaps(i.getBounds())){var o=i.body.shapes.length;if(0===i.body.shapes.length)continue;var a=t,h=0;do{var l=i.body.getShape(h);Ml["test"+a.shapeType+l.shapeType].call(this,Pl,a,i,l)&&(e[s]=i,s++),h++}while(h<o)}return e.length=s,e}(t,e)}};class Bl{constructor(t,e,i){if(this.ancestor=t,void 0===this.bounds&&(this.bounds=Ur.pull("Bounds")),void 0===this.shapes&&(this.shapes=[]),this.collisionMask=Ol.types.ALL_OBJECT,this.collisionType=Ol.types.ENEMY_OBJECT,void 0===this.vel&&(this.vel=Ur.pull("Vector2d")),this.vel.set(0,0),void 0===this.force&&(this.force=Ur.pull("Vector2d")),this.force.set(0,0),void 0===this.friction&&(this.friction=Ur.pull("Vector2d")),this.friction.set(0,0),this.bounce=0,this.mass=1,void 0===this.maxVel&&(this.maxVel=Ur.pull("Vector2d")),this.maxVel.set(490,490),this.isStatic=!1,this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,"function"==typeof i&&(this.onBodyUpdate=i),this.bounds.clear(),void 0!==e)if(Array.isArray(e))for(var s=0;s<e.length;s++)this.addShape(e[s]);else this.addShape(e);this.ancestor.isKinematic=!1}setStatic(t=!0){this.isStatic=!0===t}addShape(t){if(t instanceof Ba||t instanceof Fa){var e=t.toPolygon();this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)}else t instanceof La?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addBounds(t.getBounds()),this.bounds.translate(t.getBounds().x,t.getBounds().y)):t instanceof Oa?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)):t instanceof Ua?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addPoint(t)):this.fromJSON(t);return"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this),this.shapes.length}setVertices(t,e=0,i=!0){var s=this.getShape(e);s instanceof Oa?s.setShape(0,0,t):this.shapes[e]=Ur.pull("Polygon",0,0,t),this.bounds.add(this.shapes[e].points,i),"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this)}addVertices(t,e=0){this.setVertices(t,e,!1)}fromJSON(t,e){var i=t;if(void 0!==e&&(i=t[e]),void 0===i)throw new Error("Identifier ("+e+") undefined for the given JSON object)");if(i.length){for(var s=0;s<i.length;s++)this.addVertices(i[s].shape,s);this.mass=i[0].density||0,this.friction.set(i[0].friction||0,i[0].friction||0),this.bounce=i[0].bounce||0}return i.length}getShape(t){return this.shapes[t||0]}getBounds(){return this.bounds}removeShape(t){this.bounds.clear(),Pr(this.shapes,t);for(var e=0;e<this.shapes.length;e++)this.addShape(this.shapes[e]);return this.shapes.length}removeShapeAt(t){return this.removeShape(this.getShape(t))}setCollisionMask(t=Ol.types.ALL_OBJECT){this.collisionMask=t}setCollisionType(t){if(void 0!==t){if(void 0===Ol.types[t])throw new Error("Invalid value for the collisionType property");this.collisionType=Ol.types[t]}}respondToCollision(t){var e=t.overlapV;if(this.ancestor.pos.sub(e),0!==e.x&&(this.vel.x=~~(.5+this.vel.x-e.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),0!==e.y&&(this.vel.y=~~(.5+this.vel.y-e.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce),!this.ignoreGravity)){var i=!0===this.falling?1:!0===this.jumping?-1:0;this.falling=e.y>=i,this.jumping=e.y<=-i}}forEach(t,e){var i=this,s=0,r=this.shapes,n=r.length;if("function"!=typeof t)throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);s<n;)t.call(i,r[s],s,r),s++}contains(){var t,e;if(2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.getBounds().contains(t,e))for(var i,s=this.shapes.length;s--,i=this.shapes[s];)if(i.contains(t,e))return!0;return!1}rotate(t,e=this.getBounds().center){return this.bounds.clear(),this.forEach((i=>{i.rotate(t,e),this.bounds.addBounds(i.getBounds()),i instanceof La?this.bounds.translate(i.getBounds().x,i.getBounds().y):this.bounds.translate(i.pos)})),this}setMaxVelocity(t,e){this.maxVel.x=t,this.maxVel.y=e}setFriction(t=0,e=0){this.friction.x=t,this.friction.y=e}update(t){var e=Rd.tick;if(0!==this.force.x&&(this.vel.x+=this.force.x*e),0!==this.force.y&&(this.vel.y+=this.force.y*e),this.friction.x>0){var i=this.friction.x*e,s=this.vel.x+i,r=this.vel.x-i;this.vel.x=s<0?s:r>0?r:0}if(this.friction.y>0){var n=this.friction.y*e,o=this.vel.y+n,a=this.vel.y-n;this.vel.y=o<0?o:a>0?a:0}return 0!==this.vel.y&&(this.vel.y=Er(this.vel.y,-this.maxVel.y,this.maxVel.y)),0!==this.vel.x&&(this.vel.x=Er(this.vel.x,-this.maxVel.x,this.maxVel.x)),this.falling=this.vel.y*Math.sign(this.force.y)>0,this.jumping=!this.falling&&this.jumping,this.ancestor.pos.add(this.vel),0!==this.vel.x||0!==this.vel.y}destroy(){Ur.push(this.bounds),Ur.push(this.vel),Ur.push(this.force),Ur.push(this.friction),Ur.push(this.maxVel),this.shapes.forEach((t=>{Ur.push(t,!1)})),this.onBodyUpdate=void 0,this.ancestor=void 0,this.bounds=void 0,this.vel=void 0,this.force=void 0,this.friction=void 0,this.maxVel=void 0,this.shapes.length=0,this.setStatic(!1)}}var Rl=function(t,e){this.removeChildNow(t,e)},Ll=0;class Dl extends ml{constructor(t=0,e=0,i=Gl.viewport.width,s=Gl.viewport.height,r=!1){super(t,e,i,s),this.pendingSort=null,this.root=r,this.children=void 0,this.sortOn=Gl.sortOn,this.autoSort=!0,this.autoDepth=!0,this.clipping=!1,this.onChildChange=function(t){},this.enableChildBoundsUpdate=!1,this.backgroundColor=Ur.pull("Color",0,0,0,0),this.drawCount=0,this.autoTransform=!0,this.isKinematic=!1,this.anchorPoint.set(0,0),!0===this.root&&Ln(Cn,this.updateBounds.bind(this,!0))}reset(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);for(var t,e=this.getChildren(),i=e.length;i>=0;t=e[--i])t&&!0!==t.isPersistent&&this.removeChildNow(t);void 0!==this.currentTransform&&this.currentTransform.identity(),this.backgroundColor.setColor(0,0,0,0)}addChild(t,e){return t.ancestor instanceof Dl?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=Bd.createGUID(t.id)),t.ancestor=this,this.getChildren().push(t),void 0!==t.pos&&("number"==typeof e?t.pos.z=e:!0===this.autoDepth&&(t.pos.z=this.getChildren().length)),!0===this.autoSort&&this.sort(),"function"==typeof t.onActivateEvent&&this.isAttachedToRoot()&&t.onActivateEvent(),!0===this.isAttachedToRoot()&&Gl.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),t.body instanceof Bl&&Gl.world.addBody(t.body),this.onChildChange.call(this,this.getChildren().length-1),t}addChildAt(t,e){if(e>=0&&e<this.getChildren().length)return t.ancestor instanceof Dl?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=Bd.createGUID()),t.ancestor=this,this.getChildren().splice(e,0,t),"function"==typeof t.onActivateEvent&&this.isAttachedToRoot()&&t.onActivateEvent(),!0===this.isAttachedToRoot()&&Gl.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),t.body instanceof Bl&&Gl.world.addBody(t.body),this.onChildChange.call(this,e),t;throw new Error("Index ("+e+") Out Of Bounds for addChildAt()")}forEach(t,e){var i=this,s=0,r=this.getChildren(),n=r.length;if("function"!=typeof t)throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);s<n;)t.call(i,r[s],s,r),s++}swapChildren(t,e){var i=this.getChildIndex(t),s=this.getChildIndex(e);if(-1===i||-1===s)throw new Error(t+" Both the supplied childs must be a child of the caller "+this);var r=t.pos.z;t.pos.z=e.pos.z,e.pos.z=r,this.getChildren()[i]=e,this.getChildren()[s]=t,this.isDirty=!0}getChildAt(t){if(t>=0&&t<this.getChildren().length)return this.getChildren()[t];throw new Error("Index ("+t+") Out Of Bounds for getChildAt()")}getChildIndex(t){return this.getChildren().indexOf(t)}getNextChild(t){var e=this.getChildren().indexOf(t)-1;if(e>=0&&e<this.getChildren().length)return this.getChildAt(e)}hasChild(t){return this===t.ancestor}getChildByProp(t,e){var i=[];return this.forEach((s=>{!function(t,s){var r=t[s];e instanceof RegExp&&"string"==typeof r?e.test(r)&&i.push(t):r===e&&i.push(t)}(s,t),s instanceof Dl&&(i=i.concat(s.getChildByProp(t,e)))})),i}getChildByType(t){var e=[];return this.forEach((i=>{i instanceof t&&e.push(i),i instanceof Dl&&(e=e.concat(i.getChildByType(t)))})),e}getChildByName(t){return this.getChildByProp("name",t)}getChildByGUID(t){var e=this.getChildByProp("GUID",t);return e.length>0?e[0]:null}getChildren(){return void 0===this.children&&(this.children=[]),this.children}updateBounds(t=!1){super.updateBounds();var e=this.getBounds();return!0!==t&&!0!==this.enableChildBoundsUpdate||this.forEach((t=>{t.isRenderable&&t.getBounds().isFinite()&&e.addBounds(t.getBounds())})),e}isAttachedToRoot(){if(!0===this.root)return!0;for(var t=this.ancestor;t;){if(!0===t.root)return!0;t=t.ancestor}return!1}updateBoundsPos(t,e){return super.updateBoundsPos(t,e),this.forEach((i=>{i.isRenderable&&i.updateBoundsPos(i.pos.x+t-this.pos.x,i.pos.y+e-this.pos.y)})),this.getBounds()}onActivateEvent(){this.forEach((t=>{"function"==typeof t.onActivateEvent&&t.onActivateEvent()}))}removeChild(t,e){if(!this.hasChild(t))throw new Error("Child is not mine.");Bd.function.defer(Rl,this,t,e)}removeChildNow(t,e){if(this.hasChild(t)&&this.getChildIndex(t)>=0){"function"==typeof t.onDeactivateEvent&&t.onDeactivateEvent(),t.body instanceof Bl&&Gl.world.removeBody(t.body),e||!1===Ur.push(t,!1)&&"function"==typeof t.destroy&&t.destroy();var i=this.getChildIndex(t);i>=0&&(this.getChildren().splice(i,1),t.ancestor=void 0),!0===this.isAttachedToRoot()&&Gl.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),this.onChildChange.call(this,i)}}setChildsProperty(t,e,i){this.forEach((s=>{!0===i&&s instanceof Dl&&s.setChildsProperty(t,e,i),s[t]=e}))}moveUp(t){var e=this.getChildIndex(t);e-1>=0&&(this.swapChildren(t,this.getChildAt(e-1)),this.isDirty=!0)}moveDown(t){var e=this.getChildIndex(t);e>=0&&e+1<this.getChildren().length&&(this.swapChildren(t,this.getChildAt(e+1)),this.isDirty=!0)}moveToTop(t){var e=this.getChildIndex(t);if(e>0){var i=this.getChildren();i.splice(0,0,i.splice(e,1)[0]),t.pos.z=i[1].pos.z+1,this.isDirty=!0}}moveToBottom(t){var e=this.getChildIndex(t),i=this.getChildren();e>=0&&e<i.length-1&&(i.splice(i.length-1,0,i.splice(e,1)[0]),t.pos.z=i[i.length-2].pos.z-1,this.isDirty=!0)}sort(t){this.pendingSort||(!0===t&&this.forEach((e=>{e instanceof Dl&&e.sort(t)})),this.pendingSort=Bd.function.defer((function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]),this.pendingSort=null,Gl.repaint()}),this))}onDeactivateEvent(){this.forEach((t=>{"function"==typeof t.onDeactivateEvent&&t.onDeactivateEvent()}))}_sortZ(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z:t.pos?-1/0:1/0}_sortReverseZ(t,e){return t.pos&&e.pos?t.pos.z-e.pos.z:t.pos?1/0:-1/0}_sortX(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z||e.pos.x-t.pos.x:t.pos?-1/0:1/0}_sortY(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z||e.pos.y-t.pos.y:t.pos?-1/0:1/0}destroy(){this.reset(),super.destroy(arguments)}update(t){for(var e,i=!1,s=uu.isPaused(),r=this.getChildren(),n=r.length;n--,e=r[n];)s&&!e.updateWhenPaused||(e.isRenderable?((i=Ll>0||e.floating)&&Ll++,e.inViewport=!1,uu.current().cameras.forEach((function(t){t.isVisible(e,i)&&(e.inViewport=!0)})),this.isDirty|=(e.inViewport||e.alwaysUpdate)&&e.update(t),Ll>0&&Ll--):this.isDirty|=e.update(t));return super.update(t)}draw(t,e){var i=!1,s=this.getBounds();this.drawCount=0,!1===this.root&&!0===this.clipping&&!0===s.isFinite()&&t.clipRect(s.left,s.top,s.width,s.height),t.translate(this.pos.x,this.pos.y),this.backgroundColor.alpha>1/255&&t.clearColor(this.backgroundColor);for(var r,n=this.getChildren(),o=n.length;r=n[--o];)r.isRenderable&&(i=!0===r.floating,(r.inViewport||i)&&(i&&(t.save(),t.resetTransform()),r.preDraw(t),r.draw(t,e),r.postDraw(t),i&&t.restore(),this.drawCount++))}}var Fl=[];function zl(t,e,i=4,s=4,r=0){if(Fl.length>0){var n=Fl.pop();return n.world=t,n.bounds=e,n.max_objects=i,n.max_levels=s,n.level=r,n}return new Vl(t,e,i,s,r)}var Ul=new Vr;class Vl{constructor(t,e,i=4,s=4,r=0){this.world=t,this.bounds=e,this.max_objects=i,this.max_levels=s,this.level=r,this.bounds=e,this.objects=[],this.nodes=[]}split(){this.level;var t=this.bounds.width/2,e=this.bounds.height/2,i=this.bounds.left,s=this.bounds.top;this.nodes[0]=zl(this.world,this.bounds,{left:i+t,top:s,width:t,height:e},this.max_objects,this.max_levels),this.nodes[1]=zl(this.world,this.bounds,{left:i,top:s,width:t,height:e},this.max_objects,this.max_levels),this.nodes[2]=zl(this.world,this.bounds,{left:i,top:s+e,width:t,height:e},this.max_objects,this.max_levels),this.nodes[3]=zl(this.world,this.bounds,{left:i+t,top:s+e,width:t,height:e},this.max_objects,this.max_levels)}getIndex(t){var e,i=t.getBounds(),s=-1,r=(e=!0===t.isFloating?this.world.app.viewport.localToWorld(i.left,i.top,Ul):Ul.set(t.left,t.top)).x,n=e.y,o=i.width,a=i.height,h=this.bounds.left+this.bounds.width/2,l=this.bounds.top+this.bounds.height/2,u=n<l&&n+a<l,d=n>l;return r<h&&r+o<h?u?s=1:d&&(s=2):r>h&&(u?s=0:d&&(s=3)),s}insertContainer(t){for(var e,i=t.children.length;i--,e=t.children[i];)!0!==e.isKinematic&&(e instanceof Dl?("rootContainer"!==e.name&&this.insert(e),this.insertContainer(e)):"function"==typeof e.getBounds&&this.insert(e))}insert(t){var e=-1;if(this.nodes.length>0&&-1!==(e=this.getIndex(t)))this.nodes[e].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){0===this.nodes.length&&this.split();for(var i=0;i<this.objects.length;)-1!==(e=this.getIndex(this.objects[i]))?this.nodes[e].insert(this.objects.splice(i,1)[0]):i+=1}}retrieve(t,e){var i=this.objects;if(this.nodes.length>0){var s=this.getIndex(t);if(-1!==s)i=i.concat(this.nodes[s].retrieve(t));else for(var r=0;r<this.nodes.length;r+=1)i=i.concat(this.nodes[r].retrieve(t))}return"function"==typeof e&&i.sort(e),i}remove(t){var e=!1;if(void 0===t.getBounds)return!1;if(this.nodes.length>0){var i=this.getIndex(t);-1!==i&&(e=Pr(this.nodes[i],t))&&this.nodes[i].isPrunable()&&this.nodes.splice(i,1)}return!1===e&&-1!==this.objects.indexOf(t)&&(Pr(this.objects,t),e=!0),e}isPrunable(){return!(this.hasChildren()||this.objects.length>0)}hasChildren(){for(var t=0;t<this.nodes.length;t+=1){var e=this.nodes[t];if(e.length>0||e.objects.length>0)return!0}return!1}clear(t){this.objects.length=0;for(var e=0;e<this.nodes.length;e++)this.nodes[e].clear(),i=this.nodes[e],Fl.push(i);var i;this.nodes.length=0,void 0!==t&&this.bounds.setMinMax(t.min.x,t.min.y,t.max.x,t.max.y)}}class Nl extends Dl{constructor(t=0,e=0,i=1/0,s=1/0){super(t,e,i,s,!0),this.name="rootContainer",this.anchorPoint.set(0,0),this.app=null,this.fps=60,this.gravity=new Vr(0,.98),this.preRender=!1,this.bodies=new Set,this.broadphase=new Vl(this,this.getBounds().clone(),Ol.maxChildren,Ol.maxDepth),Ln(un,this.reset,this),Ln(mn,(()=>{this.broadphase.clear(this.getBounds())}))}reset(){this.broadphase.clear(),this.anchorPoint.set(0,0),super.reset(),this.bodies.clear()}addBody(t){return this.bodies.add(t),this}removeBody(t){return this.bodies.delete(t),this}bodyApplyGravity(t){if(!t.ignoreGravity&&0!==t.gravityScale){var e=this.gravity;t.force.x+=t.mass*e.x*t.gravityScale,t.force.y+=t.mass*e.y*t.gravityScale}}update(t){var e=uu.isPaused();return this.broadphase.clear(),this.broadphase.insertContainer(this),this.bodies.forEach((i=>{if(!i.isStatic){var s=i.ancestor;e&&!s.updateWhenPaused||!s.inViewport&&!s.alwaysUpdate||(this.bodyApplyGravity(i),!0===i.update(t)&&(s.isDirty=!0),function(t,e=Il){for(var i,s=Gl.world.broadphase.retrieve(t),r=s.length;i=s[--r];)if(i!==t&&kl(t,i)&&t.body.getBounds().overlaps(i.body.getBounds())){var n=t.body.shapes.length,o=i.body.shapes.length;if(0===n||0===o)continue;var a=0;do{var h=t.body.getShape(a),l=0;do{var u=i.body.getShape(l);!0===Ml["test"+h.shapeType+u.shapeType].call(this,t,h,i,u,e.clear())&&(e.indexShapeA=a,e.indexShapeB=l,t.onCollision&&!1!==t.onCollision(e,i)&&!1===t.body.isStatic&&t.body.respondToCollision.call(t.body,e),i.onCollision&&!1!==i.onCollision(e,t)&&!1===i.body.isStatic&&i.body.respondToCollision.call(i.body,e)),l++}while(l<o);a++}while(a<n)}}(s),i.force.set(0,0))}})),super.update(t)}}let Gl=new class{constructor(){this.viewport=null,this.world=null,this.mergeGroup=!0,this.sortOn="z",this.lastUpdate=0,this.isDirty=!0,this.isAlwaysDirty=!1,this.frameCounter=0,this.frameRate=1,this.accumulator=0,this.accumulatorMax=0,this.accumulatorUpdateDelta=0,this.stepSize=1e3/60,this.updateDelta=0,this.lastUpdateStart=null,this.updateAverageDelta=0}init(){this.world=new Nl,this.world.app=this,this.lastUpdate=globalThis.performance.now(),Rn(ln,this)}reset(){var t=uu.get();void 0!==t&&(this.viewport=t.cameras.get("default")),Rn(un),this.updateFrameRate()}onLevelLoaded(){}updateFrameRate(){this.frameCounter=0,this.frameRate=~~(.5+60/Rd.maxfps),this.stepSize=1e3/this.world.fps,this.accumulator=0,this.accumulatorMax=10*this.stepSize,this.isAlwaysDirty=Rd.maxfps>this.world.fps}getParentContainer(t){return t.ancestor}repaint(){this.isDirty=!0}update(t,e){if(++this.frameCounter%this.frameRate==0){for(this.frameCounter=0,Rn(dn,t),this.accumulator+=Rd.getDelta(),this.accumulator=Math.min(this.accumulator,this.accumulatorMax),this.updateDelta=Rd.interpolation?Rd.getDelta():this.stepSize,this.accumulatorUpdateDelta=Rd.interpolation?this.updateDelta:Math.max(this.updateDelta,this.updateAverageDelta);this.accumulator>=this.accumulatorUpdateDelta||Rd.interpolation;)if(this.lastUpdateStart=globalThis.performance.now(),!0!==uu.isPaused()&&Rn(pn,t),this.isDirty=e.update(this.updateDelta)||this.isDirty,this.lastUpdate=globalThis.performance.now(),this.updateAverageDelta=this.lastUpdate-this.lastUpdateStart,this.accumulator-=this.accumulatorUpdateDelta,Rd.interpolation){this.accumulator=0;break}Rn(cn,this.lastUpdate)}}draw(t){!0===Sd.isContextValid&&(this.isDirty||this.isAlwaysDirty)&&(Rn(fn,globalThis.performance.now()),Sd.clear(),t.draw(Sd),this.isDirty=!1,Sd.flush(),Rn(gn,globalThis.performance.now()))}};Ln(en,(()=>{Gl.init()}));const jl=Math.min,Hl=Math.max;var Xl,Yl=new Vr;class Wl extends ml{constructor(t,e,i,s){super(t,e,i-t,s-e),this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=Ur.pull("Bounds"),this.smoothFollow=!0,this.damping=1,this.near=-1e3,this.far=1e3,this.projectionMatrix=new Zr,this.invCurrentTransform=new Qr,this.offset=new Vr,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,tween:null},this._fadeIn={color:null,tween:null},this.name="default",this.setDeadzone(this.width/6,this.height/6),this.anchorPoint.set(0,0),this.isKinematic=!1,this.bounds.setMinMax(t,e,i,s),this._updateProjectionMatrix(),Ln(un,this.reset,this),Ln(Cn,this.resize,this)}_updateProjectionMatrix(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}_followH(t){var e=this.pos.x;return t.x-this.pos.x>this.deadzone.right?e=jl(t.x-this.deadzone.right,this.bounds.width-this.width):t.x-this.pos.x<this.deadzone.pos.x&&(e=Hl(t.x-this.deadzone.pos.x,this.bounds.left)),e}_followV(t){var e=this.pos.y;return t.y-this.pos.y>this.deadzone.bottom?e=jl(t.y-this.deadzone.bottom,this.bounds.height-this.height):t.y-this.pos.y<this.deadzone.pos.y&&(e=Hl(t.y-this.deadzone.pos.y,this.bounds.top)),e}reset(t=0,e=0){this.pos.x=t,this.pos.y=e,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()}setDeadzone(t,e){void 0===this.deadzone&&(this.deadzone=new Ba(0,0,0,0)),this.deadzone.pos.set(~~((this.width-t)/2),~~((this.height-e)/2-.25*e)),this.deadzone.resize(t,e),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0}resize(t,e){return super.resize(t,e),this.smoothFollow=!1,this.setBounds(0,0,t,e),this.setDeadzone(t/6,e/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),Rn(Mn,this.width,this.height,this),this}setBounds(t,e,i,s){this.smoothFollow=!1,this.bounds.setMinMax(t,e,i+t,s+e),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0}follow(t,e,i){if(t instanceof ml)this.target=t.pos;else{if(!(t instanceof Vr||t instanceof oh||t instanceof nh||t instanceof ah))throw new Error("invalid target for me.Camera2d.follow");this.target=t}this.follow_axis=void 0===e?this.AXIS.BOTH:e,this.smoothFollow=!1,this.damping="number"!=typeof i?1:Er(i,0,1),this.updateTarget(),this.smoothFollow=!0}unfollow(){this.target=null,this.follow_axis=this.AXIS.NONE}move(t,e){this.moveTo(this.pos.x+t,this.pos.y+e)}moveTo(t,e){var i=this.pos.x,s=this.pos.y;this.pos.x=Er(t,this.bounds.left,this.bounds.width),this.pos.y=Er(e,this.bounds.top,this.bounds.height),i===this.pos.x&&s===this.pos.y||(this.isDirty=!0)}updateTarget(){if(this.target){switch(Yl.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:Yl.x=this._followH(this.target);break;case this.AXIS.VERTICAL:Yl.y=this._followV(this.target);break;case this.AXIS.BOTH:Yl.x=this._followH(this.target),Yl.y=this._followV(this.target)}if(!this.pos.equals(Yl)){if(!0===this.smoothFollow&&this.damping<1){if(Mr(Yl.x,this.pos.x,2)&&Mr(Yl.y,this.pos.y,2))return void this.pos.setV(Yl);this.pos.lerp(Yl,this.damping)}else this.pos.setV(Yl);this.isDirty=!0}}}update(t){return this.updateTarget(t),this._shake.duration>0&&(this._shake.duration-=t,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):(this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.HORIZONTAL||(this.offset.x=(Math.random()-.5)*this._shake.intensity),this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.VERTICAL||(this.offset.y=(Math.random()-.5)*this._shake.intensity)),this.isDirty=!0),!0===this.isDirty&&Rn(kn,this.pos),null==this._fadeIn.tween&&null==this._fadeOut.tween||(this.isDirty=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),super.update(t)}shake(t,e,i,s,r){0!==this._shake.duration&&!0!==r||(this._shake.intensity=t,this._shake.duration=e,this._shake.axis=i||this.AXIS.BOTH,this._shake.onComplete="function"==typeof s?s:void 0)}fadeOut(t,e=1e3,i){this._fadeOut.color=Ur.pull("Color").copy(t),this._fadeOut.tween=Ur.pull("Tween",this._fadeOut.color).to({alpha:0},e).onComplete(i||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()}fadeIn(t,e=1e3,i){this._fadeIn.color=Ur.pull("Color").copy(t);var s=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=Ur.pull("Tween",this._fadeIn.color).to({alpha:s},e).onComplete(i||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()}focusOn(t){var e=t.getBounds();this.moveTo(t.pos.x+e.left+e.width/2,t.pos.y+e.top+e.height/2)}isVisible(t,e=t.floating){return!0===e||!0===t.floating?Sd.overlaps(t.getBounds()):t.getBounds().overlaps(this)}localToWorld(t,e,i){return(i=i||Ur.pull("Vector2d")).set(t,e).add(this.pos).sub(Gl.world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(i),i}worldToLocal(t,e,i){return(i=i||Ur.pull("Vector2d")).set(t,e),this.currentTransform.isIdentity()||this.currentTransform.apply(i),i.sub(this.pos).add(Gl.world.pos)}drawFX(t){this._fadeIn.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeIn.color),t.fillRect(0,0,this.width,this.height),t.restore(),1===this._fadeIn.color.alpha&&(this._fadeIn.tween=null,Ur.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeOut.color),t.fillRect(0,0,this.width,this.height),t.restore(),0===this._fadeOut.color.alpha&&(this._fadeOut.tween=null,Ur.push(this._fadeOut.color),this._fadeOut.color=null))}draw(t,e){var i=this.pos.x+this.offset.x,s=this.pos.y+this.offset.y;e.currentTransform.translate(-i,-s),t.setProjection(this.projectionMatrix),t.clipRect(0,0,this.width,this.height),this.preDraw(t),e.preDraw(t,this),e.draw(t,this),this.drawFX(t),e.postDraw(t,this),this.postDraw(t),e.currentTransform.translate(i,s)}}var Kl={cameras:[]};class ql{constructor(t){this.cameras=new Map,this.lights=new Map,this.ambientLight=new qr(0,0,0,0),this.settings=Object.assign(Kl,t||{})}reset(){if(this.settings.cameras.forEach((t=>{this.cameras.set(t.name,t)})),!1===this.cameras.has("default")){if(void 0===Xl){var t=Sd.getWidth(),e=Sd.getHeight();Xl=new Wl(0,0,t,e)}this.cameras.set("default",Xl)}Gl.reset(),this.onResetEvent.apply(this,arguments)}update(t){var e=Gl.world.update(t);return this.cameras.forEach((function(i){!0===i.update(t)&&(e=!0)})),this.lights.forEach((i=>{!0===i.update(t)&&(e=!0)})),e}draw(t){this.cameras.forEach((e=>{e.draw(t,Gl.world),0!==this.ambientLight.alpha&&(t.save(),this.lights.forEach((e=>{t.setMask(e.getVisibleArea(),!0)})),t.setColor(this.ambientLight),t.fillRect(0,0,e.width,e.height),t.clearMask(),t.restore()),this.lights.forEach((e=>{e.preDraw(t,Gl.world),e.draw(t,Gl.world),e.postDraw(t,Gl.world)}))}))}destroy(){this.cameras.clear(),this.lights.forEach((t=>{t.destroy()})),this.lights.clear(),this.onDestroyEvent.apply(this,arguments)}onResetEvent(){"function"==typeof this.settings.onResetEvent&&this.settings.onResetEvent.apply(this,arguments)}onDestroyEvent(){"function"==typeof this.settings.onDestroyEvent&&this.settings.onDestroyEvent.apply(this,arguments)}}class Zl extends ml{constructor(t,e,i,s){super(t,e,i,s),this.barHeight=s,this.anchorPoint.set(0,0),Ln(vn,this.onProgressUpdate,this),Ln(Mn,this.resize,this),this.anchorPoint.set(0,0),this.progress=0}onProgressUpdate(t){this.progress=~~(t*this.width),this.isDirty=!0}draw(t,e){t.setColor("black"),t.fillRect(this.pos.x,e.centerY,t.getWidth(),this.barHeight/2),t.setColor("#55aa00"),t.fillRect(this.pos.x,e.centerY,this.progress,this.barHeight/2)}onDestroyEvent(){Fn(vn,this.onProgressUpdate),Fn(Mn,this.resize)}}class Ql extends ql{onResetEvent(){Gl.world.backgroundColor.parseCSS("#202020"),Gl.world.addChild(new Zl(0,Sd.getHeight()/2,Sd.getWidth(),8),1),Ju.load({name:"melonjs_logo",type:"image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAA8FBMVEUgICBrqDHRZVtqpzEhJCAjKCBurTIfHyDQZFptrDEWAB8OAB7VZ1wtIiIAEhYlISDYaF4SAB4pIiEAFhkcFh8eGyBopDAMAB5noS8kKyAAGhtjmy4bEB9lni8ZBR/HYFdPeim/XFQ9XCUaCh9flS1VhCtSfyorOSEVHh4HHB1EZyatVExhmC5ajCxHbSc0SyMuQCInMiFKcSgxRSI6VSRBYiWdTUZdki09JyZ8PzpYiSs3UCRlNjK1WE9ckC1MdShbjywyJCONRkDKYliUSUNeMzBDKShXMC2kUEl1PDeEQj1OLStnNjNxOjZsODQAAAcMh1CFAAAU4UlEQVR42uyaa3fSMBjHk5EQkgClkBZKoXblNhlswIooc2N6pp7jUb//x/FpRbnt4JWwzv7eraQvfs/zby7tUEpKSkpKSkpKSkpKSkpKSkqKTsg30P8E+FIArJllqQaglMXQt6tPuhogGSlaLWFKKU2hEB33eqPRqDemRAlhRhdbVjwIBj8xogajhpBSkNH1dOJ37mYDt1mr2UCt1mwOZned7qQfjhxPVs0WovTpRIFFNkpIU42CSWfm2phnIzjHP+DLS9hutjuL4IqZUigC9yU/CWDBhBROOJkPbBxL4swKjDf/jEvBbXe4CMeiKixKEx0EAq03JbqeDJs4Ul9a7mE5AqqAazM/pJCb5JaAUmWa42nHBflYDf8y8WC4qznv9yRKZAUIRUKO+/Maz/J1+d8ugu0rK3kVoNSTVhDZr8v/WRGyQw8lC0KJMK989+/sVzXILiRNzmrACGXSC4Z2lsf2f08GN2lyHgJCLUn6bRw1/2dim+A9hIKiJMAQ6NOJu7f5a7r8B+u/7N7BAzMZBaBIkkkz0t83sfMsgDHsgN1BOybaFNvww2qblMgEUGKqi2aU/X3u2HZnHf8iuL4aO0S1PKDVQM54dBn0F50718bfq5CwOYBQIaaDVfd37MG91u5MwhER8WHQU8qC2wCEmFJefEYUrBdedGe15b4xQasAtaqXt/wh/W87W1679YNeCxQbjNCItTchBFheRErAmHEYb575ch/Qeuz9ByXpdHH2QX2wx4NuMBbSbJCfn3IJWZ4dndBvZ6Bytt949A8AbZjT6OHftQeDTHtx2VgebhFj6KfAmGisJaS46k+mj/4sELW/N+QP6UOIXf/Sqwq0p/F7okA8KU312BcAqmTf3k1/1Hx7HlgyskfsL96h7b3XMNCRcYQzz+KH9N3FSC57fxiYUTDOWLmAjgcjpBo2d9oPKxdv95Fs0UPGl5XPinWDVYqGwdBxYFQJH/Mdfc5nQUuyw77KYYXKm/ub09PzV/Xn5SNVAOJ/B/Hf0W8HwiQUHRTwf/2slM/nS6WbN/XjZIDK6534w8zv9r1In6GDUq6/y+VzMaVTdGYg7cDj38/wHX17YknQPzSGUb8p5U5icqX7ovaZkBFk+nw7/hx3epIdvPtAufIpf7Ikl39W0B0BRpToQPy32j8IZUPPW+xC8S0E4Afv6noLwGgL3WZ32u8roetbTqF4v1aA/JdKGWmEUc8ZgP/m0j+4riKKNFEoflwrQO6D1gQwKnrulj/mXUto048XgZV+/vQMaYQ5otfc8s/Wpprav5oFz5cRgHXwo85VgFHw55nN+Ld7UvMnPOP5y2elXMRJ6VzDA7DPH2e7XstBemHl+vubfAk4efGc6SsAo9542x9fVJH+D/lQgfrnF+fn9++KWv0bdHP+z3A7rFKC9MMMo1KsVIr1ssYHgFiqvemfdUemg45EuVAuFMpIH4SI4ZZ/2xEOQ8eCAUgjVHa3/G+txuN/Z/+vYE51suU/9NT/5G8GIL3uPxfsCfwf11fyrW1FgRiGTkna0vZpYHQUXRHdVZBhvCMorP7/V+3oyprgPiy2Dxk2HzA06TknpyHz19CjVfcpf9kj+6SBtqgcMPz/q/vPdPgwLP/DsCM1f2vTf7Ifap5/hYXQ/FGnX7S16LdABADc23oqVP91kYfgrU5b1GxKHSCo7tILzR/z9eJ8nliv0zqAMZ8ATEJfaP6+7jlj3CDlXpHVfsfnH+eyn4kMzMdGQRNO7fNkGEXbGTigBkDq1lZzU07BnaXzIab6LCMAuEEmdWcD8+ax9uNTckxFqyWxwKBgKXZrzerHtAbcPhFQ0R8oAExdChXADIt1Tz0KkGi9TjML1CBLqgA0YZGIFZhZqVNUtf9GCdBbF0IF4Be/vvQYz6pyxhRwH+QC4CpXoAgELvE6iKMtfwJLzv+5YU2iDasOR0MJMBdMgFsMK6ICrppGY+rELGAdhFpAYoXYgRdBRzsLUtB3L/z+7zpITFvHYhQAdorGyQudAdCuNe8qoJjVNgYAF0M+9iFbAe9tK2w4BKIIdVJ0CLASv7jeBFo7cBwCrxcgP1IAjEv5ALipwII1gmGGMR4A2uEB+blJK4x4E1kdZhQA5xYowPe58z3lwKfH199WbQRAc/LpuwPWu17k0qaFCnANAgHSvKJcZdMCxJtgOsQuKsexG2uCwMxa8O8aUa/axHZCe/OUZA42ag0Avqi5ll2nYSAaRQEbZI+NrbKwEFFYJURCiEcpqEE0aZOmBfH/f4PLQ+OEttwxLKg3jq5Or3TG9jyOJ/FjgSIGZvBRLhB1oFvi7/3X5CIDhZHodOLtfyyEXUlh0IGzyDoQM+rbGljFRNaE2ZOXj0MT3pALxGQo8v1z1ILRBb6+hTJoZgLvBoMYRjZAeALuv/v/hZCzeTxWRIu/iwEvbqQMmKcxUekwHqF/KQSo74OCVX8rCyQoC9C/QYBZENZTcYMlRkqjWFlVZfn9OWGXwcoDVFKewD+fo33v9AwQD3HGFqH5XsXHACWVA7BObfp+YyoL4BKpLvb+MuvBlVn1q03iwIONVNFy1jPUBvGyPOaGJT4GGOPAHd9v66bIuy7Pi3p5GKoTrYSdeRXaQrk7LD02P2Gbejv2FqrYdugFxgHM5ChBEFNpIn/czxaObdMJrcXP4Z94sdxZUGZmAZmA+7ws0im4a9oenFQsKg58uE8NhBgE43+LlBysa65FmvJweIppMzobsmJKWve+EFrMsUJ3+wEqGaUKPA9XkSYNhj0xUd8xYkbBsU516lnMhv+LFs1nKCX7BZYVjIUQZ8FC830PRjG6LnSqBzCSPcloP0U9IaLZhknntlynSGhOS+yV/bWuEla1EPwSONXdAc0VKYv4ZcyoWQBGEDp/2zdI/zyrYgfyR6CAL7nm18BC18pJFnlLhuUMsScgvs9CwjrXyOgCq/Q9yIQpBa0Q/DqW6+JoJSNX9AGNT4S2uezhx8B9kBvu2AZGjpQubwLRglHKLnX6Z7DodmgBQjDHkji7O3+MoFFZgITx+pLiMdiChL1G7DUL8DWQLBDPw3dGh5Yjn38YT+TuMrhuvy71HbGiGyzRAg8DVYQQzO49evYg7ArLiP7v82/7n3OcZ8u6F36+IzjfVCqivwkTetqNCHpP2nvdfS74PJTr7zH+NM9pTflPwTMbcN1YkgEwFcL7EXIddf85LQ1SrtZ8FsO6uh13w7Abt02nZ7tjbiuR1+2Xn2COYPxaCCM3+KCqQz86fnpDSgOkPQg+i/dtb8E6P/zUt8Vln+/pF4fVD7D103Gbz8B8cIbULeJlHXqLM2ZQZDHEuGMnpsF+m0Alpfk+pKmAtZdCJNf5wUGJYAervRB8eggotSH2SlAy2myBchi14VbCxKlzka+BScWCqofBUASYCbsVKAQzD65g7CbmEl9OCTQtocEm74ysiPsq6imhilLVxANyUfR2o9i0SN7YstH8DP+9db+DYcD/iFsgqnXWd02SXAc9CrLpx124yFd2w35HlQ4tEPCHxPwO9haY7oG1NbQbMnLPYPbw2YNIMYAlxeTIDlP+WP0axAUhTrGzefUXEeK+kXetvU3DUDQtqdxKSQwJG1romIbQSLWhfuChFRioG92rsP//c3AiwbErxfKxBMoFf/am5cyPc+899/hDkTOJHZ4IKMQQrC6irDZTh+YVa9VHlsbuyK6uEe7tINCdK9hVutGkUgL/S0pox5cEchPX2X9qrXVfuIQIoAcsDN2sj+yb5XuVU8JZlgkpZ+PMzMbhvG0AwKqfteh6O3VZbqL8J4tNhggAluxxBgaNEIK7A/BNWvkWC7DCV/X+3qsMU0+LkqiS75NyMUhD+LqqrjdT51TPlQeAVTZ11nXpW1nm1sDOWhA1blBBcGEincwV1crqwV7Vq6r0U8ZxiCEevONwtzaaKnGS6X3lCGRHSwaAuyzU4Uyr5tjaLv4wL6+cm3BbxwFw9pSujJsfowBY2UfAutHeyRftZGwXb4RxY2+XDQHAgQGAlblMHI382xeRABwnSicBpyDYjS/HADYILhiYFAMA6k8DUDgANCQAfue0bPy3AeC3QD48AGK2gHLOgJFwAKhDENfgvwkArkGGCH0SDcAuEeKp8MhQYcEAtFT4EU2Fn9nB0HvJAExQHEMwRIfDogFgw2GI7eGXIhkANyESlxITvQLc/2UwAO+cLILgW4BMikIg46TF01QwAGxaHOwBuoI9uQBwhRGMPbs09nouFwCo3fAlLG6GCooFAMVRrGVaXTUz5XGxAHjK44xAQioArUBiZgskYiUyUrcAKhygdDEiqT2xPACZDS6qSe2+y04hIROAFM5aSO6F2qe5pmxDAMBJivJCydFhqsiOK9SHhQLQNb/ahTHFycsglh7EFogB4IQUSyORsqT841Aay8aBxR7VqYlQHPfK33SysAUVwY/qzF/ZO5kRfKLljAkidJMfZaEPgJXVD+ubNnUZqL0yS0upwKAOWidW7ZY++UhSIRQxp79KmAvth8sIha5Q8VZJ0B6YdquFaZlBTjyl7UMQEQcXyG8fZ93TN+MHCJv75l4bzWQ3+RhlRI8A2UzGozpEdpvjgSDRYALh7TY6qS+PWpHvBcT9nmdizk+nmQHsNq+xAHoRuLkYt21k32qlQ/01D0es0gVUCIcAZUimdbG+u7z/XOP7PQgsiu395WpbNKUKaEKqNmbyeZFoNiEKOscrDHkf1bxpmz91GdZY2HWHhjWHlt3kRc6bS/I2IoijIkyadZ7nJTNZU5PpByHAAmhXvkgfGqXUACY77fOc5h2SeXRciTNQ2Gkef56oOAsNtF1KQwCRIN/9CxqFZII8E5WXFpdFiZeW2oNHyRrIhSAfGrMHUCUfrKN8yAI+oYyUkFK2HaVFW2khtR/rPzDal+UkZGjwzOMAwRSJkReScwyi5QGdEvxI2wqZSEdNeGryRNYl018dT9X/zlIzndt0eHR4MNSnVXyPgoAGR3tKYidJ8dOa4PRCTTD2eRl7CUyEmAqirIHqbuxveuOcAjIuApwAHjNFKqmC5lsZIdH8zGuuzp8mYJQCTgGo/FARix7KMSQzYzn8vAAU8gFGcPQS+DJ8AH4rndH8PqQ3S35yd2U7isNAMFHasWw/WcopQhRBIBICQsggJCIx/P9XrTMcDWbZY5YQs36Yh4EZXNXl7vJB3Hkjd7fCkCfc3/ZGbgh4zp5xwYbuBdBWGr00pF2OrT0E6p/sIH6V1uRHTANeDv1NE/j4rB1mFYMHgTYJsJtnrGORL1W9w107NA4/u+gqjL+cFXprU2+cbSvA828GxFKImwRmLpDiji6WwCdvsuDjOU1MA7iI+WzXBj4MmfFpQKuAeC7wOdss6n8afe8qjaUaqNdRWoeEPt1g4wPGpFkMUJKuIruDAaA/ahsToVmXr4NnYanq4GI4eq4waLKJZxADYF12MvFIEO3EZKPLTMxxhADo1ztK0zgtxIND3JhieKnTeKEEhacT4F9OHOB+qRkMXHZwcCOzgwxFv76IfKszMxgg4bqNDDa26cSs01hsmKMtDlj9X8La4sfAdHkvHn6vHhngtGcGAJT+EX+3RxnwDDV+GPf7rIYUQGQa/tyj3RFA063GwN4f98cAJT6f3HaIDaukO1FS8GCuMTCveGz10yhJvIWGP+rWolKSFkMtEw7LvuaGMa/yW/y208iO8GMxXEXslnRnE8LrUyEFIpqhht8edb5aRWNeawzYLJMvnxhQsMKZw16KHw2RzoC7iF+dCOJ0PGX2a/Hj0sNFA5gIPl4zDFD+KzX8dfzhoyh0zwCzP/nrREA8MQu0HtjOSHTeAcwDxcDVPt/d1iGQVygQiKx2rq1FIPh4BX7MA/G5AOEwCNZKBN3PjuJEbCLX0cZgVL90kY6SxFcW5E4EZegTq9N+ECssdszWyZ8X/DX4UYc+n+oydFx7SgR0Z4sogEzWgc684x6s9PV1GMS6DbsmguGMc9IRBUC4HM3d+w+d9jIlAxKOIi0R2A5z85HkHWRDCiQV5YIxR8PP7KWAfiblsSxyV++P6tDhQz5dBS38emLfhV9ZkKa/Q8xknKAdu04Fiw/OLfKssFCLAJf1xEH4PZpQ3ZBvMCdddcvejxLhE3hO8KnkzQ7hX8t/LfvdnwAiiz327IoCli9jwUFxQP8l9kBgLKzNvhX/Pc/zpo+JqD4M+NpBEVzlAjeaNqkYA4Hv00s8wetswJDj6/BPfQNOKlCAsN7+rIPtSMjXKy4SIH8rBGoBEPCkqGYHx8XMfx3+wUdombE9RzhfBg8ocIPDUnHAfULgr0JP1R8Vs13kovZvEq2TqfCbsC1xMkXFzsY46RxsPxuQioRWCQC/RA5AFPhUCL9cL6JW+j+Dz1rXTfuXPzaSiNEcY3XHgT3YLRvCheSeBQR5oKpdIQfLS6WQUM4mA8e9Qa/7TWPCf/FpfLwcIgU6B0zBGe6zWVklMlQ8jD2/BX0mg3pjLkUo07jcZIsWPEP0OvwgA9l78r9vBAT5jB5QcESjYDlRvpsuN01dES/lnEupfqQeVKtmtMx2+dBhJ/APmHSdaWGW+rERPyymAVKgtRMq5rYIg2g4z/P9YbFY7PN8PoyC4wuI/QH8yUokxDIu/Ofk7YVFFmllSyfhjJCxFvIXaqa99Ah+MKnF2KzBf0dBElbrAdNk8IAKbL9/txJIlK1EajT8Yzb0hTXb2pjC/7k5X55qvqzCxHT458mL4M10iDL4bsMSEuxGifDeAv5RBcBFPDsEWMq/H3vmOttlIbhFzKt8v5SBL/hquW85QBL+Xvmuk3+W/H2CfyuDccvBIrKxsP859jb0LNqvy1RweK/gYwMCiZDVKMsDdlLCr2m4vEWBD+bTTcFFCu8XfI0Dr53XjbL9yeRh/dNgo0+yo+10s1LcJW+O/ryo05IQ8ricZYt5pGg4Wr6bxo6/taP5YTprKh624AmYavn+urVgfC6F9KpSef7JYTtQ7jcInLYFyhcP8sMkW27KwudCcA/I+4f+Tgnn+a5CKCT3SVWs6ros63q1qgg9/do7vY3+L6H/0a4dqgAAg1AULYPBsjax+P//uA3TwuJAxj3RJiYf7xJ5rBVVLNzHcA8T7fkZl6iePpchSDvs8b9XBwAAAAAAqGQCc31B4/xqSwwAAAAASUVORK5CYII="},(()=>{Gl.world.addChild(new $u(Sd.getWidth()/2,Sd.getHeight()/2,{image:"melonjs_logo",framewidth:256,frameheight:256}),2)}))}onDestroyEvent(){Ju.unload({name:"melonjs_logo",type:"image"})}}var Jl=-1,$l=-1,tu=!1,eu={},iu={color:"",duration:0},su=null,ru=null,nu=0;function ou(){-1===$l&&-1!==Jl&&($l=globalThis.requestAnimationFrame(au))}function au(t){var e=eu[Jl].stage;Gl.update(t,e),Gl.draw(e),-1!==$l&&($l=globalThis.requestAnimationFrame(au))}function hu(){globalThis.cancelAnimationFrame($l),$l=-1}function lu(t){hu(),eu[Jl]&&eu[Jl].stage.destroy(),eu[t]&&(eu[Jl=t].stage.reset.apply(eu[Jl].stage,ru),ou(),Rn(an),su&&su(),Gl.repaint())}Ln(en,(()=>{uu.set(uu.LOADING,new Ql),uu.set(uu.DEFAULT,new ql),Ln(hn,(()=>{uu.change(uu.DEFAULT,!0)})),"function"==typeof globalThis.addEventListener&&(globalThis.addEventListener("blur",(()=>{uu.pause(!0)}),!1),globalThis.addEventListener("focus",(()=>{uu.resume(!0),qo()}),!1)),void 0!==globalThis.document&&"function"==typeof globalThis.document.addEventListener&&globalThis.document.addEventListener("visibilitychange",(()=>{"visible"===globalThis.document.visibilityState?uu.resume(!0):uu.pause(!0)}),!1)}));var uu={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop(t=!1){Jl!==this.LOADING&&this.isRunning()&&(hu(),!0===t&&t(),nu=globalThis.performance.now(),Rn(nn))},pause(t=!1){Jl===this.LOADING||this.isPaused()||(tu=!0,!0===t&&Qa(),nu=globalThis.performance.now(),Rn(sn))},restart(t=!1){this.isRunning()||(ou(),!0===t&&Ja(),nu=globalThis.performance.now()-nu,Gl.repaint(),Rn(on,nu))},resume(t=!1){this.isPaused()&&(tu&&-1!==Jl&&(tu=!1),!0===t&&Ja(),nu=globalThis.performance.now()-nu,Rn(rn,nu))},isRunning(){return-1!==$l},isPaused(){return tu},set(t,e,i=!1){if(!(e instanceof ql))throw new Error(e+" is not an instance of me.Stage");eu[t]={},eu[t].stage=e,eu[t].transition=!0,!0===i&&this.change(t)},get(t=Jl){return void 0!==eu[t]?eu[t].stage:void 0},current(){return this.get()},transition(t,e,i){"fade"===t&&(iu.color=e,iu.duration=i)},setTransition(t,e){eu[t].transition=e},change(t,e){if(void 0===eu[t])throw new Error("Undefined Stage for state '"+t+"'");this.isCurrent(t)||(ru=null,arguments.length>1&&(ru=Array.prototype.slice.call(arguments,1)),iu.duration&&eu[t].transition?(su=()=>{Gl.viewport.fadeOut(iu.color,iu.duration)},Gl.viewport.fadeIn(iu.color,iu.duration,(function(){Dr(lu,this,t)}))):!0===e?lu(t):Dr(lu,this,t))},isCurrent(t){return Jl===t}};function du(t,e,i){var s;if("string"!=typeof i)return i;switch(e){case"int":case"float":i=Number(i);break;case"bool":i="true"===i;break;default:if(!i||dr(i))i=!i||"true"===i;else if(ur(i))i=Number(i);else if(0===i.search(/^json:/i)){s=i.split(/^json:/i)[1];try{i=JSON.parse(s)}catch(t){throw new Error("Unable to parse JSON: "+s)}}else if(0===i.search(/^eval:/i)){s=i.split(/^eval:/i)[1];try{i=Function("'use strict';return ("+s+")")()}catch(t){throw new Error("Unable to evaluate: "+s)}}else((s=i.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(s=i.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(i="#"+s[2]+s[1]);0===t.search(/^(ratio|anchorPoint)$/)&&"number"==typeof i&&(i={x:i,y:i})}return i}function cu(t,e,i){switch(i=i||"none",e=e||"none"){case"csv":return function(t){for(var e=t.replace("\n","").trim().split(","),i=[],s=0;s<e.length;s++)i.push(+e[s]);return i}(t);case"base64":var s=function(t,e){var i,s,r;e=e||1;var n=globalThis.atob(t.replace(/[^A-Za-z0-9\+\/\=]/g,"")),o=new Uint32Array(n.length/e);for(i=0,r=n.length/e;i<r;i++)for(o[i]=0,s=e-1;s>=0;--s)o[i]+=n.charCodeAt(i*e+s)<<(s<<3);return o}(t,4);return"none"===i?s:function(){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}();case"none":return t;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+e)}}function pu(t,e){var i=e.nodeName;switch(i){case"data":var s=fu(e);s.text=s.text||s.chunk.text,s.encoding=s.encoding||"xml",t.data=cu(s.text,s.encoding,s.compression),t.encoding="none";break;case"imagelayer":case"layer":case"objectgroup":case"group":var r=fu(e);r.type="layer"===i?"tilelayer":i,r.image&&(r.image=r.image.source),t.layers=t.layers||[],t.layers.push(r);break;case"animation":t.animation=fu(e).frames;break;case"frame":case"object":var n=i+"s";t[n]=t[n]||[],t[n].push(fu(e));break;case"tile":var o=fu(e);o.image&&(o.imagewidth=o.image.width,o.imageheight=o.image.height,o.image=o.image.source),t.tiles=t.tiles||{},t.tiles[o.id]=o;break;case"tileset":var a=fu(e);a.image&&(a.imagewidth=a.image.width,a.imageheight=a.image.height,a.image=a.image.source),t.tilesets=t.tilesets||[],t.tilesets.push(a);break;case"polygon":case"polyline":t[i]=[];for(var h,l=fu(e).points.split(" "),u=0;u<l.length;u++)h=l[u].split(","),t[i].push({x:+h[0],y:+h[1]});break;case"properties":t.properties=fu(e);break;case"property":var d=fu(e),c=void 0!==d.value?d.value:d.text;t[d.name]=du(d.name,d.type||"string",c);break;default:t[i]=fu(e)}}function fu(t){var e={},i="";if(1===t.nodeType&&function(t,e){if(e.attributes&&e.attributes.length>0)for(var i=0;i<e.attributes.length;i++){var s=e.attributes.item(i);void 0!==s.name?t[s.name]=s.value:t[s.nodeName]=s.nodeValue}}(e,t),t.hasChildNodes())for(var s=0;s<t.childNodes.length;s++){var r=t.childNodes.item(s);switch(r.nodeType){case 1:pu(e,r);break;case 3:i+=r.nodeValue.trim()}}return i&&(e.text=i),e}function gu(t,e){var i=e.properties,s=e.propertytypes;if(void 0!==i)for(var r in i)if(i.hasOwnProperty(r)){var n="string",o=r,a=i[r];void 0!==i[r].name&&(o=i[r].name),void 0!==s?n=s[r]:void 0!==i[r].type&&(n=i[r].type),void 0!==i[r].value&&(a=i[r].value),t[o]=du(o,n,a)}}const mu=536870911;class yu extends Fa{constructor(t,e,i,s){var r,n;if(super(),s.isCollection){var o=s.getTileImage(i&mu);r=o.width,n=o.height}else r=s.tilewidth,n=s.tileheight;this.setMinMax(0,0,r,n),this.tileset=s,this.currentTransform=null,this.col=t,this.row=e,this.tileId=i,this.flippedX=0!=(2147483648&this.tileId),this.flippedY=0!=(1073741824&this.tileId),this.flippedAD=0!=(536870912&this.tileId),this.flipped=this.flippedX||this.flippedY||this.flippedAD,!0===this.flipped&&(null===this.currentTransform&&(this.currentTransform=new Qr),this.setTileTransform(this.currentTransform.identity())),this.tileId&=mu}setTileTransform(t){t.translate(this.width/2,this.height/2),this.flippedAD&&(t.rotate(-90*Math.PI/180),t.scale(-1,1)),this.flippedX&&t.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&t.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),t.translate(-this.width/2,-this.height/2)}getRenderable(t){var e,i=this.tileset;if(i.animations.has(this.tileId)){var s=[],r=[];i.animations.get(this.tileId).frames.forEach((function(t){r.push(t.tileid),s.push({name:""+t.tileid,delay:t.duration})})),(e=i.texture.createAnimationFromName(r,t)).addAnimation(this.tileId-i.firstgid,s),e.setCurrentAnimation(this.tileId-i.firstgid)}else if(!0===i.isCollection){var n=i.getTileImage(this.tileId);(e=new $u(0,0,Object.assign({image:n}))).anchorPoint.set(0,0),e.scale(t.width/this.width,t.height/this.height),void 0!==t.rotation&&(e.anchorPoint.set(.5,.5),e.currentTransform.rotate(t.rotation),e.currentTransform.translate(t.width/2,t.height/2),t.rotation=void 0)}else(e=i.texture.createSpriteFromName(this.tileId-i.firstgid,t)).anchorPoint.set(0,0);return this.setTileTransform(e.currentTransform),e}}class vu extends Va{constructor(t){super(t),this.context=this.getContext2d(this.getCanvas(),this.settings.transparent),this.setBlendMode(this.settings.blendMode),this.setColor(this.currentColor),this.cache=new yd,!1===this.settings.textureSeamFix||this.settings.antiAlias||(this.uvOffset=1),this.getCanvas().addEventListener("contextlost",(t=>{t.preventDefault(),this.isContextValid=!1,Rn(On,this)}),!1),this.getCanvas().addEventListener("contextrestored",(()=>{this.isContextValid=!0,Rn(Bn,this)}),!1)}reset(){super.reset(),this.clearColor(this.currentColor,!0!==this.settings.transparent)}resetTransform(){this.getContext().setTransform(1,0,0,1,0,0)}setBlendMode(t="normal",e){switch(e=e||this.getContext(),this.currentBlendMode=t,t){case"screen":e.globalCompositeOperation="screen";break;case"lighter":case"additive":e.globalCompositeOperation="lighter";break;case"multiply":e.globalCompositeOperation="multiply";break;default:e.globalCompositeOperation="source-over",this.currentBlendMode="normal"}}clear(){if(!1===this.settings.transparent){var t=this.getCanvas();this.getContext().clearRect(0,0,t.width,t.height)}}clearColor(t="#000000",e=!1){var i=this.getCanvas(),s=this.getContext();this.save(),this.resetTransform(),s.globalAlpha=1,s.globalCompositeOperation=!0===e?"copy":"source-over",s.fillStyle=t instanceof qr?t.toRGBA():t,this.fillRect(0,0,i.width,i.height),this.restore()}clearRect(t,e,i,s){this.getContext().clearRect(t,e,i,s)}createPattern(t,e){return this.getContext().createPattern(t,e)}drawImage(t,e,i,s,r,n,o,a,h){if(!(this.getGlobalAlpha()<1/255)){var l=this.getContext();void 0===s?(s=a=t.width,r=h=t.height,n=e,o=i,e=0,i=0):void 0===n&&(n=e,o=i,a=s,h=r,s=t.width,r=t.height,e=0,i=0),!1===this.settings.subPixel&&(n=~~n,o=~~o);var u=t,d=this.currentTint.toArray();1===d[0]&&1===d[1]&&1===d[2]||(u=this.cache.tint(t,this.currentTint.toRGB())),l.drawImage(u,e,i,s,r,n,o,a,h)}}drawPattern(t,e,i,s,r){if(!(this.getGlobalAlpha()<1/255)){var n=this.getContext(),o=n.fillStyle;n.fillStyle=t,n.fillRect(e,i,s,r),n.fillStyle=o}}strokeArc(t,e,i,s,r,n,o=!1){if(!(this.getGlobalAlpha()<1/255)){var a=this.getContext();a.translate(t,e),a.beginPath(),a.arc(0,0,i,s,r,n||!1),a[!0===o?"fill":"stroke"](),a.translate(-t,-e)}}fillArc(t,e,i,s,r,n){this.strokeArc(t,e,i,s,r,n||!1,!0)}strokeEllipse(t,e,i,s,r=!1){if(!(this.getGlobalAlpha()<1/255)){var n=this.getContext(),o=t-i,a=t+i,h=e-s,l=e+s,u=.551784*i,d=.551784*s,c=t-u,p=t+u,f=e-d,g=e+d;n.beginPath(),n.moveTo(t,h),n.bezierCurveTo(p,h,a,f,a,e),n.bezierCurveTo(a,g,p,l,t,l),n.bezierCurveTo(c,l,o,g,o,e),n.bezierCurveTo(o,f,c,h,t,h),n[!0===r?"fill":"stroke"](),n.closePath()}}fillEllipse(t,e,i,s){this.strokeEllipse(t,e,i,s,!0)}strokeLine(t,e,i,s){if(!(this.getGlobalAlpha()<1/255)){var r=this.getContext();r.beginPath(),r.moveTo(t,e),r.lineTo(i,s),r.stroke()}}fillLine(t,e,i,s){this.strokeLine(t,e,i,s)}strokePolygon(t,e=!1){if(!(this.getGlobalAlpha()<1/255)){var i,s=this.getContext();this.translate(t.pos.x,t.pos.y),s.beginPath(),s.moveTo(t.points[0].x,t.points[0].y);for(var r=1;r<t.points.length;r++)i=t.points[r],s.lineTo(i.x,i.y);s.lineTo(t.points[0].x,t.points[0].y),s[!0===e?"fill":"stroke"](),s.closePath(),this.translate(-t.pos.x,-t.pos.y)}}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,s,r=!1){this.getGlobalAlpha()<1/255||this.getContext()[!0===r?"fillRect":"strokeRect"](t,e,i,s)}fillRect(t,e,i,s){this.strokeRect(t,e,i,s,!0)}strokeRoundRect(t,e,i,s,r,n=!1){if(!(this.getGlobalAlpha()<1/255)){var o=this.getContext();o.beginPath(),o.roundRect(t,e,i,s,r),o[!0===n?"fill":"stroke"]()}}fillRoundRect(t,e,i,s,r){this.strokeRoundRect(t,e,i,s,r,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}getFontContext(){return this.getContext()}save(){this.getContext().save()}restore(){this.getContext().restore(),this.currentColor.glArray[3]=this.getGlobalAlpha(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height}rotate(t){this.getContext().rotate(t)}scale(t,e){this.getContext().scale(t,e)}setColor(t){var e=this.getContext();e.strokeStyle=e.fillStyle=t instanceof qr?t.toRGBA():t}setGlobalAlpha(t){this.getContext().globalAlpha=this.currentColor.glArray[3]=t}getGlobalAlpha(){return this.getContext().globalAlpha}setLineWidth(t){this.getContext().lineWidth=t}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){var e=t.toArray(),i=e[0],s=e[1],r=e[3],n=e[4],o=e[6],a=e[7];!1===this.settings.subPixel&&(o|=0,a|=0),this.getContext().transform(i,s,r,n,o,a)}translate(t,e){!1===this.settings.subPixel?this.getContext().translate(~~t,~~e):this.getContext().translate(t,e)}clipRect(t,e,i,s){var r=this.getCanvas();if(0!==t||0!==e||i!==r.width||s!==r.height){var n=this.currentScissor;if(n[0]!==t||n[1]!==e||n[2]!==i||n[3]!==s){var o=this.getContext();o.beginPath(),o.rect(t,e,i,s),o.clip(),n[0]=t,n[1]=e,n[2]=i,n[3]=s}}}setMask(t,e=!1){var i=this.getContext();if(0===this.maskLevel&&(i.save(),i.beginPath()),t instanceof Ra)i.roundRect(t.top,t.left,t.width,t.height,t.radius);else if(t instanceof Ba||t instanceof Fa)i.rect(t.top,t.left,t.width,t.height);else if(t instanceof La){const e=t.pos.x,l=t.pos.y,u=t.radiusV.x,d=t.radiusV.y,c=e-u,p=e+u,f=l-d,g=l+d;var s=.551784*u,r=.551784*d,n=e-s,o=e+s,a=l-r,h=l+r;i.moveTo(e,f),i.bezierCurveTo(o,f,p,a,p,l),i.bezierCurveTo(p,h,o,g,e,g),i.bezierCurveTo(n,g,c,h,c,l),i.bezierCurveTo(c,a,n,f,e,f)}else{const e=t.pos.x,s=t.pos.y;var l;i.moveTo(e+t.points[0].x,s+t.points[0].y);for(var u=1;u<t.points.length;u++)l=t.points[u],i.lineTo(e+l.x,s+l.y)}this.maskLevel++,!0===e?(i.closePath(),i.globalCompositeOperation="destination-atop",i.fill()):i.clip()}clearMask(){this.maskLevel>0&&(this.maskLevel=0,this.getContext().restore())}}class xu extends ml{constructor(t,e,i,s,r,n,o){super(0,0,0,0),this.tilewidth=e.tilewidth||i,this.tileheight=e.tileheight||s,this.orientation=r,this.tilesets=n,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(var a=0;a<this.tilesets.length;a++){var h=this.tilesets.getTilesetByIndex(a);this.maxTileSize.width=Math.max(this.maxTileSize.width,h.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,h.tileheight)}this.animatedTilesets=[],this.isAnimated=!1,this.renderorder=e.renderorder||"right-down",this.class=e.class,this.pos.z=o,this.anchorPoint.set(0,0),this.name=e.name,this.cols=+e.width,this.rows=+e.height;var l=void 0!==e.visible?+e.visible:1;this.setOpacity(l?+e.opacity:0),"string"==typeof e.tintcolor&&this.tint.parseHex(e.tintcolor,!0),"isometric"===this.orientation?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),gu(this,e),void 0===this.preRender&&(this.preRender=Gl.world.preRender),this.setRenderer(t.getRenderer()),function(t,e){var i=0;!function(t){t.layerData=new Array(t.cols);for(var e=0;e<t.cols;e++){t.layerData[e]=new Array(t.rows);for(var i=0;i<t.rows;i++)t.layerData[e][i]=null}}(t);for(var s=0;s<t.rows;s++)for(var r=0;r<t.cols;r++){var n=e[i++];0!==n&&(t.layerData[r][s]=t.getTileById(n,r,s))}}(this,cu(e.data,e.encoding,e.compression))}onActivateEvent(){if(void 0===this.animatedTilesets&&(this.animatedTilesets=[]),this.tilesets)for(var t=this.tilesets.tilesets,e=0;e<t.length;e++)t[e].isAnimated&&this.animatedTilesets.push(t[e]);this.isAnimated=this.animatedTilesets.length>0,this.isAnimated&&(this.preRender=!1),this.getBounds().addBounds(this.getRenderer().getBounds(),!0),this.getBounds().shift(this.pos),!0!==this.preRender||this.canvasRenderer||(this.canvasRenderer=new vu({canvas:Cd(this.width,this.height),widht:this.width,heigth:this.height,transparent:!0}),function(t,e){for(var i=0;i<t.rows;i++)for(var s=0;s<t.cols;s++){var r=t.layerData[s][i];r instanceof yu&&t.getRenderer().drawTile(e,s,i,r)}}(this,this.canvasRenderer))}onDeactivateEvent(){this.animatedTilesets=void 0}setRenderer(t){this.renderer=t}getRenderer(){return this.renderer}getTileId(t,e){var i=this.getTile(t,e);return i?i.tileId:null}getTile(t,e){var i=null;if(this.contains(t,e)){var s=this.getRenderer().pixelToTileCoords(t,e,Ur.pull("Vector2d"));i=this.cellAt(s.x,s.y),Ur.push(s)}return i}setTile(t,e,i){return this.layerData[e][i]=t,t}getTileById(t,e,i){return this.tileset.contains(t)||(this.tileset=this.tilesets.getTilesetByGid(t)),new yu(e,i,t,this.tileset)}cellAt(t,e,i){var s=~~t,r=~~e,n=this.getRenderer();return!1===i||s>=0&&s<n.cols&&r>=0&&r<n.rows?this.layerData[s][r]:null}clearTile(t,e){this.layerData[t][e]=null,this.preRender&&this.canvasRenderer.clearRect(t*this.tilewidth,e*this.tileheight,this.tilewidth,this.tileheight)}update(t){if(this.isAnimated){for(var e=!1,i=0;i<this.animatedTilesets.length;i++)e=this.animatedTilesets[i].update(t)||e;return e}return!1}draw(t,e){if(this.preRender){var i=Math.min(e.width,this.width),s=Math.min(e.height,this.height);t.drawImage(this.canvasRenderer.getCanvas(),e.pos.x,e.pos.y,i,s,e.pos.x,e.pos.y,i,s)}else this.getRenderer().drawTileLayer(t,this,e)}}class _u{constructor(t,e,i,s){this.cols=t,this.rows=e,this.tilewidth=i,this.tileheight=s,this.bounds=new Fa}canRender(t){return this.tilewidth===t.tilewidth&&this.tileheight===t.tileheight}getBounds(t){var e=t instanceof xu?Ur.pull("Bounds"):this.bounds;return e.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),e}pixelToTileCoords(t,e,i){return i}tileToPixelCoords(t,e,i){return i}drawTile(t,e,i,s){}drawTileLayer(t,e,i){}}class bu extends _u{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight)}canRender(t){return"orthogonal"===t.orientation&&super.canRender(t)}pixelToTileCoords(t,e,i){return(i||new Vr).set(t/this.tilewidth,e/this.tileheight)}tileToPixelCoords(t,e,i){return(i||new Vr).set(t*this.tilewidth,e*this.tileheight)}adjustPosition(t){"number"==typeof t.gid&&(t.y-=t.height)}drawTile(t,e,i,s){var r=s.tileset;r.drawTile(t,r.tileoffset.x+e*this.tilewidth,r.tileoffset.y+(i+1)*this.tileheight-r.tileheight,s)}drawTileLayer(t,e,i){var s=1,r=1,n=this.pixelToTileCoords(Math.max(i.pos.x-(e.maxTileSize.width-e.tilewidth),0),Math.max(i.pos.y-(e.maxTileSize.height-e.tileheight),0),Ur.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(i.pos.x+i.width+this.tilewidth,i.pos.y+i.height+this.tileheight,Ur.pull("Vector2d")).ceilSelf();switch(o.x=o.x>this.cols?this.cols:o.x,o.y=o.y>this.rows?this.rows:o.y,e.renderorder){case"right-up":o.y=n.y+(n.y=o.y)-o.y,r=-1;break;case"left-down":o.x=n.x+(n.x=o.x)-o.x,s=-1;break;case"left-up":o.x=n.x+(n.x=o.x)-o.x,o.y=n.y+(n.y=o.y)-o.y,s=-1,r=-1}for(var a=n.y;a!==o.y;a+=r)for(var h=n.x;h!==o.x;h+=s){var l=e.cellAt(h,a,!1);l&&this.drawTile(t,h,a,l)}Ur.push(n),Ur.push(o)}}class wu extends _u{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight),this.hTilewidth=this.tilewidth/2,this.hTileheight=this.tileheight/2,this.originX=this.rows*this.hTilewidth}canRender(t){return"isometric"===t.orientation&&super.canRender(t)}getBounds(t){var e=t instanceof xu?Ur.pull("Bounds"):this.bounds;return e.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),e}pixelToTileCoords(t,e,i){return(i||new Vr).set(e/this.tileheight+(t-this.originX)/this.tilewidth,e/this.tileheight-(t-this.originX)/this.tilewidth)}tileToPixelCoords(t,e,i){return(i||new Vr).set((t-e)*this.hTilewidth+this.originX,(t+e)*this.hTileheight)}adjustPosition(t){var e=t.x/this.hTilewidth,i=t.y/this.tileheight,s=Ur.pull("Vector2d");this.tileToPixelCoords(e,i,s),t.x=s.x,t.y=s.y,Ur.push(s)}drawTile(t,e,i,s){var r=s.tileset;r.drawTile(t,(this.cols-1)*r.tilewidth+(e-i)*r.tilewidth>>1,-r.tilewidth+(e+i)*r.tileheight>>2,s)}drawTileLayer(t,e,i){var s=e.tileset,r=this.pixelToTileCoords(i.pos.x-s.tilewidth,i.pos.y-s.tileheight,Ur.pull("Vector2d")).floorSelf(),n=this.pixelToTileCoords(i.pos.x+i.width+s.tilewidth,i.pos.y+i.height+s.tileheight,Ur.pull("Vector2d")).ceilSelf(),o=this.tileToPixelCoords(n.x,n.y,Ur.pull("Vector2d")),a=this.tileToPixelCoords(r.x,r.y,Ur.pull("Vector2d"));a.x-=this.hTilewidth,a.y+=this.tileheight;var h=a.y-i.pos.y>this.hTileheight,l=i.pos.x-a.x<this.hTilewidth;h&&(l?(r.x--,a.x-=this.hTilewidth):(r.y--,a.x+=this.hTilewidth),a.y-=this.hTileheight);for(var u=h^l,d=r.clone(),c=2*a.y;c-2*this.tileheight<2*o.y;c+=this.tileheight){d.setV(r);for(var p=a.x;p<o.x;p+=this.tilewidth){var f=e.cellAt(d.x,d.y);if(f){var g=(s=f.tileset).tileoffset;s.drawTile(t,g.x+p,g.y+c/2-s.tileheight,f)}d.x++,d.y--}u?(r.y++,a.x-=this.hTilewidth,u=!1):(r.x++,a.x+=this.hTilewidth,u=!0)}Ur.push(d),Ur.push(r),Ur.push(n),Ur.push(o),Ur.push(a)}}const Tu=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],Au=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];class Eu extends _u{constructor(t){super(t.cols,t.rows,-2&t.tilewidth,-2&t.tileheight),this.hexsidelength=t.hexsidelength||0,this.staggerX="x"===t.staggeraxis,this.staggerEven="even"===t.staggerindex,this.sidelengthx=0,this.sidelengthy=0,"hexagonal"===t.orientation&&(this.staggerX?this.sidelengthx=this.hexsidelength:this.sidelengthy=this.hexsidelength),this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2,this.sideoffsety=(this.tileheight-this.sidelengthy)/2,this.columnwidth=this.sideoffsetx+this.sidelengthx,this.rowheight=this.sideoffsety+this.sidelengthy,this.centers=[new Vr,new Vr,new Vr,new Vr]}canRender(t){return"hexagonal"===t.orientation&&super.canRender(t)}getBounds(t){var e=t instanceof xu?Ur.pull("Bounds"):this.bounds;return this.staggerX?(e.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),e.width>1&&(e.height+=this.rowheight)):(e.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),e.height>1&&(e.width+=this.columnwidth)),e}doStaggerX(t){return this.staggerX&&1&t^this.staggerEven}doStaggerY(t){return!this.staggerX&&1&t^this.staggerEven}topLeft(t,e,i){var s=i||new Vr;return this.staggerX?1&t^this.staggerEven?s.set(t-1,e):s.set(t-1,e-1):1&e^this.staggerEven?s.set(t,e-1):s.set(t-1,e-1),s}topRight(t,e,i){var s=i||new Vr;return this.staggerX?1&t^this.staggerEven?s.set(t+1,e):s.set(t+1,e-1):1&e^this.staggerEven?s.set(t+1,e-1):s.set(t,e-1),s}bottomLeft(t,e,i){var s=i||new Vr;return this.staggerX?1&t^this.staggerEven?s.set(t-1,e+1):s.set(t-1,e):1&e^this.staggerEven?s.set(t,e+1):s.set(t-1,e+1),s}bottomRight(t,e,i){var s=i||new Vr;return this.staggerX?1&t^this.staggerEven?s.set(t+1,e+1):s.set(t+1,e):1&e^this.staggerEven?s.set(t+1,e+1):s.set(t,e+1),s}pixelToTileCoords(t,e,i){var s=i||new Vr;this.staggerX?t-=this.staggerEven?this.tilewidth:this.sideoffsetx:e-=this.staggerEven?this.tileheight:this.sideoffsety;var r,n,o,a,h=Ur.pull("Vector2d",Math.floor(t/(2*this.columnwidth)),Math.floor(e/(2*this.rowheight))),l=Ur.pull("Vector2d",t-h.x*(2*this.columnwidth),e-h.y*(2*this.rowheight));this.staggerX?(h.x=2*h.x,this.staggerEven&&++h.x):(h.y=2*h.y,this.staggerEven&&++h.y),this.staggerX?(o=(r=this.sidelengthx/2)+this.columnwidth,a=this.tileheight/2,this.centers[0].set(r,a),this.centers[1].set(o,a-this.rowheight),this.centers[2].set(o,a+this.rowheight),this.centers[3].set(o+this.columnwidth,a)):(n=this.sidelengthy/2,o=this.tilewidth/2,a=n+this.rowheight,this.centers[0].set(o,n),this.centers[1].set(o-this.columnwidth,a),this.centers[2].set(o+this.columnwidth,a),this.centers[3].set(o,a+this.rowheight));for(var u=0,d=Number.MAX_VALUE,c=0;c<4;++c){var p=this.centers[c].sub(l).length2();p<d&&(d=p,u=c)}var f=this.staggerX?Tu:Au;return s.set(h.x+f[u].x,h.y+f[u].y),Ur.push(h),Ur.push(l),s}tileToPixelCoords(t,e,i){var s=Math.floor(t),r=Math.floor(e),n=i||new Vr;return this.staggerX?(n.y=r*(this.tileheight+this.sidelengthy),this.doStaggerX(s)&&(n.y+=this.rowheight),n.x=s*this.columnwidth):(n.x=s*(this.tilewidth+this.sidelengthx),this.doStaggerY(r)&&(n.x+=this.columnwidth),n.y=r*this.rowheight),n}adjustPosition(t){"number"==typeof t.gid&&(t.y-=t.height)}drawTile(t,e,i,s){var r=s.tileset,n=this.tileToPixelCoords(e,i,Ur.pull("Vector2d"));r.drawTile(t,r.tileoffset.x+n.x,r.tileoffset.y+n.y+(this.tileheight-r.tileheight),s),Ur.push(n)}drawTileLayer(t,e,i){var s,r=this.pixelToTileCoords(i.pos.x,i.pos.y,Ur.pull("Vector2d"));r.sub(e.pos);var n=this.tileToPixelCoords(r.x+e.pos.x,r.y+e.pos.y,Ur.pull("Vector2d")),o=r.clone(),a=n.clone(),h=i.pos.y-n.y<this.sideoffsety,l=i.pos.x-n.x<this.sideoffsetx;h&&r.y--,l&&r.x--;var u=e.cols,d=e.rows;if(this.staggerX){r.x=Math.max(0,r.x),r.y=Math.max(0,r.y),n=this.tileToPixelCoords(r.x+e.pos.x,r.y+e.pos.y);for(var c=this.doStaggerX(r.x+e.pos.x);n.y<i.bottom&&r.y<d;){for(o.setV(r),a.setV(n);a.x<i.right&&o.x<u;o.x+=2)(s=e.cellAt(o.x,o.y,!1))&&s.tileset.drawTile(t,a.x,a.y,s),a.x+=this.tilewidth+this.sidelengthx;c?(r.x-=1,r.y+=1,n.x-=this.columnwidth,c=!1):(r.x+=1,n.x+=this.columnwidth,c=!0),n.y+=this.rowheight}Ur.push(o),Ur.push(a)}else{for(r.x=Math.max(0,r.x),r.y=Math.max(0,r.y),n=this.tileToPixelCoords(r.x+e.pos.x,r.y+e.pos.y),this.doStaggerY(r.y)&&(n.x-=this.columnwidth);n.y<i.bottom&&r.y<d;r.y++){for(o.setV(r),a.setV(n),this.doStaggerY(r.y)&&(a.x+=this.columnwidth);a.x<i.right&&o.x<u;o.x++)(s=e.cellAt(o.x,o.y,!1))&&s.tileset.drawTile(t,a.x,a.y,s),a.x+=this.tilewidth+this.sidelengthx;n.y+=this.rowheight}Ur.push(o),Ur.push(a)}Ur.push(r),Ur.push(n)}}class Su extends Eu{canRender(t){return"staggered"===t.orientation&&super.canRender(t)}pixelToTileCoords(t,e,i){var s=i||new Vr,r=t,n=e;this.staggerX?r-=this.staggerEven?this.sideoffsetx:0:n-=this.staggerEven?this.sideoffsety:0;var o=Ur.pull("Vector2d",Math.floor(r/this.tilewidth),Math.floor(n/this.tileheight));this.staggerX?(o.x=2*o.x,this.staggerEven&&++o.x):(o.y=2*o.y,this.staggerEven&&++o.y);var a=Ur.pull("Vector2d",r-o.x*this.tilewidth,n-o.y*this.tileheight),h=a.x*(this.tileheight/this.tilewidth);return this.sideoffsety-h>a.y&&(o=this.topLeft(o.x,o.y,o)),-this.sideoffsety+h>a.y&&(o=this.topRight(o.x,o.y,o)),this.sideoffsety+h<a.y&&(o=this.bottomLeft(o.x,o.y,o)),3*this.sideoffsety-h<a.y&&(o=this.bottomRight(o.x,o.y,o)),(s=this.tileToPixelCoords(o.x,o.y,s)).set(t-s.x,e-s.y),s.set(s.x-this.tilewidth/2,s.y*(this.tilewidth/this.tileheight)),s.div(this.tilewidth/Math.sqrt(2)).rotate(Ar(-45)).add(o),Ur.push(o),Ur.push(a),s}}class Cu{constructor(t){var e=0;if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+t.firstgid,void 0!==t.source){var i=t.source,s=Rr(i);if(("tsx"===s||"json"===s)&&!(t=Ju.getTMX(Br(i))))throw new Error(i+" external TSX/JSON tileset not found")}this.name=t.name,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.spacing=+t.spacing||0,this.margin=+t.margin||0,this.tileoffset=new Vr,this.isAnimated=!1,this.isCollection=!1,this.class=t.class,this.animations=new Map,this._lastUpdate=0;var r=t.tiles;for(e in r)if(r.hasOwnProperty(e)){if("animation"in r[e]&&(this.isAnimated=!0,this.animations.set(r[+e].animation[0].tileid,{dt:0,idx:0,frames:r[+e].animation,cur:r[+e].animation[0]})),"properties"in r[e])if(Array.isArray(r[e].properties)){var n={};for(var o in r[e].properties)n[r[e].properties[o].name]=r[e].properties[o].value;this.setTileProperty(+r[e].id+this.firstgid,n)}else this.setTileProperty(+e+this.firstgid,r[e].properties);if("image"in r[e]){var a=Ju.getImage(r[e].image);if(!a)throw new Error("melonJS: '"+r[e].image+"' file for tile '"+(+e+this.firstgid)+"' not found!");this.imageCollection[+e+this.firstgid]=a}}this.isCollection=this.imageCollection.length>0;var h=t.tileoffset;h&&(this.tileoffset.x=+h.x,this.tileoffset.y=+h.y);var l=t.tileproperties;if(l)for(e in l)l.hasOwnProperty(e)&&this.setTileProperty(+e+this.firstgid,l[e]);if(!1===this.isCollection){if(this.image=Ju.getImage(t.image),!this.image)throw new Error("melonJS: '"+t.image+"' file for tileset '"+this.name+"' not found!");this.texture=Sd.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();var u=+t.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),d=Math.round(this.image.height/(this.tileheight+this.spacing));t.tilecount%u>0&&++d,this.lastgid=this.firstgid+(u*d-1||0),t.tilecount&&this.lastgid-this.firstgid+1!=+t.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+t.tilecount+")")}}getTileImage(t){return this.imageCollection[t]}setTileProperty(t,e){this.TileProperties[t]=e}contains(t){return t>=this.firstgid&&t<=this.lastgid}getViewTileId(t){var e=t-this.firstgid;return this.animations.has(e)?this.animations.get(e).cur.tileid:e}getTileProperties(t){return this.TileProperties[t]}update(t){var e=0,i=Rd.getTime(),s=!1;return this._lastUpdate!==i&&(this._lastUpdate=i,this.animations.forEach((function(i){for(i.dt+=t,e=i.cur.duration;i.dt>=e;)i.dt-=e,i.idx=(i.idx+1)%i.frames.length,i.cur=i.frames[i.idx],e=i.cur.duration,s=!0}))),s}drawTile(t,e,i,s){if(s.flipped&&(t.save(),t.translate(e,i),t.transform(s.currentTransform),e=i=0),!0===this.isCollection)t.drawImage(this.imageCollection[s.tileId],0,0,s.width,s.height,e,i,s.width,s.height);else{var r=this.atlas[this.getViewTileId(s.tileId)].offset;t.drawImage(this.image,r.x,r.y,this.tilewidth,this.tileheight,e,i,this.tilewidth+t.uvOffset,this.tileheight+t.uvOffset)}s.flipped&&t.restore()}}class Mu{constructor(){this.tilesets=[],this.length=0}add(t){this.tilesets.push(t),this.length++}getTilesetByIndex(t){return this.tilesets[t]}getTilesetByGid(t){var e=-1;t&=536870911;for(var i=0,s=this.tilesets.length;i<s;i++){if(this.tilesets[i].contains(t))return this.tilesets[i];this.tilesets[i].firstgid===this.tilesets[i].lastgid&&t>=this.tilesets[i].firstgid&&(e=i)}if(-1!==e)return this.tilesets[e];throw new Error("no matching tileset found for gid "+t)}}class Pu{constructor(t,e,i){this.points=void 0,this.name=e.name,this.x=+e.x,this.y=+e.y,this.z=+i,this.width=+e.width||0,this.height=+e.height||0,this.gid=+e.gid||null,this.tintcolor=e.tintcolor,this.type=e.type,this.class=void 0!==e.class?e.class:e.type,this.text=void 0,this.rotation=Ar(+e.rotation||0),this.id=+e.id||void 0,this.orientation=t.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPoint=!1,this.isPolygon=!1,this.isPolyLine=!1,"number"==typeof this.gid?this.setTile(t.tilesets):void 0!==e.ellipse?this.isEllipse=!0:void 0!==e.point?this.isPoint=!0:void 0!==e.polygon?(this.points=e.polygon,this.isPolygon=!0):void 0!==e.polyline&&(this.points=e.polyline,this.isPolyLine=!0),void 0!==e.text?(this.text=e.text,this.text.font=e.text.fontfamily||"sans-serif",this.text.size=e.text.pixelsize||16,this.text.fillStyle=e.text.color||"#000000",this.text.textAlign=e.text.halign||"left",this.text.textBaseline=e.text.valign||"top",this.text.width=this.width,this.text.height=this.height,gu(this.text,e)):(gu(this,e),this.shapes||(this.shapes=this.parseTMXShapes())),t.isEditor||t.getRenderer().adjustPosition(this)}setTile(t){var e=t.getTilesetByGid(this.gid);!1===e.isCollection&&(this.width=this.framewidth=e.tilewidth,this.height=this.frameheight=e.tileheight),this.tile=new yu(this.x,this.y,this.gid,e)}parseTMXShapes(){var t=0,e=[];if(!0===this.isEllipse)e.push(Ur.pull("Ellipse",this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(!0===this.isPoint)e.push(Ur.pull("Point",this.x,this.y));else if(!0===this.isPolygon){var i=Ur.pull("Polygon",0,0,this.points);if(!1===i.isConvex())throw new Error("collision polygones in Tiled should be defined as Convex");e.push(i.rotate(this.rotation))}else if(!0===this.isPolyLine){var s,r,n=this.points,o=n.length-1;for(t=0;t<o;t++)s=Ur.pull("Vector2d",n[t].x,n[t].y),r=Ur.pull("Vector2d",n[t+1].x,n[t+1].y),0!==this.rotation&&(s=s.rotate(this.rotation),r=r.rotate(this.rotation)),e.push(Ur.pull("Line",0,0,[s,r]))}else e.push(Ur.pull("Polygon",0,0,[Ur.pull("Vector2d"),Ur.pull("Vector2d",this.width,0),Ur.pull("Vector2d",this.width,this.height),Ur.pull("Vector2d",0,this.height)]).rotate(this.rotation));if("isometric"===this.orientation)for(t=0;t<e.length;t++)"function"==typeof e[t].toIso&&e[t].toIso();return e}getObjectPropertyByName(t){return this[t]}}class Iu{constructor(t,e,i){this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.tintcolor=e.tintcolor,this.class=e.class,this.z=i,this.objects=[];var s=void 0===e.visible||e.visible;this.opacity=!0===s?Er(+e.opacity||1,0,1):0,gu(this,e),e.objects&&e.objects.forEach((e=>{e.tintcolor=this.tintcolor,this.objects.push(new Pu(t,e,i))})),e.layers&&e.layers.forEach((e=>{var s=new xu(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i++);s.setRenderer(t.getRenderer()),this.width=Math.max(this.width,s.width),this.height=Math.max(this.height,s.height),this.objects.push(s)}))}destroy(){this.objects=null}getObjectCount(){return this.objects.length}getObjectByIndex(t){return this.objects[t]}}class ku{constructor(t,e){if(this.data=e,this.name=t,this.cols=+e.width,this.rows=+e.height,this.tilewidth=+e.tilewidth,this.tileheight=+e.tileheight,this.infinite=+e.infinite,this.orientation=e.orientation,this.renderorder=e.renderorder||"right-down",this.version=e.version,this.tiledversion=e.tiledversion,this.class=e.class,this.tilesets=null,void 0===this.layers&&(this.layers=[]),void 0===this.objectGroups&&(this.objectGroups=[]),this.isEditor="melon-editor"===e.editor,this.nextobjectid=+e.nextobjectid||void 0,this.hexsidelength=+e.hexsidelength,this.staggeraxis=e.staggeraxis,this.staggerindex=e.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=e.backgroundcolor,gu(this,e),this.initialized=!1,1===this.infinite)throw new Error("Tiled Infinite Map not supported!")}getRenderer(){return void 0!==this.renderer&&this.renderer.canRender(this)||(this.renderer=function(t){switch(t.orientation){case"orthogonal":return new bu(t);case"isometric":return new wu(t);case"hexagonal":return new Eu(t);case"staggered":return new Su(t);default:throw new Error(t.orientation+" type TMX Tile Map not supported!")}}(this)),this.renderer}getBounds(){return this.bounds}readMapObjects(t){if(!0!==this.initialized){var e=0;this.tilesets||(this.tilesets=new Mu),void 0!==t.tilesets&&t.tilesets.forEach((t=>{this.tilesets.add(function(t){return new Cu(t)}(t))})),this.background_image&&this.layers.push(Ur.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:e++})),t.layers.forEach((t=>{switch(t.type){case"imagelayer":this.layers.push(function(t,e,i){gu(e.properties,e);var s=Ur.pull("ImageLayer",+e.offsetx||+e.x||0,+e.offsety||+e.y||0,Object.assign({name:e.name,image:e.image,ratio:Ur.pull("Vector2d",+e.parallaxx||1,+e.parallaxy||1),tint:void 0!==e.tintcolor?Ur.pull("Color").parseHex(e.tintcolor,!0):void 0,z:i},e.properties)),r=void 0===e.visible||e.visible;return s.setOpacity(r?+e.opacity:0),s}(0,t,e++));break;case"tilelayer":this.layers.push(function(t,e,i){return new xu(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i)}(this,t,e++));break;case"objectgroup":case"group":this.objectGroups.push(function(t,e,i){return new Iu(t,e,i)}(this,t,e++))}})),this.initialized=!0}}addTo(t,e,i){var s=t.autoSort,r=t.autoDepth,n=this.getBounds();function o(e,i){Gl.viewport.setBounds(0,0,Math.max(n.width,e),Math.max(n.height,i)),t.pos.set(Math.max(0,~~((e-n.width)/2)),Math.max(0,~~((i-n.height)/2)),t.pos.z)}t.autoSort=!1,t.autoDepth=!1,this.backgroundcolor&&t.backgroundColor.parseCSS(this.backgroundcolor),this.getLayers().forEach((function(e){t.addChild(e)})),this.getObjects(e).forEach((function(e){t.addChild(e)})),t.resize(this.bounds.width,this.bounds.height),t.sort(!0),!0===i&&(Fn(Mn,o),o(Gl.viewport.width,Gl.viewport.height),Ln(Mn,o,this)),t.autoSort=s,t.autoDepth=r}getObjects(t){var e,i=[],s=!1;this.readMapObjects(this.data);for(var r=0;r<this.objectGroups.length;r++){var n=this.objectGroups[r];s=n.name.toLowerCase().includes("collision"),!1===t&&((e=new Dl(0,0,this.width,this.height)).anchorPoint.set(0,0),e.name=n.name,e.pos.z=n.z,e.setOpacity(n.opacity),e.autoSort=!1,e.autoDepth=!1);for(var o=0;o<n.objects.length;o++){var a,h,l=n.objects[o];void 0===l.anchorPoint&&(l.anchorPoint={x:0,y:0}),void 0!==l.tintcolor&&(l.tint=Ur.pull("Color"),l.tint.parseHex(l.tintcolor,!0)),l instanceof xu?a=l:"object"==typeof l.text?(void 0===l.text.anchorPoint&&(l.text.anchorPoint=l.anchorPoint),(a=!0===l.text.bitmap?Ur.pull("BitmapText",l.x,l.y,l.text):Ur.pull("Text",l.x,l.y,l.text)).pos.z=l.z):"object"==typeof l.tile?(void 0===(h=l.shapes)&&(h=Ur.pull("Polygon",0,0,[Ur.pull("Vector2d",0,0),Ur.pull("Vector2d",this.width,0),Ur.pull("Vector2d",this.width,this.height)])),(a=l.tile.getRenderable(l)).body=new Bl(a,h),a.body.setStatic(!0),a.pos.setMuted(l.x,l.y,l.z)):(void 0!==l.name&&""!==l.name?a=Ur.pull(l.name,l.x,l.y,l):(a=Ur.pull("Renderable",l.x,l.y,l.width,l.height),void 0===(h=l.shapes)&&(h=Ur.pull("Polygon",0,0,[Ur.pull("Vector2d",0,0),Ur.pull("Vector2d",this.width,0),Ur.pull("Vector2d",this.width,this.height)])),a.anchorPoint.set(0,0),a.name=l.name,a.type=l.type,a.class=l.class||l.type,a.id=l.id,a.body=new Bl(a,h),a.body.setStatic(!0),a.resize(a.body.getBounds().width,a.body.getBounds().height)),a.pos.z=l.z),s&&!l.name&&a.body&&(a.body.collisionType=Ol.types.WORLD_SHAPE,a.body.isStatic=!0),!1!==t?(!0===a.isRenderable&&(a.setOpacity(a.getOpacity()*n.opacity),a.renderable instanceof ml&&a.renderable.setOpacity(a.renderable.getOpacity()*n.opacity)),i.push(a)):e.addChild(a)}!1===t&&e.children.length>0&&(e.autoSort=!0,e.autoDepth=!0,i.push(e))}return i}getLayers(){return this.readMapObjects(this.data),this.layers}destroy(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}var Ou={},Bu=[],Ru=0;function Lu(t,e,i){e.container.reset(),Gl.reset(),Ou[Du.getCurrentLevelId()]&&Ou[Du.getCurrentLevelId()].destroy(),Ru=Bu.indexOf(t),function(t,e,i,s){var r=Ou[t];Bd.resetGUID(t,r.nextobjectid),e.anchorPoint.set(0,0),r.addTo(e,i,s)}(t,e.container,e.flatten,e.setViewportBounds),Rn(mn,t),e.onLoaded(t),i&&uu.restart()}var Du={add(t,e,i){if("tmx"===t)return null==Ou[e]&&(Ou[e]=new ku(e,Ju.getTMX(e)),Bu.push(e),i&&i(),!0);throw new Error("no level loader defined for format "+t)},load(t,e){if(e=Object.assign({container:Gl.world,onLoaded:Gl.onLevelLoaded,flatten:Gl.mergeGroup,setViewportBounds:!0},e||{}),void 0===Ou[t])throw new Error("level "+t+" not found");if(!(Ou[t]instanceof ku))throw new Error("no level loader defined");return uu.isRunning()?(uu.stop(),Bd.function.defer(Lu,this,t,e,!0)):Lu(t,e),!0},getCurrentLevelId(){return Bu[Ru]},getCurrentLevel(){return Ou[this.getCurrentLevelId()]},reload(t){return this.load(this.getCurrentLevelId(),t)},next(t){return Ru+1<Bu.length&&this.load(Bu[Ru+1],t)},previous(t){return Ru-1>=0&&this.load(Bu[Ru-1],t)},levelCount(){return Bu.length}},Fu={},zu={},Uu={},Vu={},Nu={},Gu=0,ju=0,Hu=0;function Xu(t){if(ju===Gu){if("function"!=typeof t&&!Ju.onload)throw new Error("no load callback defined");clearTimeout(Hu);var e=t||Ju.onload;setTimeout((function(){e(),Rn(yn)}),300)}else Hu=setTimeout((()=>{Xu(t)}),100)}function Yu(t,e,i){Fu[t.name]=new Image,"function"==typeof e&&(Fu[t.name].onload=e),"function"==typeof i&&(Fu[t.name].onerror=i),"string"==typeof Ju.crossOrigin&&(Fu[t.name].crossOrigin=Ju.crossOrigin),Fu[t.name].src=t.src+Ju.nocache}function Wu(t,e,i){!0===pr(t.src)&&(t.src.startsWith("url(")||(t.src="url("+t.src+")"));var s=new FontFace(t.name,t.src);s.load().then((()=>{document.fonts.add(s),document.body.style.fontFamily=t.name,"function"==typeof e&&e()}),(function(){"function"==typeof i&&i(t.name)}))}function Ku(t,e,i){function s(e){zu[t.name]=e,"tmx"===t.type&&Du.add(t.type,t.name)}if(t.data)return s(t.data),void("function"==typeof e&&e());var r=new XMLHttpRequest,n=Rr(t.src);r.overrideMimeType&&("json"===n?r.overrideMimeType("application/json"):r.overrideMimeType("text/xml")),r.open("GET",t.src+Ju.nocache,!0),r.withCredentials=Ju.withCredentials,r.ontimeout=i,r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status&&r.responseText){var o=null;switch(n){case"xml":case"tmx":case"tsx":if(Yn.match(/msie/i)||!r.responseXML){if(!globalThis.DOMParser)throw new Error("XML file format loading not supported, use the JSON file format instead");o=(new DOMParser).parseFromString(r.responseText,"text/xml")}else o=r.responseXML;var a=fu(o);switch(n){case"tmx":o=a.map;break;case"tsx":o=a.tilesets[0]}break;case"json":o=JSON.parse(r.responseText);break;default:throw new Error("TMX file format "+n+"not supported !")}s(o),"function"==typeof e&&e()}else"function"==typeof i&&i(t.name)},r.send()}function qu(t,e,i){var s=new XMLHttpRequest;s.overrideMimeType&&s.overrideMimeType("application/json"),s.open("GET",t.src+Ju.nocache,!0),s.withCredentials=Ju.withCredentials,s.ontimeout=i,s.onreadystatechange=function(){4===s.readyState&&(200===s.status||0===s.status&&s.responseText?(Vu[t.name]=JSON.parse(s.responseText),"function"==typeof e&&e()):"function"==typeof i&&i(t.name))},s.send()}function Zu(t,e,i){var s=new XMLHttpRequest;s.open("GET",t.src+Ju.nocache,!0),s.withCredentials=Ju.withCredentials,s.responseType="arraybuffer",s.onerror=i,s.onload=function(){var i=s.response;if(i){for(var r=new Uint8Array(i),n=[],o=0;o<r.byteLength;o++)n[o]=String.fromCharCode(r[o]);Uu[t.name]=n.join(""),"function"==typeof e&&e()}},s.send()}function Qu(t,e,i){var s=document.createElement("script");s.src=t.src,s.type="text/javascript","string"==typeof Ju.crossOrigin&&(s.crossOrigin=Ju.crossOrigin),s.defer=!0,"function"==typeof e&&(s.onload=()=>{e()}),"function"==typeof i&&(s.onerror=()=>{i(t.name)}),document.getElementsByTagName("body")[0].appendChild(s)}var Ju={nocache:"",onload:void 0,onProgress:void 0,crossOrigin:void 0,withCredentials:!1,onResourceLoaded(t){var e=++ju/Gu;this.onProgress&&this.onProgress(e,t),Rn(vn,e,t)},onLoadingError(t){throw new Error("Failed loading resource "+t.src)},setNocache(t){this.nocache=t?"?"+~~(1e7*Math.random()):""},setBaseURL(t,e){"*"!==t?Nu[t]=e:(Nu.audio=e,Nu.binary=e,Nu.image=e,Nu.json=e,Nu.js=e,Nu.tmx=e,Nu.tsx=e)},preload(t,e,i=!0){for(var s=0;s<t.length;s++)Gu+=this.load(t[s],this.onResourceLoaded.bind(this,t[s]),this.onLoadingError.bind(this,t[s]));void 0!==e&&(this.onload=e),!0===i&&uu.change(uu.LOADING),Xu(e)},load(t,e,i){switch(void 0!==Nu[t.type]&&(t.src=Nu[t.type]+t.src),t.type){case"binary":return Zu.call(this,t,e,i),1;case"image":return Yu.call(this,t,e,i),1;case"json":return qu.call(this,t,e,i),1;case"js":return Qu.call(this,t,e,i),1;case"tmx":case"tsx":return Ku.call(this,t,e,i),1;case"audio":return qa(t,!!t.stream,e,i),1;case"fontface":return Wu.call(this,t,e,i),1;default:throw new Error("load : unknown or invalid resource type : "+t.type)}},unload(t){switch(t.type){case"binary":return t.name in Uu&&(delete Uu[t.name],!0);case"image":return t.name in Fu&&(delete Fu[t.name],!0);case"json":return t.name in Vu&&(delete Vu[t.name],!0);case"js":case"fontface":return!0;case"tmx":case"tsx":return t.name in zu&&(delete zu[t.name],!0);case"audio":return ih(t.name);default:throw new Error("unload : unknown or invalid resource type : "+t.type)}},unloadAll(){var t;for(t in Uu)Uu.hasOwnProperty(t)&&this.unload({name:t,type:"binary"});for(t in Fu)Fu.hasOwnProperty(t)&&this.unload({name:t,type:"image"});for(t in zu)zu.hasOwnProperty(t)&&this.unload({name:t,type:"tmx"});for(t in Vu)Vu.hasOwnProperty(t)&&this.unload({name:t,type:"json"});sh()},getTMX(t){return(t=""+t)in zu?zu[t]:null},getBinary(t){return(t=""+t)in Uu?Uu[t]:null},getImage(t){return(t=Br(""+t))in Fu?Fu[t]:null},getJSON(t){return(t=""+t)in Vu?Vu[t]:null}};class $u extends ml{constructor(t,e,i){if(super(t,e,0,0),this.animationpause=!1,this.animationspeed=100,this.offset=Ur.pull("Vector2d",0,0),this.source=null,this.anim={},this.resetAnim=void 0,this.current={name:"default",length:0,offset:Ur.pull("Vector2d"),width:0,height:0,angle:0,idx:0},this.dt=0,this._flicker={isFlickering:!1,duration:0,callback:null,state:!1},i.image instanceof ed){if(this.source=i.image,this.image=this.source.getTexture(),this.textureAtlas=i.image,void 0!==i.region){var s=this.source.getRegion(i.region);if(!s)throw new Error("Texture - region for "+i.region+" not found");this.setRegion(s),this.current.width=i.framewidth||s.width,this.current.height=i.frameheight||s.height}}else{if(this.image="object"==typeof i.image?i.image:Ju.getImage(i.image),!this.image)throw new Error("me.Sprite: '"+i.image+"' image/texture not found!");this.current.width=i.framewidth=i.framewidth||this.image.width,this.current.height=i.frameheight=i.frameheight||this.image.height,this.source=Sd.cache.get(this.image,i),this.textureAtlas=this.source.getAtlas()}void 0!==i.atlas&&(this.textureAtlas=i.atlas,this.atlasIndices=i.atlasIndices),this.width=this.current.width,this.height=this.current.height,void 0!==i.flipX&&this.flipX(!!i.flipX),void 0!==i.flipY&&this.flipY(!!i.flipY),void 0!==i.rotation&&this.rotate(i.rotation),i.anchorPoint&&this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y),void 0!==i.tint&&(i.tint instanceof qr?this.tint.copy(i.tint):this.tint.parseCSS(i.tint)),"string"==typeof i.name&&(this.name=i.name),void 0!==i.z&&(this.pos.z=i.z),0!==this.addAnimation("default",null)&&this.setCurrentAnimation("default"),this.autoTransform=!0}isFlickering(){return this._flicker.isFlickering}flicker(t,e){return this._flicker.duration=t,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=e,this._flicker.isFlickering=!0),this}addAnimation(t,e,i){this.anim[t]={name:t,frames:[],idx:0,length:0};var s=0;if("object"!=typeof this.textureAtlas)return 0;null==e&&(e=[],Object.keys(this.textureAtlas).forEach((function(t,i){e[i]=i})));for(var r=0,n=e.length;r<n;r++){var o,a=e[r],h=(o="number"==typeof a||"string"==typeof a?{name:a,delay:i||this.animationspeed}:a).name;if("number"==typeof h)void 0!==this.textureAtlas[h]&&(this.anim[t].frames[r]=Object.assign({},this.textureAtlas[h],o),s++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[t].frames[r]=Object.assign({},this.textureAtlas[this.atlasIndices[h]],o),s++}}return this.anim[t].length=s,s}setCurrentAnimation(t,e,i){if(!this.anim[t])throw new Error("animation id '"+t+"' not defined");return this.current.name=t,this.current.length=this.anim[this.current.name].length,this.resetAnim="string"==typeof e?this.setCurrentAnimation.bind(this,e,null,!0):"function"==typeof e?e:void 0,this.setAnimationFrame(this.current.idx),i||(this.dt=0),this.isDirty=!0,this}reverseAnimation(t){return void 0!==t&&void 0!==this.anim[t]?this.anim[t].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this}isCurrentAnimation(t){return this.current.name===t}setRegion(t){return this.image=this.source.getTexture(t),this.current.offset.setV(t.offset),this.current.angle=t.angle,this.width=this.current.width=t.width,this.height=this.current.height=t.height,t.anchorPoint&&this.anchorPoint.set(this._flip.x&&!0===t.trimmed?1-t.anchorPoint.x:t.anchorPoint.x,this._flip.y&&!0===t.trimmed?1-t.anchorPoint.y:t.anchorPoint.y),this.isDirty=!0,this}setAnimationFrame(t){return this.current.idx=(t||0)%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}getCurrentAnimationFrame(){return this.current.idx}getAnimationFrameObjectByIndex(t){return this.anim[this.current.name].frames[t]}update(t){if(!this.animationpause&&this.current&&this.current.length>0){var e=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=t;this.dt>=e;){this.isDirty=!0,this.dt-=e;var i=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(i),0===this.current.idx&&"function"==typeof this.resetAnim&&!1===this.resetAnim()){this.setAnimationFrame(this.current.length-1),this.dt%=e;break}e=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=t,this._flicker.duration<0&&("function"==typeof this._flicker.callback&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),super.update(t)}destroy(){Ur.push(this.offset),this.offset=void 0,super.destroy()}draw(t,e){if(!this._flicker.isFlickering||(this._flicker.state=!this._flicker.state,this._flicker.state)){var i=this.current,s=this.pos.x,r=this.pos.y,n=i.width,o=i.height,a=i.offset,h=this.offset;0!==i.angle&&(t.translate(-s,-r),t.rotate(i.angle),s-=o,n=i.height,o=i.width),t.drawImage(this.image,h.x+a.x,h.y+a.y,n,o,s,r,n,o)}}}function td(t,e,i="default",s="no-repeat"){return{meta:{app:"melonJS",size:{w:t,h:e},repeat:s,image:"default"},frames:[{filename:i,frame:{x:0,y:0,w:t,h:e}}]}}class ed{constructor(t,e,i){if(this.format=null,this.sources=new Map,this.atlases=new Map,void 0!==t)for(var s in t=Array.isArray(t)?t:[t]){var r=t[s];if(void 0!==r.meta){if(r.meta.app.includes("texturepacker")||r.meta.app.includes("free-tex-packer")){if(this.format="texturepacker",void 0===e){var n=Ju.getImage(r.meta.image);if(!n)throw new Error("Atlas texture '"+n+"' not found");this.sources.set(r.meta.image,n)}else this.sources.set(r.meta.image||"default","string"==typeof e?Ju.getImage(e):e);this.repeat="no-repeat"}else if(r.meta.app.includes("ShoeBox")){if(!r.meta.exporter||!r.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.repeat="no-repeat",this.sources.set("default","string"==typeof e?Ju.getImage(e):e)}else r.meta.app.includes("melonJS")&&(this.format="melonJS",this.repeat=r.meta.repeat||"no-repeat",this.sources.set("default","string"==typeof e?Ju.getImage(e):e));this.atlases.set(r.meta.image||"default",this.parse(r))}else void 0!==r.framewidth&&void 0!==r.frameheight&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",void 0!==e&&(r.image="string"==typeof e?Ju.getImage(e):e),this.atlases.set("default",this.parseFromSpriteSheet(r)),this.sources.set("default",r.image))}if(0===this.atlases.length)throw new Error("texture atlas format not supported");!1!==i&&this.sources.forEach((t=>{i instanceof yd?i.set(t,this):Sd.cache.set(t,this)}))}parse(t){var e={};return t.frames.forEach((i=>{if(i.hasOwnProperty("filename")){var s,r,n=i.frame,o=i.spriteSourceSize&&i.sourceSize&&i.pivot;o&&(s=i.sourceSize.w*i.pivot.x-(i.trimmed?i.spriteSourceSize.x:0),r=i.sourceSize.h*i.pivot.y-(i.trimmed?i.spriteSourceSize.y:0)),e[i.filename]={name:i.filename,texture:t.meta.image||"default",offset:new Vr(n.x,n.y),anchorPoint:o?new Vr(s/n.w,r/n.h):null,trimmed:!!i.trimmed,width:n.w,height:n.h,angle:!0===i.rotated?-br:0},this.addUVs(e,i.filename,t.meta.size.w,t.meta.size.h)}})),e}parseFromSpriteSheet(t){var e={},i=t.image,s=t.spacing||0,r=t.margin||0,n=i.width,o=i.height,a=Ur.pull("Vector2d",~~((n-r+s)/(t.framewidth+s)),~~((o-r+s)/(t.frameheight+s)));if(n%(t.framewidth+s)!=0||o%(t.frameheight+s)!=0){var h=a.x*(t.framewidth+s),l=a.y*(t.frameheight+s);h-n!==s&&l-o!==s&&(n=h,o=l,console.warn("Spritesheet Texture for image: "+i.src+" is not divisible by "+(t.framewidth+s)+"x"+(t.frameheight+s)+", truncating effective size to "+n+"x"+o))}for(var u=0,d=a.x*a.y;u<d;u++){var c=""+u;e[c]={name:c,texture:"default",offset:new Vr(r+(s+t.framewidth)*(u%a.x),r+(s+t.frameheight)*~~(u/a.x)),anchorPoint:t.anchorPoint||null,trimmed:!1,width:t.framewidth,height:t.frameheight,angle:0},this.addUVs(e,c,n,o)}return Ur.push(a),e}getAtlas(t){return"string"==typeof t?this.atlases.get(t):this.atlases.values().next().value}getFormat(){return this.format}getTexture(t){return"object"==typeof t&&"string"==typeof t.texture?this.sources.get(t.texture):this.sources.values().next().value}addRegion(t,e,i,s,r){!0===Sd.settings.verbose&&console.warn("Adding texture region",t,"for texture",this);var n=this.getTexture(),o=this.getAtlas(),a=n.width,h=n.height;return o[t]={name:t,offset:new Vr(e,i),width:s,height:r,angle:0},this.addUVs(o,t,a,h),o[t]}getRegion(t,e){var i;return"string"==typeof e?i=this.getAtlas(e)[t]:this.atlases.forEach((function(e){void 0!==e[t]&&(i=e[t])})),i}getUVs(t){var e=this.getRegion(t);if(void 0===e){var i=t.split(","),s=+i[0],r=+i[1],n=+i[2],o=+i[3];e=this.addRegion(t,s,r,n,o)}return e.uvs}addUVs(t,e,i,s){if(Sd instanceof vd){var r=t[e].offset,n=t[e].width,o=t[e].height;t[e].uvs=new Float32Array([r.x/i,r.y/s,(r.x+n)/i,(r.y+o)/s]),t[r.x+","+r.y+","+i+","+s]=t[e]}return t[e].uvs}createSpriteFromName(t,e,i=!1){return Ur.pull(!0===i?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:t},e||{}))}createAnimationFromName(t,e){for(var i,s=[],r={},n=0,o=0,a=0;a<t.length;++a){if(null==(i=this.getRegion(t[a])))throw new Error("Texture - region for "+t[a]+" not found");s[a]=i,r[t[a]]=a,n=Math.max(i.width,n),o=Math.max(i.height,o)}return new $u(0,0,Object.assign({image:this,framewidth:n,frameheight:o,margin:0,spacing:0,atlas:s,atlasIndices:r},e||{}))}}var id={},sd={},rd={},nd=t&&t.__generator||function(t,e){var i,s,r,n,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,s=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){o.label=n[1];break}if(6===n[0]&&o.label<r[1]){o.label=r[1],r=n;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(n);break}r[2]&&o.ops.pop(),o.trys.pop();continue}n=e.call(t,o)}catch(t){n=[6,t],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},od=t&&t.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ad=t&&t.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,n=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return o};Object.defineProperty(rd,"__esModule",{value:!0}),rd.Multimap=void 0;var hd=function(){function t(t,e){var i,s;if(this.size_=0,this.map=new Map,this.operator=t,e)try{for(var r=od(e),n=r.next();!n.done;n=r.next()){var o=ad(n.value,2),a=o[0],h=o[1];this.put(a,h)}}catch(t){i={error:t}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}}return this}return Object.defineProperty(t.prototype,"size",{get:function(){return this.size_},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e=this.map.get(t);return e?this.operator.clone(e):this.operator.create()},t.prototype.put=function(t,e){var i=this.map.get(t);return i||(i=this.operator.create()),!!this.operator.add(e,i)&&(this.map.set(t,i),this.size_++,!0)},t.prototype.putAll=function(e,i){var s,r,n,o,a=0;if(i){var h=e,l=i;try{for(var u=od(l),d=u.next();!d.done;d=u.next()){var c=d.value;this.put(h,c),a++}}catch(t){s={error:t}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(s)throw s.error}}}else{if(!(e instanceof t))throw new TypeError("unexpected arguments");try{for(var p=od(e.entries()),f=p.next();!f.done;f=p.next()){var g=ad(f.value,2);h=g[0],c=g[1],this.put(h,c),a++}}catch(t){n={error:t}}finally{try{f&&!f.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}}return a>0},t.prototype.has=function(t){return this.map.has(t)},t.prototype.hasEntry=function(t,e){return this.operator.has(e,this.get(t))},t.prototype.delete=function(t){return this.size_-=this.operator.size(this.get(t)),this.map.delete(t)},t.prototype.deleteEntry=function(t,e){var i=this.get(t);return!!this.operator.delete(e,i)&&(this.map.set(t,i),this.size_--,!0)},t.prototype.clear=function(){this.map.clear(),this.size_=0},t.prototype.keys=function(){return this.map.keys()},t.prototype.entries=function(){var t=this;return function(){var e,i,s,r,n,o,a,h,l,u,d,c,p,f;return nd(this,(function(g){switch(g.label){case 0:g.trys.push([0,11,12,13]),e=od(t.map.entries()),i=e.next(),g.label=1;case 1:if(i.done)return[3,10];s=ad(i.value,2),r=s[0],n=s[1],g.label=2;case 2:g.trys.push([2,7,8,9]),p=void 0,o=od(n),a=o.next(),g.label=3;case 3:return a.done?[3,6]:(h=a.value,[4,[r,h]]);case 4:g.sent(),g.label=5;case 5:return a=o.next(),[3,3];case 6:return[3,9];case 7:return l=g.sent(),p={error:l},[3,9];case 8:try{a&&!a.done&&(f=o.return)&&f.call(o)}finally{if(p)throw p.error}return[7];case 9:return i=e.next(),[3,1];case 10:return[3,13];case 11:return u=g.sent(),d={error:u},[3,13];case 12:try{i&&!i.done&&(c=e.return)&&c.call(e)}finally{if(d)throw d.error}return[7];case 13:return[2]}}))}()},t.prototype.values=function(){var t=this;return function(){var e,i,s,r,n;return nd(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),e=od(t.entries()),i=e.next(),o.label=1;case 1:return i.done?[3,4]:[4,ad(i.value,2)[1]];case 2:o.sent(),o.label=3;case 3:return i=e.next(),[3,1];case 4:return[3,7];case 5:return s=o.sent(),r={error:s},[3,7];case 6:try{i&&!i.done&&(n=e.return)&&n.call(e)}finally{if(r)throw r.error}return[7];case 7:return[2]}}))}()},t.prototype.forEach=function(t,e){var i,s;try{for(var r=od(this.entries()),n=r.next();!n.done;n=r.next()){var o=ad(n.value,2),a=o[0],h=o[1];t.call(void 0===e?this:e,h,a,this)}}catch(t){i={error:t}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}}},t.prototype[Symbol.iterator]=function(){return this.entries()},t.prototype.asMap=function(){var t,e,i=new Map;try{for(var s=od(this.keys()),r=s.next();!r.done;r=s.next()){var n=r.value;i.set(n,this.operator.clone(this.get(n)))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}return i},t}();rd.Multimap=hd;var ld,ud=t&&t.__extends||(ld=function(t,e){return ld=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},ld(t,e)},function(t,e){function i(){this.constructor=t}ld(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(sd,"__esModule",{value:!0}),sd.ArrayMultimap=void 0;var dd=function(t){function e(e){return t.call(this,new cd,e)||this}return ud(e,t),Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"ArrayMultimap"},enumerable:!1,configurable:!0}),e}(rd.Multimap);sd.ArrayMultimap=dd;var cd=function(){function t(){}return t.prototype.create=function(){return[]},t.prototype.clone=function(t){return t.slice()},t.prototype.add=function(t,e){return e.push(t),!0},t.prototype.size=function(t){return t.length},t.prototype.delete=function(t,e){var i=e.indexOf(t);return i>-1&&(e.splice(i,1),!0)},t.prototype.has=function(t,e){return e.includes(t)},t}(),pd={},fd=t&&t.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(pd,"__esModule",{value:!0}),pd.SetMultimap=void 0;var gd=function(t){function e(e){return t.call(this,new md,e)||this}return fd(e,t),Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"SetMultimap"},enumerable:!1,configurable:!0}),e}(rd.Multimap);pd.SetMultimap=gd;var md=function(){function t(){}return t.prototype.create=function(){return new Set},t.prototype.clone=function(t){return new Set(t)},t.prototype.add=function(t,e){var i=e.size;return e.add(t),i!==e.size},t.prototype.size=function(t){return t.size},t.prototype.delete=function(t,e){return e.delete(t)},t.prototype.has=function(t,e){return e.has(t)},t}();!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.SetMultimap=t.ArrayMultimap=void 0;var e=sd;Object.defineProperty(t,"ArrayMultimap",{enumerable:!0,get:function(){return e.ArrayMultimap}});var i=pd;Object.defineProperty(t,"SetMultimap",{enumerable:!0,get:function(){return i.SetMultimap}})}(id);class yd{constructor(t){this.cache=new id.ArrayMultimap,this.tinted=new Map,this.units=new Map,this.max_size=t||1/0,this.clear()}clear(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.length=0}validate(){if(this.length>=this.max_size)throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}get(t,e){var i;return void 0===e?i=this.cache.get(t)[0]:this.cache.forEach(((s,r)=>{var n=s.getAtlas();r===t&&n[0].width===e.framewidth&&n[0].height===e.frameheight&&(i=s)})),void 0===i&&(e||(e=td(t.width,t.height,t.src?Br(t.src):void 0)),i=new ed(e,t,!1),this.set(t,i)),i}delete(t){this.cache.has(t)||this.cache.delete(t)}tint(t,e){var i=this.tinted.get(t);return void 0===i&&(i=this.tinted.set(t,new Map)),i.has(e)||i.set(e,Sd.tint(t,e,"multiply")),i.get(e)}set(t,e){var i=t.width,s=t.height;if(!(1!==Sd.WebGLVersion||wr(i)&&wr(s))){var r=void 0!==t.src?t.src:t;console.warn("[Texture] "+r+" is not a POT texture ("+i+"x"+s+")")}return this.cache.put(t,e)}getUnit(t){return this.units.has(t)||(this.validate(),this.units.set(t,this.length++)),this.units.get(t)}}class vd extends Va{constructor(t){super(t),this.WebGLVersion=1,this.GPUVendor=null,this.GPURenderer=null,this.context=this.gl=this.getContextGL(this.getCanvas(),t.transparent),this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this._colorStack=[],this._matrixStack=[],this._scissorStack=[],this._blendStack=[],this.currentTransform=new Qr,this.currentCompositor=null,this.compositors=new Map;var e=new(this.settings.compositor||ra)(this);this.compositors.set("default",e),this.setCompositor(e),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.setBlendMode(this.settings.blendMode);var i=this.gl.getExtension("WEBGL_debug_renderer_info");null!==i&&(this.GPUVendor=this.gl.getParameter(i.UNMASKED_VENDOR_WEBGL),this.GPURenderer=this.gl.getParameter(i.UNMASKED_RENDERER_WEBGL)),this.cache=new yd(this.maxTextures),this.getCanvas().addEventListener("webglcontextlost",(t=>{t.preventDefault(),this.isContextValid=!1,Rn(On,this)}),!1),this.getCanvas().addEventListener("webglcontextrestored",(()=>{this.reset(),this.isContextValid=!0,Rn(Bn,this)}),!1)}reset(){super.reset(),this.compositors.forEach((t=>{!1===this.isContextValid?t.init(this):t.reset()})),this.gl.disable(this.gl.SCISSOR_TEST),void 0!==this.fontContext2D&&this.createFontTexture(this.cache)}setCompositor(t="default"){if("string"==typeof t&&(t=this.compositors.get(t)),void 0===t)throw new Error("Invalid WebGL Compositor");this.currentCompositor!==t&&(null!==this.currentCompositor&&this.currentCompositor.flush(),this.currentCompositor=t)}resetTransform(){this.currentTransform.identity()}createFontTexture(t){if(void 0===this.fontTexture){var e=this.getCanvas(),i=e.width,s=e.height;1===this.WebGLVersion&&(wr(i)||(i=Tr(e.width)),wr(s)||(s=Tr(e.height)));var r=Cd(i,s,!0);this.fontContext2D=this.getContext2d(r),this.fontTexture=new ed(td(e.width,e.height,"fontTexture"),r,t),this.currentCompositor.uploadTexture(this.fontTexture,0,0,0)}else t.set(this.fontContext2D.canvas,this.fontTexture)}createPattern(t,e){if(!(1!==Sd.WebGLVersion||wr(t.width)&&wr(t.height))){var i=void 0!==t.src?t.src:t;throw new Error("[WebGL Renderer] "+i+" is not a POT texture ("+t.width+"x"+t.height+")")}var s=new ed(td(t.width,t.height,"pattern",e),t);return this.currentCompositor.uploadTexture(s),s}flush(){this.currentCompositor.flush()}setProjection(t){super.setProjection(t),this.currentCompositor.setProjection(t)}clear(){this.currentCompositor.clear(this.settings.transparent?0:1)}clearColor(t="#000000",e=!1){var i;if(t instanceof qr)i=t.toArray();else{var s=Ur.pull("me.Color");i=s.parseCSS(t).toArray(),Ur.push(s)}this.currentCompositor.clearColor(i[0],i[1],i[2],!0===e?1:i[3])}clearRect(t,e,i,s){this.save(),this.clipRect(t,e,i,s),this.clearColor(),this.restore()}drawFont(t){var e=this.getFontContext();this.currentCompositor.uploadTexture(this.fontTexture,0,0,0,!0);var i=this.fontTexture.getUVs(t.left+","+t.top+","+t.width+","+t.height);this.currentCompositor.addQuad(this.fontTexture,t.left,t.top,t.width,t.height,i[0],i[1],i[2],i[3],this.currentTint.toUint32(this.getGlobalAlpha())),e.clearRect(t.left,t.top,t.width,t.height)}drawImage(t,e,i,s,r,n,o,a,h){void 0===s?(s=a=t.width,r=h=t.height,n=e,o=i,e=0,i=0):void 0===n&&(n=e,o=i,a=s,h=r,s=t.width,r=t.height,e=0,i=0),!1===this.settings.subPixel&&(n|=0,o|=0);var l=this.cache.get(t),u=l.getUVs(e+","+i+","+s+","+r);this.currentCompositor.addQuad(l,n,o,a,h,u[0],u[1],u[2],u[3],this.currentTint.toUint32(this.getGlobalAlpha()))}drawPattern(t,e,i,s,r){var n=t.getUVs("0,0,"+s+","+r);this.currentCompositor.addQuad(t,e,i,s,r,n[0],n[1],n[2],n[3],this.currentTint.toUint32(this.getGlobalAlpha()))}getContextGL(t,e=!1){if(null==t)throw new Error("You must pass a canvas element in order to create a GL context");var i,s={alpha:e,antialias:this.settings.antiAlias,depth:!1,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!!e&&this.settings.premultipliedAlpha,powerPreference:this.settings.powerPreference,failIfMajorPerformanceCaveat:this.settings.failIfMajorPerformanceCaveat};if(!1===this.settings.preferWebGL1&&(i=t.getContext("webgl2",s))&&(this.WebGLVersion=2),i||(this.WebGLVersion=1,i=t.getContext("webgl",s)||t.getContext("experimental-webgl",s)),!i)throw new Error("A WebGL context could not be created.");return i}getContext(){return this.gl}setBlendMode(t="normal",e=this.gl){if(this.currentBlendMode!==t)switch(this.flush(),e.enable(e.BLEND),this.currentBlendMode=t,t){case"screen":e.blendFunc(e.ONE,e.ONE_MINUS_SRC_COLOR);break;case"lighter":case"additive":e.blendFunc(e.ONE,e.ONE);break;case"multiply":e.blendFunc(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA);break;default:e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal"}}getFontContext(){return void 0===this.fontContext2D&&(console.warn("[WebGL Renderer] WARNING : Using Standard me.Text with WebGL will severly impact performances !"),this.createFontTexture(this.cache)),this.fontContext2D}restore(){if(0!==this._matrixStack.length){var t=this._colorStack.pop(),e=this._matrixStack.pop();this.currentColor.copy(t),this.currentTransform.copy(e),this.setBlendMode(this._blendStack.pop()),Ur.push(t),Ur.push(e)}0!==this._scissorStack.length?this.currentScissor.set(this._scissorStack.pop()):(this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height)}save(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice()),this._blendStack.push(this.getBlendMode())}rotate(t){this.currentTransform.rotate(t)}scale(t,e){this.currentTransform.scale(t,e)}setAntiAlias(t,e){super.setAntiAlias(t,e)}setGlobalAlpha(t){this.currentColor.alpha=t}getGlobalAlpha(){return this.currentColor.alpha}setColor(t){var e=this.currentColor.alpha;this.currentColor.copy(t),this.currentColor.alpha*=e}setLineWidth(t){this.getContext().lineWidth(t)}strokeArc(t,e,i,s,r,n=!1,o=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.arc(t,e,i,s,r,n),!1===o?this.currentCompositor.drawVertices(this.gl.LINE_STRIP,this.path2D.points):(this.path2D.closePath(),this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())))}fillArc(t,e,i,s,r,n=!1){this.strokeArc(t,e,i,s,r,n,!0)}strokeEllipse(t,e,i,s,r=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.ellipse(t,e,i,s,0,0,360),this.path2D.closePath(),!1===r?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()))}fillEllipse(t,e,i,s){this.strokeEllipse(t,e,i,s,!1)}strokeLine(t,e,i,s){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.moveTo(t,e),this.path2D.lineTo(i,s),this.currentCompositor.drawVertices(this.gl.LINE_STRIP,this.path2D.points))}fillLine(t,e,i,s){this.strokeLine(t,e,i,s)}strokePolygon(t,e=!1){if(!(this.getGlobalAlpha()<1/255)){var i;this.translate(t.pos.x,t.pos.y),this.path2D.beginPath(),this.path2D.moveTo(t.points[0].x,t.points[0].y);for(var s=1;s<t.points.length;s++)i=t.points[s],this.path2D.lineTo(i.x,i.y);this.path2D.lineTo(t.points[0].x,t.points[0].y),this.path2D.closePath(),!1===e?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()),this.translate(-t.pos.x,-t.pos.y)}}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,s,r=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.rect(t,e,i,s),!1===r?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()))}fillRect(t,e,i,s){this.strokeRect(t,e,i,s,!0)}strokeRoundRect(t,e,i,s,r,n=!1){this.getGlobalAlpha()<1/255||(this.path2D.beginPath(),this.path2D.roundRect(t,e,i,s,r),!1===n?this.currentCompositor.drawVertices(this.gl.LINE_LOOP,this.path2D.points):(this.path2D.closePath(),this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())))}fillRoundRect(t,e,i,s,r){this.strokeRoundRect(t,e,i,s,r,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){var e=this.currentTransform;if(e.multiply(t),!1===this.settings.subPixel){var i=e.toArray();i[6]|=0,i[7]|=0}}translate(t,e){var i=this.currentTransform;if(i.translate(t,e),!1===this.settings.subPixel){var s=i.toArray();s[6]|=0,s[7]|=0}}clipRect(t,e,i,s){var r=this.getCanvas(),n=this.gl;if(0!==t||0!==e||i!==r.width||s!==r.height){var o=this.currentScissor;if(n.isEnabled(n.SCISSOR_TEST)&&o[0]===t&&o[1]===e&&o[2]===i&&o[3]===s)return;this.flush(),n.enable(this.gl.SCISSOR_TEST),n.scissor(t+this.currentTransform.tx,r.height-s-e-this.currentTransform.ty,i,s),o[0]=t,o[1]=e,o[2]=i,o[3]=s}else n.disable(n.SCISSOR_TEST)}setMask(t,e=!1){var i=this.gl;this.flush(),0===this.maskLevel&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT)),this.maskLevel++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,this.maskLevel,1),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),this.fill(t),this.flush(),i.colorMask(!0,!0,!0,!0),!0===e?i.stencilFunc(i.EQUAL,this.maskLevel+1,1):i.stencilFunc(i.NOTEQUAL,this.maskLevel+1,1),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}clearMask(){this.maskLevel>0&&(this.flush(),this.maskLevel=0,this.gl.disable(this.gl.STENCIL_TEST))}}var xd=1,_d=0,bd=0,wd={parent:void 0,renderer:2,autoScale:!1,scale:1,scaleMethod:"manual",transparent:!1,premultipliedAlpha:!0,blendMode:"normal",antiAlias:!1,failIfMajorPerformanceCaveat:!0,subPixel:!1,preferWebGL1:!1,powerPreference:"default",verbose:!1,consoleHeader:!0};function Td(){var t=Sd.settings,e=1,i=1;if(t.autoScale){var s=1/0,r=1/0;if(globalThis.getComputedStyle){var n=globalThis.getComputedStyle(Sd.getCanvas(),null);s=parseInt(n.maxWidth,10)||1/0,r=parseInt(n.maxHeight,10)||1/0}var o=Yo(Md()),a=Math.min(s,o.width),h=Math.min(r,o.height),l=a/h;if("fill-min"===t.scaleMethod&&l>xd||"fill-max"===t.scaleMethod&&l<xd||"flex-width"===t.scaleMethod){var u=Math.min(s,bd*l);e=i=a/u,Sd.resize(Math.floor(u),bd)}else if("fill-min"===t.scaleMethod&&l<xd||"fill-max"===t.scaleMethod&&l>xd||"flex-height"===t.scaleMethod){var d=Math.min(r,_d*(h/a));e=i=h/d,Sd.resize(_d,Math.floor(d))}else"flex"===t.scaleMethod?Sd.resize(Math.floor(a),Math.floor(h)):"stretch"===t.scaleMethod?(e=a/_d,i=h/bd):e=i=l<xd?a/_d:h/bd;Pd(e,i)}else Pd(t.scale,t.scale)}let Ad=null,Ed=new Vr(1,1),Sd=null;function Cd(t,e,i=!1){var s;if(0===t||0===e)throw new Error("width or height was zero, Canvas could not be initialized !");return!0===Mo&&!0===i?void 0===(s=new globalThis.OffscreenCanvas(0,0)).style&&(s.style={}):s=document.createElement("canvas"),s.width=t,s.height=e,s}function Md(){return Ad}function Pd(t,e){var i=Sd.getCanvas(),s=Sd.getContext(),r=Sd.settings,n=ko,o=r.zoomX=i.width*t*n,a=r.zoomY=i.height*e*n;Ed.set(t*n,e*n),i.style.width=o/n+"px",i.style.height=a/n+"px",Sd.setAntiAlias(s,r.antiAlias),Sd.setBlendMode(r.blendMode,s),Gl.repaint()}var Id=Object.freeze({__proto__:null,CANVAS:0,WEBGL:1,AUTO:2,get parent(){return Ad},scaleRatio:Ed,get renderer(){return Sd},init:function(t,e,i){if(!pc)throw new Error("me.video.init() called before engine initialization.");(wd=Object.assign(wd,i||{})).width=t,wd.height=e,wd.transparent=!!wd.transparent,wd.antiAlias=!!wd.antiAlias,wd.failIfMajorPerformanceCaveat=!!wd.failIfMajorPerformanceCaveat,wd.subPixel=!!wd.subPixel,wd.verbose=!!wd.verbose,-1!==wd.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)?wd.autoScale="auto"===wd.scale||!0:(wd.scaleMethod="fit",wd.autoScale="auto"===wd.scale||!1),!1!==wd.consoleHeader&&console.log("melonJS 2 (v"+cc+") | http://melonjs.org");var s=Bd.getUriFragment();!0===s.webgl||!0===s.webgl1||!0===s.webgl2?(wd.renderer=1,!0===s.webgl1&&(wd.preferWebGL1=!0)):!0===s.canvas&&(wd.renderer=0),wd.scale=wd.autoScale?1:+wd.scale||1,Ed.set(wd.scale,wd.scale),xd=t/e,_d=t,bd=e,wd.zoomX=t*Ed.x,wd.zoomY=e*Ed.y,globalThis.addEventListener("resize",Bd.function.throttle((function(t){Rn(Sn,t)}),100),!1),globalThis.addEventListener("orientationchange",(function(t){Rn(Pn,t)}),!1),globalThis.addEventListener("onmozorientationchange",(function(t){Rn(Pn,t)}),!1),!0===bo&&(globalThis.screen.orientation.onchange=function(t){Rn(Pn,t)}),globalThis.addEventListener("scroll",Bd.function.throttle((function(t){Rn(In,t)}),100),!1),Ln(Sn,Td,this),Ln(Pn,Td,this);try{switch(wd.renderer){case 2:case 1:Sd=function(t){try{if(Wo(t))return new vd(t)}catch(t){console.log("Error creating WebGL renderer :"+t.message)}return new vu(t)}(wd);break;default:Sd=new vu(wd)}}catch(t){return console(t.message),!1}if(Ad=Ho(void 0!==wd.parent?wd.parent:document.body),Ad.appendChild(Sd.getCanvas()),po.isMobile&&Vo(!1),Td(),"MutationObserver"in globalThis&&new MutationObserver(Td.bind(this)).observe(Ad,{attributes:!1,childList:!0,subtree:!0}),!1!==wd.consoleHeader){var r=Sd instanceof vu?"CANVAS":"WebGL"+Sd.WebGLVersion,n=Ao?"Web Audio":"HTML5 Audio",o="string"==typeof Sd.GPURenderer?" ("+Sd.GPURenderer+")":"";console.log(r+" renderer"+o+" | "+n+" | pixel ratio "+ko+" | "+(po.nodeJS?"node.js":po.isMobile?"mobile":"desktop")+" | "+Go()+" | "+Io),console.log("resolution: requested "+t+"x"+e+", got "+Sd.getWidth()+"x"+Sd.getHeight())}return Rn(hn),!0},createCanvas:Cd,getParent:Md,scale:Pd}),kd="",Od=0,Bd={agent:vr,array:Ir,file:Lr,string:fr,function:zr,getPixels:function(t){if(t instanceof HTMLImageElement){var e=vu.getContext2d(Cd(t.width,t.height));return e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height)}return t.getContext("2d").getImageData(0,0,t.width,t.height)},checkVersion:function(t,e=cc){for(var i=t.split("."),s=e.split("."),r=Math.min(i.length,s.length),n=0,o=0;o<r&&!(n=+i[o]-+s[o]);o++);return n||i.length-s.length},getUriFragment:function(t){var e={};if(void 0===t){if(void 0===globalThis.document)return e;var i=globalThis.document.location;if(!i||!i.hash)return e;t=i.hash}else{var s=t.indexOf("#");if(-1===s)return e;t=t.slice(s,t.length)}return t.slice(1).split("&").filter((function(t){return""!==t})).forEach((function(t){var i=t.split("="),s=i.shift(),r=i.join("=");e[s]=r||!0})),e},resetGUID:function(t,e=0){kd=cr(t.toString().toUpperCase()),Od=e},createGUID:function(t=1){return Od+=t,kd+"-"+(t||Od)}};const Rd=new class{constructor(){this.tick=1,this.fps=0,this.maxfps=60,this.interpolation=!1,this.framecount=0,this.framedelta=0,this.last=0,this.now=0,this.delta=0,this.step=0,this.minstep=0,this.timers=[],this.timerId=0,Ln(en,(()=>{this.reset(),this.now=this.last=0,Ln(dn,this.update.bind(this))})),Ln(rn,(()=>{this.reset()})),Ln(on,(()=>{this.reset()})),Ln(an,(()=>{this.reset()}))}reset(){this.last=this.now=globalThis.performance.now(),this.delta=0,this.framedelta=0,this.framecount=0,this.step=Math.ceil(1e3/this.maxfps),this.minstep=1e3/this.maxfps*1.25}setTimeout(t,e,i,...s){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!1,timerId:++this.timerId,pauseable:!0===i||!0,args:s}),this.timerId}setInterval(t,e,i,...s){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!0,timerId:++this.timerId,pauseable:!0===i||!0,args:s}),this.timerId}clearTimeout(t){Bd.function.defer(this.clearTimer.bind(this),this,t)}clearInterval(t){Bd.function.defer(this.clearTimer.bind(this),this,t)}getTime(){return this.now}getDelta(){return this.delta}countFPS(){this.framecount++,this.framedelta+=this.delta,this.framecount%10==0&&(this.fps=Er(Math.round(1e3*this.framecount/this.framedelta),0,this.maxfps),this.framedelta=0,this.framecount=0)}update(t){this.last=this.now,this.now=t,this.delta=this.now-this.last,this.delta<0&&(this.delta=0),this.tick=this.delta>this.minstep&&this.interpolation?this.delta/this.step:1,this.updateTimers()}clearTimer(t){for(var e=0,i=this.timers.length;e<i;e++)if(this.timers[e].timerId===t){this.timers.splice(e,1);break}}updateTimers(){for(var t=0,e=this.timers.length;t<e;t++){var i=this.timers[t];i.pauseable&&uu.isPaused()||(i.elapsed+=this.delta),i.elapsed>=i.delay&&(i.fn.apply(null,i.args),!0===i.repeat?i.elapsed-=i.delay:this.clearTimeout(i.timerId))}}};var Ld,Dd=0,Fd=["ms","moz","webkit","o"],zd=globalThis.requestAnimationFrame,Ud=globalThis.cancelAnimationFrame;for(Ld=0;Ld<Fd.length&&!zd;++Ld)zd=globalThis[Fd[Ld]+"RequestAnimationFrame"];for(Ld=0;Ld<Fd.length&&!Ud;++Ld)Ud=globalThis[Fd[Ld]+"CancelAnimationFrame"]||globalThis[Fd[Ld]+"CancelRequestAnimationFrame"];zd&&Ud||(zd=function(t){var e=globalThis.performance.now(),i=Math.max(0,1e3/Rd.maxfps-(e-Dd)),s=globalThis.setTimeout((function(){t(e+i)}),i);return Dd=e+i,s},Ud=function(t){globalThis.clearTimeout(t)},globalThis.requestAnimationFrame=zd,globalThis.cancelAnimationFrame=Ud),(()=>{function t(t,e,i,s,r){if(![t,e,i,s].every((t=>Number.isFinite(t))))return;let n,o,a,h;if(4===(r=function(t){const e=typeof t;return"undefined"===e||null===t?[0]:"function"===e?[NaN]:"object"===e?"function"==typeof t[Symbol.iterator]?[...t].map((t=>{const e=typeof t;return"undefined"===e||null===t?0:"function"===e?NaN:"object"===e?d(t):c(t)})):[d(t)]:[c(t)]}(r)).length)n=p(r[0]),o=p(r[1]),a=p(r[2]),h=p(r[3]);else if(3===r.length)n=p(r[0]),o=p(r[1]),h=p(r[1]),a=p(r[2]);else if(2===r.length)n=p(r[0]),a=p(r[0]),o=p(r[1]),h=p(r[1]);else{if(1!==r.length)throw new Error(r.length+" is not a valid size for radii sequence.");n=p(r[0]),o=p(r[0]),a=p(r[0]),h=p(r[0])}const l=[n,o,a,h],u=l.find((({x:t,y:e})=>t<0||e<0));if(!l.some((({x:t,y:e})=>!Number.isFinite(t)||!Number.isFinite(e)))){if(u)throw new Error("Radius value "+u+" is negative.");!function(t){const[e,r,n,o]=t,a=[Math.abs(i)/(e.x+r.x),Math.abs(s)/(r.y+n.y),Math.abs(i)/(n.x+o.x),Math.abs(s)/(e.y+o.y)],h=Math.min(...a);h<=1&&t.forEach((t=>{t.x*=h,t.y*=h}))}(l),i<0&&s<0?(this.moveTo(t-n.x,e),this.ellipse(t+i+o.x,e-o.y,o.x,o.y,0,1.5*-Math.PI,-Math.PI),this.ellipse(t+i+a.x,e+s+a.y,a.x,a.y,0,-Math.PI,-Math.PI/2),this.ellipse(t-h.x,e+s+h.y,h.x,h.y,0,-Math.PI/2,0),this.ellipse(t-n.x,e-n.y,n.x,n.y,0,0,-Math.PI/2)):i<0?(this.moveTo(t-n.x,e),this.ellipse(t+i+o.x,e+o.y,o.x,o.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+i+a.x,e+s-a.y,a.x,a.y,0,-Math.PI,1.5*-Math.PI,1),this.ellipse(t-h.x,e+s-h.y,h.x,h.y,0,Math.PI/2,0,1),this.ellipse(t-n.x,e+n.y,n.x,n.y,0,0,-Math.PI/2,1)):s<0?(this.moveTo(t+n.x,e),this.ellipse(t+i-o.x,e-o.y,o.x,o.y,0,Math.PI/2,0,1),this.ellipse(t+i-a.x,e+s+a.y,a.x,a.y,0,0,-Math.PI/2,1),this.ellipse(t+h.x,e+s+h.y,h.x,h.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+n.x,e-n.y,n.x,n.y,0,-Math.PI,1.5*-Math.PI,1)):(this.moveTo(t+n.x,e),this.ellipse(t+i-o.x,e+o.y,o.x,o.y,0,-Math.PI/2,0),this.ellipse(t+i-a.x,e+s-a.y,a.x,a.y,0,0,Math.PI/2),this.ellipse(t+h.x,e+s-h.y,h.x,h.y,0,Math.PI/2,Math.PI),this.ellipse(t+n.x,e+n.y,n.x,n.y,0,Math.PI,1.5*Math.PI)),this.closePath(),this.moveTo(t,e)}function d(t){const{x:e,y:i,z:s,w:r}=t;return{x:e,y:i,z:s,w:r}}function c(t){return+t}function p(t){const e=c(t);return Number.isFinite(e)?{x:e,y:e}:Object(t)===t?{x:c(t.x||0),y:c(t.y||0)}:{x:NaN,y:NaN}}}globalThis.CanvasRenderingContext2D&&void 0===globalThis.Path2D.prototype.roundRect&&(globalThis.Path2D.prototype.roundRect=t),globalThis.CanvasRenderingContext2D&&void 0===globalThis.CanvasRenderingContext2D.prototype.roundRect&&(globalThis.CanvasRenderingContext2D.prototype.roundRect=t),globalThis.OffscreenCanvasRenderingContext2D&&void 0===globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect&&(globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=t)})();let Vd={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-Vd.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*Vd.Bounce.In(2*t):.5*Vd.Bounce.Out(2*t-1)+.5}}},Nd={Linear:function(t,e){var i=t.length-1,s=i*e,r=Math.floor(s),n=Nd.Utils.Linear;return e<0?n(t[0],t[1],s):e>1?n(t[i],t[i-1],i-s):n(t[r],t[r+1>i?i:r+1],s-r)},Bezier:function(t,e){var i,s=0,r=t.length-1,n=Math.pow,o=Nd.Utils.Bernstein;for(i=0;i<=r;i++)s+=n(1-e,r-i)*n(e,i)*t[i]*o(r,i);return s},CatmullRom:function(t,e){var i=t.length-1,s=i*e,r=Math.floor(s),n=Nd.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(r=Math.floor(s=i*(1+e))),n(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],s-r)):e<0?t[0]-(n(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[i]-(n(t[i],t[i],t[i-1],t[i-1],s-i)-t[i]):n(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],s-r)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=Nd.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i,s=1;if(t[e])return t[e];for(i=e;i>1;i--)s*=i;return t[e]=s,s}}(),CatmullRom:function(t,e,i,s,r){var n=.5*(i-t),o=.5*(s-e),a=r*r;return(2*e-2*i+n+o)*(r*a)+(-3*e+3*i-2*n-o)*a+n*r+e}}};class Gd{constructor(t){this.setProperties(t)}onResetEvent(t){this.setProperties(t)}setProperties(t){for(var e in this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=Vd.Linear.None,this._interpolationFunction=Nd.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._tweenTimeTracker=Gl.lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,this.isRenderable=!1,t)"object"!=typeof t&&(this._valuesStart[e]=parseFloat(t[e]))}_resumeCallback(t){this._startTime&&(this._startTime+=t)}onActivateEvent(){Ln(rn,this._resumeCallback,this)}onDeactivateEvent(){Fn(rn,this._resumeCallback)}to(t,e){return this._valuesEnd=t,void 0!==e&&("number"==typeof e?this._duration=e:"object"==typeof e&&(e.duration&&(this._duration=e.duration),e.yoyo&&this.yoyo(e.yoyo),e.easing&&this.easing(e.easing),e.repeat&&this.repeat(e.repeat),e.delay&&this.delay(e.delay),e.interpolation&&this.interpolation(e.interpolation),e.autoStart&&this.start())),this}start(t=Rd.getTime()){for(var e in this._onStartCallbackFired=!1,Gl.world.addChild(this),this._startTime=t+this._delayTime,this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array==0&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0}return this}stop(){return Gl.world.removeChildNow(this),this}delay(t){return this._delayTime=t,this}repeat(t){return this._repeat=t,this}yoyo(t){return this._yoyo=t,this}easing(t){if("function"!=typeof t)throw new Error("invalid easing function for me.Tween.easing()");return this._easingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(){return this._chainedTweens=arguments,this}onStart(t){return this._onStartCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}update(t){this._tweenTimeTracker=Gl.lastUpdate>this._tweenTimeTracker?Gl.lastUpdate:this._tweenTimeTracker+t;var e,i=this._tweenTimeTracker;if(i<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);var s=(i-this._startTime)/this._duration;s=s>1?1:s;var r=this._easingFunction(s);for(e in this._valuesEnd){var n=this._valuesStart[e]||0,o=this._valuesEnd[e];o instanceof Array?this._object[e]=this._interpolationFunction(o,r):("string"==typeof o&&(o=n+parseFloat(o)),"number"==typeof o&&(this._object[e]=n+(o-n)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._object,r),1===s){if(this._repeat>0){for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){var a=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=a}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=i+this._delayTime,!0}Gl.world.removeChildNow(this),null!==this._onCompleteCallback&&this._onCompleteCallback.call(this._object);for(var h=0,l=this._chainedTweens.length;h<l;h++)this._chainedTweens[h].start(i);return!1}return!0}static get Easing(){return Vd}static get Interpolation(){return Nd}}var jd={offscreenCanvas:!1,willReadFrequently:!1,antiAlias:!1,context:"2d"};class Hd{constructor(t,e,i=jd){i=Object.assign(jd,i||{}),this.canvas=Cd(t,e,i.offscreenCanvas),this.context=this.canvas.getContext("2d",{willReadFrequently:i.willReadFrequently}),this.setAntiAlias(i.antiAlias)}onResetEvent(t,e){this.clear(),this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}setAntiAlias(t=!1){var e=this.canvas;yr("imageSmoothingEnabled",t,this.context),void 0!==e.style&&(!0!==t?(e.style["image-rendering"]="optimizeSpeed",e.style["image-rendering"]="-moz-crisp-edges",e.style["image-rendering"]="-o-crisp-edges",e.style["image-rendering"]="-webkit-optimize-contrast",e.style["image-rendering"]="optimize-contrast",e.style["image-rendering"]="crisp-edges",e.style["image-rendering"]="pixelated",e.style.msInterpolationMode="nearest-neighbor"):e.style["image-rendering"]="auto")}resize(t,e){this.canvas.width=Math.round(t),this.canvas.height=Math.round(e)}destroy(){this.context=void 0,this.canvas=void 0}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}function Xd(t,e,i=!1){t.font=e.font,t.fillStyle=e.fillStyle.toRGBA(),!0===i&&(t.strokeStyle=e.strokeStyle.toRGBA(),t.lineWidth=e.lineWidth),t.textAlign=e.textAlign,t.textBaseline=e.textBaseline}class Yd extends Fa{constructor(t){super(),this.ancestor=t,this.setMinMax(0,0,0,0)}lineHeight(){return this.ancestor instanceof Zd?this.ancestor.fontSize*this.ancestor.lineHeight:this.ancestor.fontData.capHeight*this.ancestor.lineHeight*this.ancestor.fontScale.y}lineWidth(t,e){if(this.ancestor instanceof Zd)return e.measureText(t).width;for(var i=t.split(""),s=0,r=null,n=0;n<i.length;n++){var o=i[n].charCodeAt(0),a=this.ancestor.fontData.glyphs[o];if(void 0!==a){var h=r&&r.kerning?r.getKerning(o):0;s+=(a.xadvance+h)*this.ancestor.fontScale.x,r=a}}return s}measureText(t,e){var i;i=Array.isArray(t)?t:(""+t).split("\n"),void 0!==e&&(e.save(),Xd(e,this.ancestor)),this.width=this.height=0;for(var s=0;s<i.length;s++)this.width=Math.max(this.lineWidth(i[s].trimEnd(),e),this.width),this.height+=this.lineHeight();return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this.x=Math.floor("right"===this.ancestor.textAlign?this.ancestor.pos.x-this.width:"center"===this.ancestor.textAlign?this.ancestor.pos.x-this.width/2:this.ancestor.pos.x),this.y=Math.floor(0===this.ancestor.textBaseline.search(/^(top|hanging)$/)?this.ancestor.pos.y:"middle"===this.ancestor.textBaseline?this.ancestor.pos.y-this.lineHeight()/2:this.ancestor.pos.y-this.lineHeight()),void 0!==e&&e.restore(),this}wordWrap(t,e,i){var s,r="",n=[];Array.isArray(t)&&(t=t.join(" ")),s=t.replace(/[\r\n]+/g," ").split(" "),void 0!==i&&(i.save(),Xd(i,this.ancestor));for(let t=0;t<s.length;t++){var o=s[t];this.lineWidth(r+o+" ",i)<e?r+=o+" ":(n.push(r+"\n"),r=o+" ")}return n.push(r),void 0!==i&&i.restore(),n}}const Wd=["ex","em","pt","px"],Kd=[12,24,.75,1];var qd=function(t,e){return!0===e.offScreenCanvas?e.canvasTexture.context:(void 0===t&&(t=Sd),t.getFontContext())};class Zd extends ml{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.onResetEvent(t,e,i)}onResetEvent(t,e,i){void 0!==i.fillStyle?i.fillStyle instanceof qr?this.fillStyle=i.fillStyle:this.fillStyle=Ur.pull("Color").parseCSS(i.fillStyle):this.fillStyle=Ur.pull("Color",0,0,0),void 0!==i.strokeStyle?i.strokeStyle instanceof qr?this.strokeStyle=i.strokeStyle:this.strokeStyle=Ur.pull("Color").parseCSS(i.strokeStyle):this.strokeStyle=Ur.pull("Color",0,0,0),this.lineWidth=i.lineWidth||1,this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.offScreenCanvas=!1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontSize=10,void 0!==i.anchorPoint?this.anchorPoint.setV(i.anchorPoint):this.anchorPoint.set(0,0),void 0!==i.floating&&(this.floating=!!i.floating),this.setFont(i.font,i.size),!0===i.bold&&this.bold(),!0===i.italic&&this.italic(),!0===i.offScreenCanvas&&(this.offScreenCanvas=!0,this.canvasTexture=Ur.pull("CanvasTexture",2,2,{offscreenCanvas:!0})),this.metrics=new Yd(this),this.setText(i.text)}bold(){return this.font="bold "+this.font,this.isDirty=!0,this}italic(){return this.font="italic "+this.font,this.isDirty=!0,this}setFont(t,e=10){var i=t.split(",").map((function(t){return t=t.trim(),/(^".*"$)|(^'.*'$)/.test(t)?t:'"'+t+'"'}));if("number"==typeof e)this.fontSize=e,e+="px";else{var s=e.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(s[1]),s[2]?this.fontSize*=Kd[Wd.indexOf(s[2])]:e+="px"}return this.height=this.fontSize,this.font=e+" "+i.join(","),this.isDirty=!0,this}setText(t=""){var e=this.getBounds();if(this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split("\n")),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth,qd(Sd,this))),e.addBounds(this.metrics.measureText(this._text,qd(Sd,this)),!0),!0===this.offScreenCanvas){var i=Math.ceil(this.metrics.width),s=Math.ceil(this.metrics.height);Sd instanceof vd&&(this.glTextureUnit=Sd.cache.getUnit(Sd.cache.get(this.canvasTexture.canvas)),Sd.currentCompositor.unbindTexture2D(null,this.glTextureUnit),1===Sd.WebGLVersion&&(i=Tr(this.metrics.width),s=Tr(this.metrics.height))),(this.canvasTexture.width<i||this.canvasTexture.height<s)&&this.canvasTexture.resize(i,s),this.canvasTexture.clear(),this._drawFont(this.canvasTexture.context,this._text,this.pos.x-this.metrics.x,this.pos.y-this.metrics.y,!1)}return this.isDirty=!0,this}measureText(t,e=this._text){return this.metrics.measureText(e,qd(t,this))}draw(t,e,i=this.pos.x,s=this.pos.y,r=!1){void 0===this.ancestor?(this.pos.x===i&&this.pos.y===s||(this.pos.x=i,this.pos.y=s,this.isDirty=!0),this.setText(e),i=this.metrics.x,s=this.metrics.y,t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity())):(i=this.pos.x,s=this.pos.y),!1===t.settings.subPixel&&(i=~~i,s=~~s),!0===this.offScreenCanvas?t.drawImage(this.canvasTexture.canvas,i,s):t.drawFont(this._drawFont(t.getFontContext(),this._text,i,s,r)),void 0===this.ancestor&&t.restore()}drawStroke(t,e,i,s){this.draw(t,e,i,s,!0)}_drawFont(t,e,i,s,r=!1){Xd(t,this,r);for(var n=0;n<e.length;n++){var o=e[n].trimEnd();t[r?"strokeText":"fillText"](o,i,s),s+=this.metrics.lineHeight()}return this.metrics}destroy(){!0===this.offScreenCanvas&&(Sd instanceof vd&&(Sd.currentCompositor.deleteTexture2D(Sd.currentCompositor.getTexture2D(this.glTextureUnit)),this.glTextureUnit=void 0),Sd.cache.delete(this.canvasTexture.canvas),Ur.push(this.canvasTexture),this.canvasTexture=void 0),Ur.push(this.fillStyle),Ur.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this.metrics=void 0,this._text.length=0,super.destroy()}}class Qd extends ml{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontScale=Ur.pull("Vector2d",1,1),this.fontImage="object"==typeof i.font?i.font:Ju.getImage(i.font),"string"!=typeof i.fontData?this.fontData=Ur.pull("BitmapTextData",Ju.getBinary(i.font)):this.fontData=Ur.pull("BitmapTextData",i.fontData.includes("info face")?i.fontData:Ju.getBinary(i.fontData)),void 0!==i.floating&&(this.floating=!!i.floating),void 0!==i.fillStyle&&(this.fillStyle=i.fillStyle),void 0!==i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),this.metrics=new Yd(this),"number"==typeof i.size&&1!==i.size&&this.resize(i.size),this.setText(i.text)}set(t,e){return this.textAlign=t,e&&this.resize(e),this.isDirty=!0,this}setText(t=""){return this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split("\n"),this.isDirty=!0),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth)),this.getBounds().addBounds(this.metrics.measureText(this._text),!0),this}get fillStyle(){return this.tint}set fillStyle(t){t instanceof qr?this.tint.copy(t):this.tint.parseCSS(t)}resize(t){return this.fontScale.set(t,t),this.getBounds().addBounds(this.metrics.measureText(this._text),!0),this.isDirty=!0,this}measureText(t=this._text){return this.metrics.measureText(t)}draw(t,e,i,s){var r=t.globalAlpha();void 0===this.ancestor?(this.setText(e),t.setGlobalAlpha(r*this.getOpacity())):(i=this.pos.x,s=this.pos.y);for(var n=i,o=this.metrics.lineHeight(),a=0,h=0;h<this._text.length;h++){i=n;var l=this._text[h].trimEnd(),u=this.metrics.lineWidth(l);switch(this.textAlign){case"right":i-=u;break;case"center":i-=.5*u}switch(this.textBaseline){case"middle":s-=.5*o;break;case"ideographic":case"alphabetic":case"bottom":s-=o}!0===this.isDirty&&void 0===this.ancestor&&(0===h&&(this.pos.y=s),a<u&&(a=u,this.pos.x=i));for(var d=null,c=0,p=l.length;c<p;c++){var f=l.charCodeAt(c),g=this.fontData.glyphs[f];if(void 0!==g){var m=g.width,y=g.height,v=d&&d.kerning?d.getKerning(f):0,x=this.fontScale.x,_=this.fontScale.y;0!==m&&0!==y&&t.drawImage(this.fontImage,g.x,g.y,m,y,i+g.xoffset*x,s+g.yoffset*_,m*x,y*_),i+=(g.xadvance+v)*x,d=g}else console.warn("BitmapText: no defined Glyph in for "+String.fromCharCode(f))}s+=o}void 0===this.ancestor&&t.setGlobalAlpha(r),this.isDirty=!1}destroy(){Ur.push(this.fontScale),this.fontScale=void 0,Ur.push(this.fontData),this.fontData=void 0,this._text.length=0,this.metrics=void 0,super.destroy()}}class Jd{constructor(){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}getKerning(t){if(this.kerning){var e=this.kerning[t>>>9];if(e)return e[511&t]||0}return 0}setKerning(t,e){this.kerning||(this.kerning={});var i=this.kerning[t>>>9];void 0===i&&(this.kerning[t>>>9]={},i=this.kerning[t>>>9]),i[511&t]=e}}const $d=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function tc(t,e){var i=t.match(e);if(!i)throw new Error("Could not find pattern "+e+" in string: "+t);return i[0].split("=")[1]}class ec{constructor(t){this.onResetEvent(t)}onResetEvent(t){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(t)}parse(t){if(!t)throw new Error("File containing font data was empty, cannot load the bitmap font.");var e=t.split(/\r\n|\n/),i=t.match(/padding\=\d+,\d+,\d+,\d+/g);if(!i)throw new Error("Padding not found in first line");var s=i[0].split("=")[1].split(",");this.padTop=parseFloat(s[0]),this.padLeft=parseFloat(s[1]),this.padBottom=parseFloat(s[2]),this.padRight=parseFloat(s[3]),this.lineHeight=parseFloat(tc(e[1],/lineHeight\=\d+/g));var r,n=parseFloat(tc(e[1],/base\=\d+/g)),o=this.padTop+this.padBottom,a=null;for(r=4;r<e.length;r++){var h=e[r],l=h.split(/=|\s+/);if(h&&!/^kernings/.test(h))if(/^kerning\s/.test(h)){var u=parseFloat(l[2]),d=parseFloat(l[4]),c=parseFloat(l[6]);null!=(a=this.glyphs[u])&&a.setKerning(d,c)}else{a=new Jd;var p=parseFloat(l[2]);a.id=p,a.x=parseFloat(l[4]),a.y=parseFloat(l[6]),a.width=parseFloat(l[8]),a.height=parseFloat(l[10]),a.xoffset=parseFloat(l[12]),a.yoffset=parseFloat(l[14]),a.xadvance=parseFloat(l[16]),a.width>0&&a.height>0&&(this.descent=Math.min(n+a.yoffset,this.descent)),this.glyphs[p]=a}}this.descent+=this.padBottom,function(t){var e=" ".charCodeAt(0),i=t[e];i||((i=new Jd).id=e,i.xadvance=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)if(e[i]>32)return t[e[i]];return null}(t).xadvance,t[e]=i)}(this.glyphs);var f=null;for(r=0;r<$d.length;r++){var g=$d[r];if(f=this.glyphs[g.charCodeAt(0)])break}if(f)this.capHeight=f.height;else for(var m in this.glyphs)if(this.glyphs.hasOwnProperty(m)){if(0===(a=this.glyphs[m]).height||0===a.width)continue;this.capHeight=Math.max(this.capHeight,a.height)}this.capHeight-=o}}class ic extends ml{constructor(t,e,i){super(0,0,1/0,1/0),this.color=Ur.pull("Color").parseCSS(e),this.onResetEvent(t,e,i)}onResetEvent(t,e,i=0){this.name=t,this.pos.z=i,this.floating=!0,this.color.parseCSS(e)}draw(t,e){t.save(),t.clipRect(0,0,e.width,e.height),t.clearColor(this.color),t.restore()}destroy(){Ur.push(this.color),this.color=void 0,super.destroy()}}class sc extends $u{constructor(t,e,i){super(t,e,i),this.floating=!0,this.offset.set(t,e),this.ratio=Ur.pull("Vector2d",1,1),void 0!==i.ratio&&(ur(i.ratio)?this.ratio.set(i.ratio,+i.ratio):this.ratio.setV(i.ratio)),void 0===i.anchorPoint?this.anchorPoint.set(0,0):"number"==typeof i.anchorPoint?this.anchorPoint.set(i.anchorPoint,i.anchorPoint):this.anchorPoint.setV(i.anchorPoint),this.repeat=i.repeat||"repeat",Ln(Bn,this.createPattern,this)}get repeat(){return this._repeat}set repeat(t){switch(this._repeat=t,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}this.resize(Gl.viewport.width,Gl.viewport.height),this.createPattern()}onActivateEvent(){Ln(kn,this.updateLayer,this),Ln(Mn,this.resize,this),Dn(mn,(()=>{this.updateLayer(Gl.viewport.pos)})),!0!==this.ancestor.root&&this.updateLayer(Gl.viewport.pos)}resize(t,e){return super.resize(this.repeatX?1/0:t,this.repeatY?1/0:e)}createPattern(){this._pattern=Sd.createPattern(this.image,this._repeat)}updateLayer(t){var e=this.ratio.x,i=this.ratio.y;if(0!==e||0!==i){var s=this.width,r=this.height,n=Gl.viewport.bounds.width,o=Gl.viewport.bounds.height,a=this.anchorPoint.x,h=this.anchorPoint.y,l=a*(e-1)*(n-Gl.viewport.width)+this.offset.x-e*t.x,u=h*(i-1)*(o-Gl.viewport.height)+this.offset.y-i*t.y;this.repeatX?this.pos.x=l%s:this.pos.x=l,this.repeatY?this.pos.y=u%r:this.pos.y=u,this.isDirty=!0}}preDraw(t){t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),t.setTint(this.tint)}draw(t,e){var i=this.width,s=this.height,r=e.bounds.width,n=e.bounds.height,o=this.anchorPoint.x,a=this.anchorPoint.y,h=this.pos.x,l=this.pos.y;0===this.ratio.x&&0===this.ratio.y&&(h+=o*(r-i),l+=a*(n-s)),t.translate(h,l),t.drawPattern(this._pattern,0,0,2*e.width,2*e.height)}onDeactivateEvent(){Fn(kn,this.updateLayer),Fn(Mn,this.resize)}destroy(){Ur.push(this.ratio),this.ratio=void 0,Fn(Bn,this.createPattern),super.destroy()}}class rc extends $u{constructor(t,e,i){if(super(t,e,i),"number"!=typeof i.width||"number"!=typeof i.height)throw new Error("height and width properties are mandatory");this.width=Math.floor(i.width),this.height=Math.floor(i.height),this.nss_width=this.width,this.nss_height=this.height,this.insetx=i.insetx,this.insety=i.insety}get width(){return super.width}set width(t){super.width=this.nss_width=t}get height(){return super.height}set height(t){super.height=this.nss_height=t}draw(t){var e=this.current,i=this.pos.x,s=this.pos.y,r=e.width,n=e.height,o=e.offset,a=this.offset;0!==e.angle&&(t.translate(-i,-s),t.rotate(e.angle),i-=n,r=e.height,n=e.width);var h=a.x+o.x,l=a.y+o.y,u=this.insetx||r/4,d=this.insety||n/4;t.drawImage(this.image,h,l,u,d,i,s,u,d),t.drawImage(this.image,h+r-u,l,u,d,i+this.nss_width-u,s,u,d),t.drawImage(this.image,h,l+n-d,u,d,i,s+this.nss_height-d,u,d),t.drawImage(this.image,h+r-u,l+n-d,u,d,i+this.nss_width-u,s+this.nss_height-d,u,d);var c=r-(u<<1),p=n-(d<<1),f=this.nss_width-(u<<1),g=this.nss_height-(d<<1);t.drawImage(this.image,h+u,l,c,d,i+u,s,f,d),t.drawImage(this.image,h+u,l+n-d,c,d,i+u,s+this.nss_height-d,f,d),t.drawImage(this.image,h,l+d,u,p,i,s+d,u,g),t.drawImage(this.image,h+r-u,l+d,u,p,i+this.nss_width-u,s+d,u,g),t.drawImage(this.image,h+u,l+d,c,p,i+u,s+d,f,g)}}class nc extends $u{constructor(t,e,i){super(t,e,i),this.isClickable=!0,this.holdThreshold=250,this.isHoldable=!1,this.hover=!1,this.holdTimeout=null,this.released=!0,this.floating=!0,this.isKinematic=!1}clicked(t){if(0===t.button&&this.isClickable)return this.dirty=!0,this.released=!1,this.isHoldable&&(null!==this.holdTimeout&&Rd.clearTimeout(this.holdTimeout),this.holdTimeout=Rd.setTimeout(this.hold.bind(this),this.holdThreshold,!1),this.released=!1),this.onClick(t)}onClick(t){return!1}enter(t){return this.hover=!0,this.dirty=!0,this.onOver(t)}onOver(t){}leave(t){return this.hover=!1,this.dirty=!0,this.release(t),this.onOut(t)}onOut(t){}release(t){if(!1===this.released)return this.released=!0,this.dirty=!0,Rd.clearTimeout(this.holdTimeout),this.onRelease(t)}onRelease(){return!1}hold(){Rd.clearTimeout(this.holdTimeout),this.dirty=!0,this.released||this.onHold()}onHold(){}onActivateEvent(){el("pointerdown",this,this.clicked.bind(this)),el("pointerup",this,this.release.bind(this)),el("pointercancel",this,this.release.bind(this)),el("pointerenter",this,this.enter.bind(this)),el("pointerleave",this,this.leave.bind(this))}onDeactivateEvent(){il("pointerdown",this),il("pointerup",this),il("pointercancel",this),il("pointerenter",this),il("pointerleave",this),Rd.clearTimeout(this.holdTimeout)}}class oc extends $u{constructor(t,e,i){super(t,e,i),this.name=i.name,this.type=i.type,this.id=i.id;var s=i.shapes;void 0===s&&(s=Ur.pull("Polygon",0,0,[Ur.pull("Vector2d",0,0),Ur.pull("Vector2d",this.width,0),Ur.pull("Vector2d",this.width,this.height)])),this.body=new Bl(this,s),this.body.collisionType=Ol.types.COLLECTABLE_OBJECT,this.body.setCollisionMask(Ol.types.PLAYER_OBJECT),this.body.setStatic(!0),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0)}}class ac extends ml{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.anchorPoint.set(0,0),this.fade=i.fade,this.duration=i.duration,this.fading=!1,this.name="Trigger",this.type=i.type,this.id=i.id,this.gotolevel=i.to,this.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(function(t){void 0!==i[t]&&(this.triggerSettings[t]=i[t])}.bind(this));var s=i.shapes;void 0===s&&(s=Ur.pull("Polygon",0,0,[Ur.pull("Vector2d",0,0),Ur.pull("Vector2d",this.width,0),Ur.pull("Vector2d",this.width,this.height)])),this.body=new Bl(this,s),this.body.collisionType=Ol.types.ACTION_OBJECT,this.body.setCollisionMask(Ol.types.PLAYER_OBJECT),this.body.setStatic(!0),this.resize(this.body.getBounds().width,this.body.getBounds().height)}getTriggerSettings(){return"string"==typeof this.triggerSettings.container&&(this.triggerSettings.container=Gl.world.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings}onFadeComplete(){Du.load(this.gotolevel,this.getTriggerSettings()),Gl.viewport.fadeOut(this.fade,this.duration)}triggerEvent(){var t=this.getTriggerSettings();if("level"!==t.event)throw new Error("Trigger invalid type");this.gotolevel=t.to,this.fade&&this.duration?this.fading||(this.fading=!0,Gl.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):Du.load(this.gotolevel,t)}onCollision(t,e){return"Trigger"===this.name&&this.triggerEvent.apply(this),!1}}class hc extends ml{constructor(t,e,i,s=i,r="#FFF",n=.7){super(t,e,2*i,2*s),this.color=Ur.pull("Color").parseCSS(r),this.radiusX=i,this.radiusY=s,this.intensity=n,this.blendMode="lighter",this.visibleArea=Ur.pull("Ellipse",this.centerX,this.centerY,this.width,this.height),this.texture=Ur.pull("CanvasTexture",this.width,this.height,{offscreenCanvas:!1}),this.anchorPoint.set(0,0),function(t){var e,i,s,r,n,o=t.texture.context,a=t.texture.width/2,h=t.texture.height/2,l=t.radiusX,u=t.radiusY;t.texture.clear(),l>=u?(e=1,s=1,i=u/l,r=l/u,n=o.createRadialGradient(a,h*r,0,a,u*r,l)):(i=1,r=1,e=l/u,s=u/l,n=o.createRadialGradient(a*s,h,0,a*s,h,u)),n.addColorStop(0,t.color.toRGBA(t.intensity)),n.addColorStop(1,t.color.toRGBA(0)),o.fillStyle=n,o.setTransform(e,0,0,i,0,0),o.fillRect(0,0,t.texture.width*s,t.texture.height*r)}(this)}getVisibleArea(){return this.visibleArea.setShape(this.getBounds().centerX,this.getBounds().centerY,this.width,this.height)}draw(t,e){t.drawImage(this.texture.canvas,this.getBounds().x,this.getBounds().y)}destroy(){Ur.push(this.color),this.color=void 0,Ur.push(this.texture),this.texture=void 0,Ur.push(this.visibleArea),this.visibleArea=void 0,super.destroy()}}Math.PI;class lc extends ml{constructor(t){super(t.getRandomPointX(),t.getRandomPointY(),t.settings.image.width,t.settings.image.height),this.onResetEvent(t,!0)}onResetEvent(t,e=!1){!1===e?(this.pos.set(t.getRandomPointX(),t.getRandomPointY()),this.resize(t.settings.image.width,t.settings.image.height),this.currentTransform.identity()):this.vel=Ur.pull("Vector2d"),this.image=t.settings.image,this.alwaysUpdate=!0,"string"==typeof t.settings.tint&&this.tint.parseCSS(t.settings.tint),!0===t.settings.textureAdditive&&(this.blendMode="additive"),"normal"!==t.settings.blendMode&&(this.blendMode=t.settings.blendMode);var i=t.settings.angle+(t.settings.angleVariation>0?(Cr(0,2)-1)*t.settings.angleVariation:0),s=t.settings.speed+(t.settings.speedVariation>0?(Cr(0,2)-1)*t.settings.speedVariation:0);this.vel.set(s*Math.cos(i),-s*Math.sin(i)),this.life=Cr(t.settings.minLife,t.settings.maxLife),this.startLife=this.life,this.startScale=Er(Cr(t.settings.minStartScale,t.settings.maxStartScale),t.settings.minStartScale,t.settings.maxStartScale),this.endScale=Er(Cr(t.settings.minEndScale,t.settings.maxEndScale),t.settings.minEndScale,t.settings.maxEndScale),this.gravity=t.settings.gravity,this.wind=t.settings.wind,this.followTrajectory=t.settings.followTrajectory,this.onlyInViewport=t.settings.onlyInViewport,this._deltaInv=Rd.maxfps/1e3,t.settings.followTrajectory||(this.angle=Cr(t.settings.minRotation,t.settings.maxRotation))}update(t){var e=t*this._deltaInv;if(this.life=this.life>t?this.life-t:0,this.life<=0)return this.ancestor.removeChild(this),!1;var i=this.life/this.startLife,s=this.startScale;this.startScale>this.endScale?s=(s*=i)<this.endScale?this.endScale:s:this.startScale<this.endScale&&(s=(s/=i)>this.endScale?this.endScale:s),this.alpha=i,this.vel.x+=this.wind*e,this.vel.y+=this.gravity*e;var r=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*e,this.pos.y+=this.vel.y*e,this.currentTransform.setTransform(s,0,0,0,s,0,this.pos.x,this.pos.y,1).rotate(r),this.isDirty=this.inViewport||!this.onlyInViewport,super.update(t)}draw(t){var e=this.width,i=this.height;t.drawImage(this.image,0,0,e,i,-e/2,-i/2,e,i)}}class uc extends ml{constructor(t,e,i){if("number"!=typeof i.width||"number"!=typeof i.height)throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");super(t,e,i.width,i.height),this.children=[],i.image&&(i.framewidth=i.framewidth||i.width,i.frameheight=i.frameheight||i.height,this.renderable=new $u(0,0,i)),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),"string"==typeof i.name&&(this.name=i.name),this.type=i.type||"",this.id=i.id||"",this.alive=!0,void 0===i.shapes&&(i.shapes=Ur.pull("Polygon",0,0,[Ur.pull("Vector2d",0,0),Ur.pull("Vector2d",this.width,0),Ur.pull("Vector2d",this.width,this.height),Ur.pull("Vector2d",0,this.height)])),this.body=new Bl(this,i.shapes,this.onBodyUpdate.bind(this)),0===this.width&&0===this.height&&this.resize(this.body.getBounds().width,this.body.getBounds().height),this.body.setCollisionMask(i.collisionMask),this.body.setCollisionType(i.collisionType),this.autoTransform=!1}get renderable(){return this.children[0]}set renderable(t){if(!(t instanceof ml))throw new Error(t+"should extend me.Renderable");this.children[0]=t,this.children[0].ancestor=this}update(t){return this.renderable&&(this.isDirty|=this.renderable.update(t)),super.update(t)}onBodyUpdate(t){this.getBounds().addBounds(t.getBounds(),!0),this.updateBoundsPos(this.pos.x,this.pos.y)}preDraw(t){t.save(),t.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof ml&&t.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}draw(t,e){var i=this.renderable;i instanceof ml&&(i.preDraw(t),i.draw(t,e),i.postDraw(t))}destroy(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),super.destroy(arguments)}onDeactivateEvent(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()}}function dc(t,e,i){var s="melonJS: %s is deprecated since version %s, please use %s",r=(new Error).stack;console.groupCollapsed?console.groupCollapsed("%c"+s,"font-weight:normal;color:yellow;",t,i,e):console.warn(s,t,i,e),void 0!==r&&console.warn(r),console.groupCollapsed&&console.groupEnd()}Object.defineProperty(Va.prototype,"Texture",{get:function(){return dc("me.video.renderer.Texture","me.TextureAtlas","10.4.0"),ed}}),Va.prototype.getScreenCanvas=function(){return dc("getScreenCanvas","getCanvas","13.1.0"),this.getCanvas()},Va.prototype.getScreenContext=function(){return dc("getScreenContext","getContext","13.1.0"),this.getContext()};const cc="13.4.0";var pc=!1;Uo((function(){!0!==pc&&(Ur.register("me.Entity",uc),Ur.register("me.Collectable",oc),Ur.register("me.Trigger",ac),Ur.register("me.Light2d",hc),Ur.register("me.Tween",Gd,!0),Ur.register("me.Color",qr,!0),Ur.register("me.Particle",lc,!0),Ur.register("me.Sprite",$u),Ur.register("me.NineSliceSprite",rc),Ur.register("me.Renderable",ml),Ur.register("me.Text",Zd,!0),Ur.register("me.BitmapText",Qd),Ur.register("me.BitmapTextData",ec,!0),Ur.register("me.ImageLayer",sc),Ur.register("me.ColorLayer",ic,!0),Ur.register("me.Vector2d",Vr,!0),Ur.register("me.Vector3d",oh,!0),Ur.register("me.ObservableVector2d",nh,!0),Ur.register("me.ObservableVector3d",ah,!0),Ur.register("me.Matrix2d",Qr,!0),Ur.register("me.Matrix3d",Zr,!0),Ur.register("me.Rect",Ba,!0),Ur.register("me.RoundRect",Ra,!0),Ur.register("me.Polygon",Oa,!0),Ur.register("me.Line",Da,!0),Ur.register("me.Point",Ua,!0),Ur.register("me.Ellipse",La,!0),Ur.register("me.Bounds",Fa,!0),Ur.register("Entity",uc),Ur.register("Collectable",oc),Ur.register("Trigger",ac),Ur.register("Light2d",hc),Ur.register("Tween",Gd,!0),Ur.register("Color",qr,!0),Ur.register("Particle",lc,!0),Ur.register("Sprite",$u),Ur.register("NineSliceSprite",rc),Ur.register("Renderable",ml),Ur.register("Text",Zd,!0),Ur.register("BitmapText",Qd),Ur.register("BitmapTextData",ec,!0),Ur.register("ImageLayer",sc),Ur.register("ColorLayer",ic,!0),Ur.register("Vector2d",Vr,!0),Ur.register("Vector3d",oh,!0),Ur.register("ObservableVector2d",nh,!0),Ur.register("ObservableVector3d",ah,!0),Ur.register("Matrix2d",Qr,!0),Ur.register("Matrix3d",Zr,!0),Ur.register("Rect",Ba,!0),Ur.register("RoundRect",Ra,!0),Ur.register("Polygon",Oa,!0),Ur.register("Line",Da,!0),Ur.register("Point",Ua,!0),Ur.register("Ellipse",La,!0),Ur.register("Bounds",Fa,!0),Ur.register("CanvasTexture",Hd,!0),Rn(en),Ju.setNocache(Bd.getUriFragment().nocache||!1),yh(),pc=!0)}));var fc=i(379),gc=i.n(fc),mc=i(795),yc=i.n(mc),vc=i(569),xc=i.n(vc),_c=i(565),bc=i.n(_c),wc=i(216),Tc=i.n(wc),Ac=i(589),Ec=i.n(Ac),Sc=i(424),Cc={};function Mc(t){return.75*t}function Pc(t){return.25*t}function Ic(t){return"mainPlayer"===t}function kc(){let t=Du.getCurrentLevel().name,e=rh.getCurrentTrack(),i=e;switch(t){case"level1":i="theme-town";break;case"level2":i="theme-dessert-plains";break;case"level3":i="theme-mist-forest";break;case"level-final":i="theme-final";break;case"startmenu":i="theme-startmenu";break;case"gameover":case"gameover-alternate":rh.stopTrack()}i&&e!==i&&(rh.stopTrack(),rh.playTrack(i))}function Oc(){Gl.viewport.fadeIn("#fff",300,(function(){Gl.viewport.fadeOut("#fff",150)}))}function Bc(){return Du.getCurrentLevel().name.startsWith("level")}function Rc(){Gl.data.useAltMode?Gl.data.lives=Gl.data.initialAltModeLives:(Gl.data.lives=Gl.data.initialLives,Lc())}function Lc(){Gl.data.score=Gl.data.useAltMode?Gl.data.initialAltModeScore:Gl.data.initialScore}function Dc(){Gl.data.altModeGameOverScreen=Gl.data.initialAltModeGameOverScreen,Gl.data.altModePenaltyScore=Gl.data.initialAltModePenaltyScore,Gl.data.altModePenaltyTimer=Gl.data.initialAltModePenaltyTimer,Gl.data.altModePenaltyTimerMax=Gl.data.initialAltModePenaltyTimerMax}function Fc(){Gl.data.flashBlockTimer=Gl.data.initialFlashBlockTimer,Gl.data.flashBlockTimerMax=Gl.data.initialFlashBlockTimer,Gl.data.flashBlockTriggerInstance=void 0}function zc(t,e){document.getElementById("messageModal").style.display=["none","block"][1*e],document.getElementById("messageContents").innerText=t}function Uc(t,e){t?uu.resume():uu.pause(),e?zc(e,!0):zc("",!1)}function Vc(){let t=Gl.world.getChildByName("BoxGuyEntity");if(t.push(...Gl.world.getChildByName("NpcWerioEntity")),t.length<=0)Uc(!0,"");else for(let e=0;e<t.length;e++)if(t[e].messageSubIndex>=0){t[e].nextMessage();break}}Cc.styleTagTransform=Ec(),Cc.setAttributes=bc(),Cc.insert=xc().bind(null,"head"),Cc.domAPI=yc(),Cc.insertStyleElement=Tc(),gc()(Sc.Z,Cc),Sc.Z&&Sc.Z.locals&&Sc.Z.locals;class Nc extends nc{constructor(t,e,i){super(t,e,{image:"ONSCREENCONTROLS",framewidth:128,frameheight:128,width:128,height:128}),this.key=i,this.opacityOff=.5,this.opacityOn=.75,this.setOpacity(this.opacityOff),this.anchorPoint.set(0,0);let s=0,r=1;i===gl.KEY.RIGHT?(s=2,r=3):i===gl.KEY.UP&&(s=4,r=5),this.addAnimation("off",[s]),this.addAnimation("on",[r]),this.setCurrentAnimation("off")}onClick(t){return this.setOpacity(this.opacityOn),gl.triggerKeyEvent(this.key,!0),this.setCurrentAnimation("on"),!1}onRelease(t){return this.setOpacity(this.opacityOff),gl.triggerKeyEvent(this.key,!1),this.setCurrentAnimation("off"),!1}}class Gc extends Qd{constructor(t,e){super(t,e,{font:"Verdana",textAlign:"left",textBaseline:"top",text:""}),this.relative=new Vr(t,e),this.scoreLabel=new Qd(t,e,{font:"Verdana",size:10}),zn.on(zn.CANVAS_ONRESIZE,function(t,e){this.pos.set(t,e,0).add(this.relative)}.bind(this))}update(t){return kc(),Bc()?this.setText(`Brownie Points: ${Gl.data.score}`):(this.setText(""),Fc(),Rc(),"gameover"===Du.getCurrentLevel().name&&(Dc(),Lc())),"level-final"===Du.getCurrentLevel().name&&Gl.data.score>Gl.data.highScore&&(Gl.data.highScore=Gl.data.score),super.update(t)}}class jc extends ml{constructor(t,e){super(t,e),this.lifeImage=Ju.getImage("LIFES"),this.x=t,this.y=e}draw(t){if(Bc())for(let e=0;e<Gl.data.lives;e++)t.drawImage(this.lifeImage,.9*this.x-this.lifeImage.width*e,this.y,this.lifeImage.width,this.lifeImage.height)}}var Hc=class extends Dl{constructor(){if(super(),this.isPersistent=!0,this.floating=!0,this.z=1/0,this.name="HUD",this.addChild(new Gc(0,0)),this.addChild(new jc(Gl.viewport.width,8)),Zo.isMobile){const t=Gl.viewport.height-130,e=30,i=e+140;this.addChild(new Nc(Gl.viewport.width-125,t,gl.KEY.UP)),this.addChild(new Nc(e,t,gl.KEY.LEFT)),this.addChild(new Nc(i,t,gl.KEY.RIGHT))}}},Xc=class extends ql{onResetEvent(){Du.load("startmenu"),Gl.data.lives<=0&&(Rc(),Fc(),Dc()),this.HUD=new Hc,Gl.world.addChild(this.HUD),kc()}onDestroyEvent(){Gl.world.removeChild(this.HUD)}},Yc=class extends uc{constructor(t,e,i){i.image="MERIO",super(t,e,i),this.body=new Bl(this),this.body.collisionType=Ol.types.PLAYER_OBJECT,this.body.addShape(new Oa(0,0,[new Vr(0,0),new Vr(this.width,0),new Vr(this.width,20),new Vr(0,20)])),this.body.addShape(new Oa(0,0,[new Vr(Mc(this.width),20),new Vr(Mc(this.width),this.height),new Vr(0,this.height),new Vr(0,20)])),this.body.setMaxVelocity(3.25,18),this.body.setFriction(.5,.5),Gl.viewport.follow(this,Gl.viewport.AXIS.BOTH,.1),this.alwaysUpdate=!0,this.renderable.addAnimation("walk",[2,0,3,0],75),this.renderable.addAnimation("stand",[0]),this.renderable.addAnimation("jump",[1]),this.renderable.setCurrentAnimation("stand"),this.alive=!0,Fc()}update(t){return this.alive?(this.body.maxVel.x=3.25,gl.isKeyPressed("left")?(this.renderable.flipX(!0),this.body.force.x=-this.body.maxVel.x,this.body.getShape(1).points[0].x=this.width,this.body.getShape(1).points[1].x=this.width,this.body.getShape(1).points[2].x=Pc(this.width),this.body.getShape(1).points[3].x=Pc(this.width),this.body.ridingplatform=!1,0!==this.body.vel.y||this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):gl.isKeyPressed("right")?(this.renderable.flipX(!1),this.body.force.x=this.body.maxVel.x,this.body.getShape(1).points[0].x=Mc(this.width),this.body.getShape(1).points[1].x=Mc(this.width),this.body.getShape(1).points[2].x=0,this.body.getShape(1).points[3].x=0,0!==this.body.vel.y||this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):(this.body.force.x=0,0===this.body.vel.y&&this.renderable.setCurrentAnimation("stand")),gl.keyStatus("jump")&&(this.body.jumping||this.body.falling||(this.body.vel.y=-this.body.maxVel.y*Rd.tick,this.body.jumping=!0)),(this.body.jumping||this.body.falling)&&this.renderable.setCurrentAnimation("jump"),super.update(t)):(Gl.data.lives--,Gl.data.score-=100,Fc(),Gl.data.lives<=0?(Gl.data.lives=0,Oc(),Gl.data.useAltMode?(Gl.data.score-=Gl.data.altModePenaltyScore,Gl.data.altModePenaltyScore*=Gl.data.initialAltModePenaltyScoreScale,Gl.data.altModePenaltyTimer=0,Gl.data.altModePenaltyTimerMax*=Gl.data.initialAltModePenaltyTimerScale,Gl.data.currentGameLevel=Du.getCurrentLevel().name,Du.load(Gl.data.altModeGameOverScreen)):Du.load("gameover")):(Du.reload(),Oc()),!1)}onCollision(t,e){switch(t.b.body.collisionType){case Ol.types.WORLD_SHAPE:break;case Ol.types.ENEMY_OBJECT:case Ol.types.PHYSICS_BOUND_ENEMY_OBJECT:return e.undefeatable?(this.alive=!1,!0):(t.overlapV.y>0&&!this.body.jumping?e.alive=!1:Ic(e.name)||(this.alive=!1),!1);default:return!1}return!0}},Wc=class extends oc{constructor(t,e,i){i.image="SECRET",super(t,e,i)}onCollision(t,e){return Ic(e.name)&&(Gl.data.score+=1e6,this.body.setCollisionMask(Ol.types.NO_OBJECT),Gl.world.removeChild(this)),!1}},Kc=class extends $u{constructor(t,e,i){let s=i.width;i.image="MONSTOID",super(t,e,i),this.body=new Bl(this),this.body.collisionType=Ol.types.ENEMY_OBJECT,this.body.addShape(new Ba(0,0,this.width,this.height)),this.body.setMaxVelocity(1,0),this.isKinematic=!1,this.alwaysUpdate=!0,t=this.pos.x,this.startX=t,this.pos.x=t+s-this.width,this.endX=this.pos.x,this.walkLeft=!1,this.undefeatable=!0}update(t){return this.walkLeft&&this.pos.x<=this.startX?(this.walkLeft=!1,this.body.force.x=this.body.maxVel.x):!this.walkLeft&&this.pos.x>=this.endX&&(this.walkLeft=!0,this.body.force.x=-this.body.maxVel.x),this.body.update(t)}},qc=class extends $u{constructor(t,e,i){let s=i.height;i.image="DUSTGUY",super(t,e,i),this.body=new Bl(this),this.body.collisionType=Ol.types.ENEMY_OBJECT,this.body.addShape(new Ba(0,0,this.width,this.height)),this.body.setMaxVelocity(0,1),this.isKinematic=!1,this.alwaysUpdate=!0,e=this.pos.y,this.startY=e,this.pos.y=e+s-this.height,this.endY=this.pos.y,this.walkUp=!0,this.undefeatable=!0}update(t){return this.walkUp?this.walkUp&&(this.body.force.y=-this.body.maxVel.y,this.pos.y<=this.startY&&(this.walkUp=!1)):(this.body.force.y=this.body.maxVel.y,this.pos.y>=this.endY&&(this.walkUp=!0)),this.body.update(t)}},Zc=class extends uc{constructor(t,e,i){i.image="DONUT",super(t,e,i),this.body=new Bl(this),this.body.collisionType=Ol.types.PHYSICS_BOUND_ENEMY_OBJECT,this.body.addShape(new Ba(0,0,this.width,this.height)),this.body.setMaxVelocity(1,6),this.body.gravityScale=.24,this.body.setFriction(.5,0),this.isKinematic=!1,this.alwaysUpdate=!0,this.undefeatable=!1,this.alive=!0,this.speedX=3,this.directionX=1}update(t){return this.alive||(Gl.data.score+=800,Gl.world.removeChild(this)),this.body.force.x=this.speedX*this.directionX,super.update(t)}onCollision(t,e){return t.b.body.collisionType===Ol.types.WORLD_SHAPE&&(t.overlapV.y>0&&(this.body.vel.y=-this.body.maxVel.y*Rd.tick),0!==t.overlapV.x&&(this.directionX*=-1),!0)}},Qc=class extends uc{constructor(t,e,i){i.image="BEARS",super(t,e,i),this.body=new Bl(this),this.body.collisionType=Ol.types.PHYSICS_BOUND_ENEMY_OBJECT,this.body.addShape(new Ba(0,0,this.width,this.height)),this.body.setMaxVelocity(1,6),this.body.gravityScale=.08,this.body.setFriction(.5,0),this.isKinematic=!1,this.alwaysUpdate=!0;const s=2*i.type;this.renderable.addAnimation("stand",[0+s]),this.renderable.addAnimation("jump",[1+s]),this.renderable.setCurrentAnimation("stand"),this.undefeatable=!0,this.alive=!0,this.speedX=3,this.directionX=i.directionX,this.actionTimerMax=200,this.actionTimer=this.actionTimerMax}update(t){return this.alive||(Gl.data.score+=800,Gl.world.removeChild(this)),0!=this.body.vel.y&&this.actionTimer<this.actionTimerMax&&(this.body.force.x=this.speedX*this.directionX),this.actionTimer=(this.actionTimer+1)%this.actionTimerMax,super.update(t)}onCollision(t,e){return t.b.body.collisionType===Ol.types.WORLD_SHAPE&&(t.overlapV.y>0&&(this.renderable.setCurrentAnimation("stand"),this.actionTimer<=0&&(this.body.vel.y=-this.body.maxVel.y*Rd.tick,this.directionX*=-1,this.renderable.flipX(this.directionX<0),this.renderable.setCurrentAnimation("jump"))),!0)}},Jc=class extends oc{constructor(t,e,i){i.image="SECRET",super(t,e,i),this.setOpacity(0),this.body.collisionType=Ol.types.ENEMY_OBJECT,this.undefeatable=!0}},$c=class extends uc{constructor(t,e,i){i.image="FLASHBLOCK",i.framewidth=i.width,i.frameheight=i.height,super(t,e,i),this.settings=i,this.body.setMaxVelocity(0,0),this.body.setFriction(.5,0),this.body.collisionType=Ol.types.NO_OBJECT,this.alwaysUpdate=!0,this.finalOpacity=this.settings.active?1:0,this.initialCollisionType=this.settings.active?Ol.types.WORLD_SHAPE:Ol.types.NO_OBJECT,this.timerActiveCollisionType=this.settings.active?Ol.types.NO_OBJECT:Ol.types.WORLD_SHAPE}update(t){return Gl.data.flashBlockTimer<Gl.data.flashBlockTimerMax?(this.body.collisionType=this.timerActiveCollisionType,this.settings.active?this.renderable.setOpacity(Gl.data.flashBlockTimer/Gl.data.flashBlockTimerMax):this.renderable.setOpacity((Gl.data.flashBlockTimerMax-Gl.data.flashBlockTimer)/Gl.data.flashBlockTimerMax)):(this.body.collisionType=this.initialCollisionType,this.renderable.setOpacity(this.finalOpacity)),super.update(t)}},tp=class extends oc{constructor(t,e,i){i.image="FLASHBLOCKTRIGGER",super(t,e,i),this.settings=i,this.alwaysUpdate=!0,this.isSourceOfTrigger=!1,this.timerStep=this.settings.timerStep??1}onCollision(t,e){return Ic(e.name)&&Gl.data.flashBlockTimer>=Gl.data.flashBlockTimerMax&&(this.setOpacity(0),Gl.data.flashBlockTimer=0,this.isSourceOfTrigger=!0,Gl.data.flashBlockTriggerInstance=this),!1}update(t){return Gl.data.flashBlockTimer<Gl.data.flashBlockTimerMax?(this.isSourceOfTrigger&&(Gl.data.flashBlockTimer+=this.timerStep),this.setOpacity(Gl.data.flashBlockTimer/Gl.data.flashBlockTimerMax)):(this.setOpacity(1),this.isSourceOfTrigger=!1,Gl.data.flashBlockTriggerInstance&&(Gl.data.flashBlockTriggerInstance.isSourceOfTrigger=!1)),!1}},ep=class extends oc{constructor(t,e,i){i.image=i.image??"BOXGUY",super(t,e,i),this.settings=i,this.body.collisionType=Ol.types.WORLD_SHAPE,this.isKinematic=!1,this.updateWhenPaused=!0,this.settings.messageIndex||(this.settings.messageIndex=0),this.settings.redirect||(this.settings.redirect=""),this.messages=function(){return[["Merio, my boy? Is that really you?! I almost didn't recognise you with your brand new walking animations and all. And to think that you were content with sliding around the floor like a troglodyte for the last 3 games. Well, I hope you've still got the moves and/or a working keyboard because I sure don't."],["Enjoy the ability to hang onto edges with your hair while you can before male pattern baldness kicks in."],["Did you know... YOU HAD A LONG LOST FAMILY RELATIVE?!","Merio: Yep.","Oh, okay. In any case, he's waiting for you in one of the later levels, probably to ask you for money again.","Merio: Yeah, that sounds about right."],["Whee! Getting shot out of a cannon never gets old. Anyway, this place has naturally occurring fairy floss that makes platforms briefly appear for some reason when eaten."],["So, overrunning that burning city from one of the previous games wasn't enough for these donut delinquents, eh? Jump on them before they take over another place that people sort of care about."],["Okay, Merio, this is the game plan: You rush these donuts, open the gate, jump over to the other fairy floss and KEEP EATING until you see a good opening to get past those dust guys. You can thank me later, but your liver and other vital organs certainly won't."],["Honestly, that last cannon was an absolute dud. But I've got a good feeling about this one because it smells like pork rinds."],["Looks like those lazy lumberjacks I hired left all their equipment lying around AGAIN. That's it, I want to see their manager right now!","While that's happening, you can move the boxes containing their stuff by repeatedly tapping the LEFT or RIGHT key while facing it to push it a little bit."],["Don't push that box all the way! You'll need it to give you extra height and make the jump over that chasm ahead."],["Alright, it's that point in the game where you really get to abuse the physics engine and violate the laws of motion, so listen up.","When you eat that fairy floss, the box of axes is going to briefly jump up. If you can get it to land on your hair at a particular angle, it'll get kicked right over there so you can climb the wall. But once it's in place, you only have one chance to get over it, so make it count! See you on the other side...that is if you can make it there."],["Whoowee! I totally didn't question your ability to get to this point, so good on you!","To get to the last cannon, you'll have to pass by these pudgy looking bears. They've got a weird thing going, so I suggest watching them for a bit to find a good way to get past them without being jumped on."],["There he is, just standing there menacingly. Get close enough to hear the crazed ramblings of a mad man."],["Merio: Hopefully it was worth being shot out of a cannon 3 times to hear what you have to say...","RIGHTO, I WILL KEEP THIS CONCISE BECAUSE I KNOW YOU HAVE A TERRIBLE ATTENTION SPAN.","VEhJUyBNSUdIVCBCRSBUSEUgTEFTVCBHQU1FIFlPVSBXSUxMIEVWRVIgU1RBUiBJTiwgQlVUIFlPVSBXRVJFIEEgR1JFQVQgSEVSTyBBTkQgV0lMTCBJTlNQSVJFIFRIRSBORVhUIEdFTkVSQVRJT04gVE8gRE8gRVZFTiBNT1JFIEhBSVItVEFDVUxBUiBGRUFUUy4=","Merio: Wait, what?","YES, I UNDERSTAND THIS CAN BE DIFFICULT TO PROCESS, BUT IN DUE TIME YOU WILL COME TO TERMS WITH IT.","AND NO, I WILL NOT REPEAT IT BECAUSE I AM A HUGE JERK.","Merio: Well, that was a gigantic waste of time. Got anything else to disappoint me with?","I ALSO NEED A FEW THOUSAND DOLLARS ONCE AGAIN.","Merio: Look, you can take these weird Brownie Points I've been picking up. You could probably cash them in for, like, a can of soda or an old boot.","THANK YOU MERIO, I KNEW I COULD ALWAYS TRUST IN YOU.","Merio: Now to get back to the start menu and goof around until I find something better to do with my life."]][arguments.length>0&&void 0!==arguments[0]?arguments[0]:0]}(this.settings.messageIndex),this.messageLength=this.messages.length,this.messageSubIndex=-1,this.nextMessage=function(){this.messageSubIndex++,this.messageSubIndex>=this.messageLength&&(this.messageSubIndex=-1,Uc(!0,""),this.settings.redirect&&(Oc(),Du.load(this.settings.redirect)))}}onCollision(t,e){return Ic(e.name)&&t.overlapV.y<0&&e.body.vel.y<=0&&(this.messageSubIndex=0,e.body.vel.y=0),!1}update(t){return this.messageSubIndex>=0&&this.messageSubIndex<this.messageLength&&(Uc(!1,this.messages[this.messageSubIndex]),gl.isKeyPressed("space")&&this.nextMessage()),super.update(t)}},ip=class extends uc{constructor(t,e,i){i.image="MOVEBLOCK",super(t,e,i),this.body.collisionType=Ol.types.WORLD_SHAPE,this.body.setFriction(.25,0),this.alwaysUpdate=!0,this.body.setCollisionMask(Ol.types.WORLD_SHAPE|Ol.types.PLAYER_OBJECT|Ol.types.PHYSICS_BOUND_ENEMY_OBJECT)}onCollision(t,e){switch(t.b.body.collisionType){case Ol.types.PHYSICS_BOUND_ENEMY_OBJECT:case Ol.types.PLAYER_OBJECT:0===t.overlapV.y&&(t.overlapV.x<0?this.body.force.x=-3.25:t.overlapV.x>0&&(this.body.force.x=3.25));case Ol.types.WORLD_SHAPE:break;default:return!1}return!0}},sp=class extends oc{constructor(t,e,i){i.image="SECRET",super(t,e,i),this.setOpacity(0)}onCollision(t,e){return Ic(e.name)&&(e.body.falling=!1,e.body.vel.y=1e6*-e.body.maxVel.y,e.body.jumping=!0,rh.seek("cannonshot")<=0&&rh.play("cannonshot",!1)),!1}},rp=class extends ep{constructor(t,e,i){super(t,e,i)}onCollision(t,e){return Ic(e.name)&&(this.messageSubIndex=0),!1}update(t){return super.update(t)}},np=class extends oc{constructor(t,e,i){i.image="PORTAL",super(t,e,i),this.ready=!1}onCollision(t,e){return Ic(e.name)&&(this.ready||(Gl.data.altModeGameOverScreen="gameover"),Oc(),Du.load(Gl.data.currentGameLevel)),!1}update(t){return Gl.data.altModePenaltyTimer<Gl.data.altModePenaltyTimerMax?Gl.data.altModePenaltyTimer+=Gl.data.altModePenaltyTimerStep:this.ready||(this.ready=!0,Uc(!1,"A strange portal has fully materialised. Jumping into it will take you back to the land of the living.")),this.setOpacity(Gl.data.altModePenaltyTimer/Gl.data.altModePenaltyTimerMax),!1}};class op extends nc{constructor(t,e,i){i.image="BUTTONS",i.framewidth=32,i.frameheight=32,i.width=i.framewidth,i.height=i.frameheight,super(t,e,i),this.settings=i,this.settings.message,this.settings.redirect,this.settings.label,this.settings.resetGameStateOnClick,this.updateWhenPaused=!0,this.addAnimation("off",[0]),this.addAnimation("on",[1]),this.setCurrentAnimation("off");const s="Verdana";if(this.settings.label.length>0){const r=new Qd(t+1.5*i.framewidth,e+.5*i.frameheight,{font:s,textAlign:"left",textBaseline:"bottom",text:this.settings.label});Gl.world.addChild(r,1)}}onOver(t){return this.setCurrentAnimation("on"),super.update(t)}onOut(t){return this.setCurrentAnimation("off"),super.update(t)}update(t){return!gl.isKeyPressed("space")&&uu.isPaused()||Uc(!0,""),super.update(t)}onClick(t){return this.settings.redirect?(this.settings.resetGameStateOnClick&&(Rc(),Dc(),Lc()),Oc(),Du.load(this.settings.redirect),!1):(Uc(!1,this.settings.message),!1)}}class ap extends Qd{constructor(t,e){super(t,e,{font:"Verdana",textAlign:"center",textBaseline:"middle",text:`High Score: ${Gl.data.highScore}`}),this.relative=new Vr(t,e),zn.on(zn.CANVAS_ONRESIZE,function(t,e){this.pos.set(t,e,0).add(this.relative)}.bind(this))}}class hp extends op{constructor(t,e,i){super(t,e,i)}onClick(t){Gl.data.useAltMode=!Gl.data.useAltMode,Gl.data.useAltMode?this.settings.message=["Pinocchio Mode is enabled.","Start the game with a massive bonus score! Plus infinite lives!","But each time you die, you lose more points and have to wait slightly longer to replay the level."].join("\n"):this.settings.message="Pinocchio Mode has been disabled.",Lc(),Uc(!1,this.settings.message)}}var lp=[{name:"Verdana",type:"image",src:"./data/fnt/verdana.png"},{name:"Verdana",type:"binary",src:"./data/fnt/verdana.fnt"},{name:"startmenu",type:"tmx",src:"data/map/startmenu.tmx"},{name:"level1",type:"tmx",src:"data/map/level1.tmx"},{name:"level2",type:"tmx",src:"data/map/level2.tmx"},{name:"level3",type:"tmx",src:"data/map/level3.tmx"},{name:"level-final",type:"tmx",src:"data/map/level-final.tmx"},{name:"gameover",type:"tmx",src:"data/map/gameover.tmx"},{name:"gameover-alternate",type:"tmx",src:"data/map/gameover-alternate.tmx"},{name:"all-tiles",type:"tsx",src:"data/map/all-tiles.json"},{name:"all-tiles",type:"image",src:"data/img/all-tiles.png"},{name:"LOGO",type:"tsx",src:"data/map/LOGO.json"},{name:"LOGO",type:"image",src:"data/img/gui/LOGO.png"},{name:"STABBED",type:"tsx",src:"data/map/LOGO.json"},{name:"STABBED",type:"image",src:"data/img/gui/STABBED.png"},{name:"foreground-large",type:"tsx",src:"data/map/foreground-large.json"},{name:"foreground-large",type:"image",src:"data/img/backdrop/foreground-large.png"},{name:"MERIO",type:"image",src:"data/img/sprites/MERIO.png"},{name:"SECRET",type:"image",src:"data/img/sprites/SECRET.png"},{name:"MONSTOID",type:"image",src:"data/img/sprites/MONSTOID.png"},{name:"DUSTGUY",type:"image",src:"data/img/sprites/DUSTGUY.png"},{name:"DONUT",type:"image",src:"data/img/sprites/DONUT.png"},{name:"BEARS",type:"image",src:"data/img/sprites/BEARS.png"},{name:"FLASHBLOCK",type:"image",src:"data/img/sprites/FLASHBLOCK.png"},{name:"FLASHBLOCKTRIGGER",type:"image",src:"data/img/sprites/FLASHBLOCKTRIGGER.png"},{name:"BOXGUY",type:"image",src:"data/img/sprites/BOXGUY.png"},{name:"MOVEBLOCK",type:"image",src:"data/img/sprites/MOVEBLOCK.png"},{name:"LIFES",type:"image",src:"data/img/sprites/LIFES.png"},{name:"WERIO",type:"image",src:"data/img/sprites/WERIO.png"},{name:"PORTAL",type:"image",src:"data/img/sprites/PORTAL.png"},{name:"backdrop-startmenu",type:"image",src:"data/img/backdrop/backdrop-startmenu.png"},{name:"backdrop-town",type:"image",src:"data/img/backdrop/backdrop-town.png"},{name:"backdrop-dessert-plains",type:"image",src:"data/img/backdrop/backdrop-dessert-plains.png"},{name:"backdrop-mist-forest",type:"image",src:"data/img/backdrop/backdrop-mist-forest.png"},{name:"backdrop-final",type:"image",src:"data/img/backdrop/backdrop-final.png"},{name:"backdrop-gameover",type:"image",src:"data/img/backdrop/backdrop-gameover.png"},{name:"theme-startmenu",type:"audio",src:"data/bgm/"},{name:"theme-town",type:"audio",src:"data/bgm/"},{name:"theme-dessert-plains",type:"audio",src:"data/bgm/"},{name:"theme-mist-forest",type:"audio",src:"data/bgm/"},{name:"theme-final",type:"audio",src:"data/bgm/"},{name:"cannonshot",type:"audio",src:"data/sfx/"},{name:"BUTTONS",type:"image",src:"data/img/gui/BUTTONS.png"},{name:"ONSCREENCONTROLS",type:"image",src:"data/img/gui/ONSCREENCONTROLS.png"}];Zo.onReady((()=>{Id.init(640,480,{parent:"screen",scaleMethod:"fit",renderer:Id.AUTO,preferWebGL1:!1,subPixel:!1})?(Gl.data={initialScore:0,initialLives:4,initialFlashBlockTimer:500,initialAltModePenaltyTimer:200,initialAltModePenaltyTimerMax:200,initialAltModePenaltyScore:25e4,initialAltModePenaltyTimerScale:2,initialAltModePenaltyScoreScale:2,initialAltModeScore:5e6,initialAltModeLives:1,initialAltModeGameOverScreen:"gameover-alternate",altModePenaltyTimerStep:1,score:0,lives:0,highScore:0,flashBlockTimer:0,flashBlockTimerMax:0,flashBlockTriggerInstance:void 0,useAltMode:!1,currentGameLevel:"",altModePenaltyScore:0,altModePenaltyTimer:0,altModePenaltyTimerMax:0,altModeGameOverScreen:""},Ol.types.PHYSICS_BOUND_ENEMY_OBJECT=Ol.types.USER<<0,document.getElementById("messageNextButton").onclick=Vc,rh.init("mp3,wav"),Ju.crossOrigin="anonymous",Ju.preload(lp,(function(){const t=new Xc;uu.set(uu.PLAY,t),uu.transition("fade","#FFFFFF",250),Ur.register("mainPlayer",Yc),Ur.register("SecretCollectableEntity",Wc),Ur.register("MonstoidEntity",Kc),Ur.register("DustGuyEntity",qc),Ur.register("DonutEntity",Zc),Ur.register("BossEntity",Qc),Ur.register("FlashBlockEntity",$c),Ur.register("FlashBlockTriggerEntity",tp),Ur.register("ChasmEntity",Jc),Ur.register("BoxGuyEntity",ep),Ur.register("MoveBlockEntity",ip),Ur.register("SuperJumpEntity",sp),Ur.register("NpcWerioEntity",rp),Ur.register("RevivalPortalEntity",np),Ur.register("MessageButtonEntity",op),Ur.register("HighScoreEntity",ap),Ur.register("AltModeButtonEntity",hp),gl.bindKey(gl.KEY.LEFT,"left"),gl.bindKey(gl.KEY.RIGHT,"right"),gl.bindKey(gl.KEY.UP,"jump",!0),gl.bindKey(gl.KEY.SPACE,"space",!0),gl.bindKey(gl.KEY.DOWN,"interact"),uu.change(uu.PLAY)}))):alert("Your browser does not support HTML5 canvas.")}))}()}();